typeof window<"u"&&function(Kt,ft){"object"==typeof exports&&"object"==typeof module?module.exports=ft():"function"==typeof define&&define.amd?define([],ft):"object"==typeof exports?exports.Hls=ft():Kt.Hls=ft()}(this,function(){return function(Kt){var ft={};function W(tt){if(ft[tt])return ft[tt].exports;var _=ft[tt]={i:tt,l:!1,exports:{}};return Kt[tt].call(_.exports,_,_.exports,W),_.l=!0,_.exports}return W.m=Kt,W.c=ft,W.d=function(tt,_,f){W.o(tt,_)||Object.defineProperty(tt,_,{enumerable:!0,get:f})},W.r=function(tt){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(tt,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(tt,"__esModule",{value:!0})},W.t=function(tt,_){if(1&_&&(tt=W(tt)),8&_||4&_&&"object"==typeof tt&&tt&&tt.__esModule)return tt;var f=Object.create(null);if(W.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:tt}),2&_&&"string"!=typeof tt)for(var M in tt)W.d(f,M,function(R){return tt[R]}.bind(null,M));return f},W.n=function(tt){var _=tt&&tt.__esModule?function(){return tt.default}:function(){return tt};return W.d(_,"a",_),_},W.o=function(tt,_){return Object.prototype.hasOwnProperty.call(tt,_)},W.p="/dist/",W(W.s=20)}([function(Kt,ft,W){"use strict";var tt,_;W.d(ft,"a",function(){return tt}),(_=tt||(tt={})).MEDIA_ATTACHING="hlsMediaAttaching",_.MEDIA_ATTACHED="hlsMediaAttached",_.MEDIA_DETACHING="hlsMediaDetaching",_.MEDIA_DETACHED="hlsMediaDetached",_.BUFFER_RESET="hlsBufferReset",_.BUFFER_CODECS="hlsBufferCodecs",_.BUFFER_CREATED="hlsBufferCreated",_.BUFFER_APPENDING="hlsBufferAppending",_.BUFFER_APPENDED="hlsBufferAppended",_.BUFFER_EOS="hlsBufferEos",_.BUFFER_FLUSHING="hlsBufferFlushing",_.BUFFER_FLUSHED="hlsBufferFlushed",_.MANIFEST_LOADING="hlsManifestLoading",_.MANIFEST_LOADED="hlsManifestLoaded",_.MANIFEST_PARSED="hlsManifestParsed",_.LEVEL_SWITCHING="hlsLevelSwitching",_.LEVEL_SWITCHED="hlsLevelSwitched",_.LEVEL_LOADING="hlsLevelLoading",_.LEVEL_LOADED="hlsLevelLoaded",_.LEVEL_UPDATED="hlsLevelUpdated",_.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",_.LEVELS_UPDATED="hlsLevelsUpdated",_.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",_.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",_.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",_.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",_.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",_.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",_.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",_.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",_.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",_.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",_.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",_.CUES_PARSED="hlsCuesParsed",_.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",_.INIT_PTS_FOUND="hlsInitPtsFound",_.FRAG_LOADING="hlsFragLoading",_.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",_.FRAG_LOADED="hlsFragLoaded",_.FRAG_DECRYPTED="hlsFragDecrypted",_.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",_.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",_.FRAG_PARSING_METADATA="hlsFragParsingMetadata",_.FRAG_PARSED="hlsFragParsed",_.FRAG_BUFFERED="hlsFragBuffered",_.FRAG_CHANGED="hlsFragChanged",_.FPS_DROP="hlsFpsDrop",_.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",_.ERROR="hlsError",_.DESTROYING="hlsDestroying",_.KEY_LOADING="hlsKeyLoading",_.KEY_LOADED="hlsKeyLoaded",_.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",_.BACK_BUFFER_REACHED="hlsBackBufferReached"},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return R}),W.d(ft,"b",function(){return Q});var tt=function(){},_={trace:tt,debug:tt,log:tt,warn:tt,info:tt,error:tt},f=_;function M(q){var F=self.console[q];return F?F.bind(self.console,"["+q+"] >"):tt}function R(q){if(self.console&&!0===q||"object"==typeof q){!function(F){for(var K=arguments.length,N=new Array(K>1?K-1:0),B=1;B<K;B++)N[B-1]=arguments[B];N.forEach(function(at){f[at]=F[at]?F[at].bind(F):M(at)})}(q,"debug","log","info","warn","error");try{f.log()}catch{f=_}}else f=_}var Q=_},function(Kt,ft,W){"use strict";var tt,_,f;W.d(ft,"b",function(){return tt}),W.d(ft,"a",function(){return _}),(f=tt||(tt={})).NETWORK_ERROR="networkError",f.MEDIA_ERROR="mediaError",f.KEY_SYSTEM_ERROR="keySystemError",f.MUX_ERROR="muxError",f.OTHER_ERROR="otherError",function(f){f.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",f.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",f.KEY_SYSTEM_NO_SESSION="keySystemNoSession",f.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",f.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",f.MANIFEST_LOAD_ERROR="manifestLoadError",f.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",f.MANIFEST_PARSING_ERROR="manifestParsingError",f.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",f.LEVEL_EMPTY_ERROR="levelEmptyError",f.LEVEL_LOAD_ERROR="levelLoadError",f.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",f.LEVEL_SWITCH_ERROR="levelSwitchError",f.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",f.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",f.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",f.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",f.FRAG_LOAD_ERROR="fragLoadError",f.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",f.FRAG_DECRYPT_ERROR="fragDecryptError",f.FRAG_PARSING_ERROR="fragParsingError",f.REMUX_ALLOC_ERROR="remuxAllocError",f.KEY_LOAD_ERROR="keyLoadError",f.KEY_LOAD_TIMEOUT="keyLoadTimeOut",f.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",f.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",f.BUFFER_APPEND_ERROR="bufferAppendError",f.BUFFER_APPENDING_ERROR="bufferAppendingError",f.BUFFER_STALLED_ERROR="bufferStalledError",f.BUFFER_FULL_ERROR="bufferFullError",f.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",f.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",f.INTERNAL_EXCEPTION="internalException",f.INTERNAL_ABORTED="aborted",f.UNKNOWN="unknown"}(_||(_={}))},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return tt});var tt=Number.isFinite||function(_){return"number"==typeof _&&isFinite(_)}},function(Kt,ft,W){"use strict";var tt,_,f;W.d(ft,"a",function(){return tt}),W.d(ft,"b",function(){return _}),(f=tt||(tt={})).MANIFEST="manifest",f.LEVEL="level",f.AUDIO_TRACK="audioTrack",f.SUBTITLE_TRACK="subtitleTrack",function(f){f.MAIN="main",f.AUDIO="audio",f.SUBTITLE="subtitle"}(_||(_={}))},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return tt}),W.d(ft,"b",function(){return at}),W.d(ft,"c",function(){return Y});var tt,J,_=W(3),f=W(11),M=W(1),R=W(17),Q=W(12);function q(J,$){J.prototype=Object.create($.prototype),J.prototype.constructor=J,F(J,$)}function F(J,$){return(F=Object.setPrototypeOf||function(z,C){return z.__proto__=C,z})(J,$)}function K(J,$){for(var z=0;z<$.length;z++){var C=$[z];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(J,C.key,C)}}function N(J,$,z){return $&&K(J.prototype,$),z&&K(J,z),J}(J=tt||(tt={})).AUDIO="audio",J.VIDEO="video",J.AUDIOVIDEO="audiovideo";var B=function(){function J($){var z;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((z={})[tt.AUDIO]=null,z[tt.VIDEO]=null,z[tt.AUDIOVIDEO]=null,z),this.baseurl=$}return J.prototype.setByteRange=function($,z){var C=$.split("@",2),k=[];k[0]=1===C.length?z?z.byteRangeEndOffset:0:parseInt(C[1]),k[1]=parseInt(C[0])+k[0],this._byteRange=k},N(J,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(f.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function($){this._url=$}}]),J}(),at=function(J){function $(C,k){var v;return(v=J.call(this,k)||this)._decryptdata=null,v.rawProgramDateTime=null,v.programDateTime=null,v.tagList=[],v.duration=0,v.sn=0,v.levelkey=void 0,v.type=void 0,v.loader=null,v.level=-1,v.cc=0,v.startPTS=void 0,v.endPTS=void 0,v.appendedPTS=void 0,v.startDTS=void 0,v.endDTS=void 0,v.start=0,v.deltaPTS=void 0,v.maxStartPTS=void 0,v.minEndPTS=void 0,v.stats=new Q.a,v.urlId=0,v.data=void 0,v.bitrateTest=!1,v.title=null,v.initSegment=null,v.type=C,v}q($,J);var z=$.prototype;return z.createInitializationVector=function(C){for(var k=new Uint8Array(16),v=12;v<16;v++)k[v]=C>>8*(15-v)&255;return k},z.setDecryptDataFromLevelKey=function(C,k){var v=C;return"AES-128"===C?.method&&C.uri&&!C.iv&&((v=R.a.fromURI(C.uri)).method=C.method,v.iv=this.createInitializationVector(k),v.keyFormat="identity"),v},z.setElementaryStreamInfo=function(C,k,v,E,T,w){void 0===w&&(w=!1);var H=this.elementaryStreams,j=H[C];j?(j.startPTS=Math.min(j.startPTS,k),j.endPTS=Math.max(j.endPTS,v),j.startDTS=Math.min(j.startDTS,E),j.endDTS=Math.max(j.endDTS,T)):H[C]={startPTS:k,endPTS:v,startDTS:E,endDTS:T,partial:w}},z.clearElementaryStreamInfo=function(){var C=this.elementaryStreams;C[tt.AUDIO]=null,C[tt.VIDEO]=null,C[tt.AUDIOVIDEO]=null},N($,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var C=this.sn;"number"!=typeof C&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&M.b.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),C=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,C)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(_.a)(this.programDateTime))return null;var C=Object(_.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*C}},{key:"encrypted",get:function(){var C;return!(null===(C=this.decryptdata)||void 0===C||!C.keyFormat||!this.decryptdata.uri)}}]),$}(B),Y=function(J){function $(z,C,k,v,E){var T;(T=J.call(this,k)||this).fragOffset=0,T.duration=0,T.gap=!1,T.independent=!1,T.relurl=void 0,T.fragment=void 0,T.index=void 0,T.stats=new Q.a,T.duration=z.decimalFloatingPoint("DURATION"),T.gap=z.bool("GAP"),T.independent=z.bool("INDEPENDENT"),T.relurl=z.enumeratedString("URI"),T.fragment=C,T.index=v;var w=z.enumeratedString("BYTERANGE");return w&&T.setByteRange(w,E),E&&(T.fragOffset=E.fragOffset+E.duration),T}return q($,J),N($,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var z=this.elementaryStreams;return!!(z.audio||z.video||z.audiovideo)}}]),$}(B)},function(Kt,ft,W){"use strict";W.d(ft,"b",function(){return F}),W.d(ft,"g",function(){return K}),W.d(ft,"f",function(){return N}),W.d(ft,"d",function(){return B}),W.d(ft,"c",function(){return at}),W.d(ft,"e",function(){return J}),W.d(ft,"h",function(){return $}),W.d(ft,"a",function(){return z});var tt=W(9),_=W(5),f=Math.pow(2,32)-1,M=[].push;function R(C){return String.fromCharCode.apply(null,C)}function Q(C,k){"data"in C&&(k+=C.start,C=C.data);var v=C[k]<<24|C[k+1]<<16|C[k+2]<<8|C[k+3];return v<0?4294967296+v:v}function q(C,k,v){"data"in C&&(k+=C.start,C=C.data),C[k]=v>>24,C[k+1]=v>>16&255,C[k+2]=v>>8&255,C[k+3]=255&v}function F(C,k){var v,E,T,w=[];if(!k.length)return w;"data"in C?(v=C.data,E=C.start,T=C.end):(E=0,T=(v=C).byteLength);for(var H=E;H<T;){var j=Q(v,H),I=j>1?H+j:T;if(R(v.subarray(H+4,H+8))===k[0])if(1===k.length)w.push({data:v,start:H+8,end:I});else{var Z=F({data:v,start:H+8,end:I},k.slice(1));Z.length&&M.apply(w,Z)}H=I}return w}function K(C){var k=F(C,["moov"])[0],v=k?k.end:null,E=F(C,["sidx"]);if(!E||!E[0])return null;var T=[],w=E[0],H=w.data[0],j=0===H?8:16,I=Q(w,j);j+=4,j+=0===H?8:16;var Z=w.end+0,lt=function(Tt,It){"data"in Tt&&(It+=Tt.start,Tt=Tt.data);var At=Tt[It]<<8|Tt[It+1];return At<0?65536+At:At}(w,j+=2);j+=2;for(var ct=0;ct<lt;ct++){var rt=j,mt=Q(w,rt);rt+=4;var bt=2147483647&mt;if((2147483648&mt)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Dt=Q(w,rt);rt+=4,T.push({referenceSize:bt,subsegmentDuration:Dt,info:{duration:Dt/I,start:Z,end:Z+bt-1}}),Z+=bt,j=rt+=4}return{earliestPresentationTime:0,timescale:I,version:H,referencesCount:lt,references:T,moovEndOffset:v}}function N(C){for(var k=[],v=F(C,["moov","trak"]),E=0;E<v.length;E++){var T=v[E],w=F(T,["tkhd"])[0];if(w){var H=w.data[w.start],j=0===H?12:20,I=Q(w,j),Z=F(T,["mdia","mdhd"])[0];if(Z){var lt=Q(Z,j=0===(H=Z.data[Z.start])?12:20),ct=F(T,["mdia","hdlr"])[0];if(ct){var rt=R(ct.data.subarray(ct.start+8,ct.start+12)),mt={soun:_.a.AUDIO,vide:_.a.VIDEO}[rt];if(mt){var bt=F(T,["mdia","minf","stbl","stsd"])[0],Dt=void 0;bt&&(Dt=R(bt.data.subarray(bt.start+12,bt.start+16))),k[I]={timescale:lt,type:mt},k[mt]={timescale:lt,id:I,codec:Dt}}}}}}return F(C,["moov","mvex","trex"]).forEach(function(Tt){var It=Q(Tt,4),At=k[It];At&&(At.default={duration:Q(Tt,12),flags:Q(Tt,20)})}),k}function B(C,k){return F(k,["moof","traf"]).reduce(function(v,E){var T=F(E,["tfdt"])[0],w=T.data[T.start],H=F(E,["tfhd"]).reduce(function(j,I){var Z=Q(I,4),lt=C[Z];if(lt){var ct=Q(T,4);1===w&&(ct*=Math.pow(2,32),ct+=Q(T,8));var rt=ct/(lt.timescale||9e4);if(isFinite(rt)&&(null===j||rt<j))return rt}return j},null);return null!==H&&isFinite(H)&&(null===v||H<v)?H:v},null)||0}function at(C,k){for(var v=0,E=0,T=0,w=F(C,["moof","traf"]),H=0;H<w.length;H++){var j=w[H],I=F(j,["tfhd"])[0],Z=k[Q(I,4)];if(Z){var lt=Z.default,ct=Q(I,0)|lt?.flags,rt=lt?.duration;8&ct&&(rt=Q(I,2&ct?12:8));for(var mt=Z.timescale||9e4,bt=F(j,["trun"]),Dt=0;Dt<bt.length;Dt++)!(v=Y(bt[Dt]))&&rt&&(v=rt*Q(bt[Dt],4)),Z.type===_.a.VIDEO?E+=v/mt:Z.type===_.a.AUDIO&&(T+=v/mt)}}if(0===E&&0===T){var Tt=K(C);if(null!=Tt&&Tt.references)return Tt.references.reduce(function(It,At){return It+At.info.duration||0},0)}return E||T}function Y(C){var k=Q(C,0),v=8;1&k&&(v+=4),4&k&&(v+=4);for(var E=0,T=Q(C,4),w=0;w<T;w++)256&k&&(E+=Q(C,v),v+=4),512&k&&(v+=4),1024&k&&(v+=4),2048&k&&(v+=4);return E}function J(C,k,v){F(k,["moof","traf"]).forEach(function(E){F(E,["tfhd"]).forEach(function(T){var w=Q(T,4),H=C[w];if(H){var j=H.timescale||9e4;F(E,["tfdt"]).forEach(function(I){var Z=I.data[I.start],lt=Q(I,4);if(0===Z)q(I,4,lt-v*j);else{lt*=Math.pow(2,32),lt+=Q(I,8),lt-=v*j,lt=Math.max(lt,0);var ct=Math.floor(lt/(f+1)),rt=Math.floor(lt%(f+1));q(I,4,ct),q(I,8,rt)}})}})})}function $(C){var k={valid:null,remainder:null},v=F(C,["moof"]);if(!v)return k;if(v.length<2)return k.remainder=C,k;var E=v[v.length-1];return k.valid=Object(tt.a)(C,0,E.start-8),k.remainder=Object(tt.a)(C,E.start-8),k}function z(C,k){var v=new Uint8Array(C.length+k.length);return v.set(C),v.set(k,C.length),v}},function(Kt,ft,W){"use strict";W.d(ft,"b",function(){return M}),W.d(ft,"a",function(){return Q}),W.d(ft,"d",function(){return q}),W.d(ft,"e",function(){return F}),W.d(ft,"c",function(){return N}),W.d(ft,"f",function(){return z});var tt,_=function(k,v){return v+10<=k.length&&73===k[v]&&68===k[v+1]&&51===k[v+2]&&k[v+3]<255&&k[v+4]<255&&k[v+6]<128&&k[v+7]<128&&k[v+8]<128&&k[v+9]<128},f=function(k,v){return v+10<=k.length&&51===k[v]&&68===k[v+1]&&73===k[v+2]&&k[v+3]<255&&k[v+4]<255&&k[v+6]<128&&k[v+7]<128&&k[v+8]<128&&k[v+9]<128},M=function(k,v){for(var E=v,T=0;_(k,v);)T+=10,T+=R(k,v+6),f(k,v+10)&&(T+=10),v+=T;if(T>0)return k.subarray(E,E+T)},R=function(k,v){var E=0;return E=(127&k[v])<<21,E|=(127&k[v+1])<<14,(E|=(127&k[v+2])<<7)|127&k[v+3]},Q=function(k,v){return _(k,v)&&R(k,v+6)+10<=k.length-v},q=function(k){for(var v=N(k),E=0;E<v.length;E++){var T=v[E];if(F(T))return $(T)}},F=function(k){return k&&"PRIV"===k.key&&"com.apple.streaming.transportStreamTimestamp"===k.info},K=function(k){var v=String.fromCharCode(k[0],k[1],k[2],k[3]),E=R(k,4);return{type:v,size:E,data:k.subarray(10,10+E)}},N=function(k){for(var v=0,E=[];_(k,v);){for(var T=R(k,v+6),w=(v+=10)+T;v+8<w;){var H=K(k.subarray(v)),j=B(H);j&&E.push(j),v+=H.size+10}f(k,v)&&(v+=10)}return E},B=function(k){return"PRIV"===k.type?at(k):"W"===k.type[0]?J(k):Y(k)},at=function(k){if(!(k.size<2)){var v=z(k.data,!0),E=new Uint8Array(k.data.subarray(v.length+1));return{key:k.type,info:v,data:E.buffer}}},Y=function(k){if(!(k.size<2)){if("TXXX"===k.type){var v=1,E=z(k.data.subarray(v),!0),T=z(k.data.subarray(v+=E.length+1));return{key:k.type,info:E,data:T}}var w=z(k.data.subarray(1));return{key:k.type,data:w}}},J=function(k){if("WXXX"===k.type){if(k.size<2)return;var v=1,E=z(k.data.subarray(v),!0),T=z(k.data.subarray(v+=E.length+1));return{key:k.type,info:E,data:T}}var w=z(k.data);return{key:k.type,data:w}},$=function(k){if(8===k.data.byteLength){var v=new Uint8Array(k.data),T=(v[4]<<23)+(v[5]<<15)+(v[6]<<7)+v[7];return T/=45,1&v[3]&&(T+=47721858.84),Math.round(T)}},z=function(k,v){void 0===v&&(v=!1);var E=function C(){return tt||void 0===self.TextDecoder||(tt=new self.TextDecoder("utf-8")),tt}();if(E){var T=E.decode(k);if(v){var w=T.indexOf("\0");return-1!==w?T.substring(0,w):T}return T.replace(/\0/g,"")}for(var H,j,I,Z=k.length,lt="",ct=0;ct<Z;){if(0===(H=k[ct++])&&v)return lt;if(0!==H&&3!==H)switch(H>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:lt+=String.fromCharCode(H);break;case 12:case 13:j=k[ct++],lt+=String.fromCharCode((31&H)<<6|63&j);break;case 14:j=k[ct++],I=k[ct++],lt+=String.fromCharCode((15&H)<<12|(63&j)<<6|(63&I)<<0)}}return lt}},function(Kt,ft,W){"use strict";function tt(R,Q,q,F){void 0===q&&(q=1),void 0===F&&(F=!1);var K=R*Q*q;return F?Math.round(K):K}function _(R,Q,q,F){return void 0===q&&(q=1),void 0===F&&(F=!1),tt(R,Q,1/q,F)}function f(R,Q){return void 0===Q&&(Q=!1),tt(R,1e3,1/9e4,Q)}function M(R,Q){return void 0===Q&&(Q=1),tt(R,9e4,1/Q)}W.d(ft,"c",function(){return _}),W.d(ft,"b",function(){return f}),W.d(ft,"a",function(){return M})},function(Kt,ft,W){"use strict";function tt(_,f,M){return Uint8Array.prototype.slice?_.slice(f,M):new Uint8Array(Array.prototype.slice.call(_,f,M))}W.d(ft,"a",function(){return tt})},function(Kt,ft,W){"use strict";W.d(ft,"c",function(){return Ct}),W.d(ft,"d",function(){return Le}),W.d(ft,"a",function(){return be}),W.d(ft,"b",function(){return ke});var tt=W(0),_=W(2),f=W(15),M=W(3),R=W(7),Q=W(6),q=W(9),F=function(){function O(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var A=O.prototype;return A.resetInitSegment=function(m,b,L){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},A.resetTimeStamp=function(){},A.resetContiguity=function(){},A.canParse=function(m,b){return!1},A.appendFrame=function(m,b,L){},A.demux=function(m,b){this.cachedData&&(m=Object(Q.a)(this.cachedData,m),this.cachedData=null);var L,P,x=R.b(m,0),G=x?x.length:0,X=this._audioTrack,ot=this._id3Track,st=x?R.d(x):void 0,ht=m.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=K(st,b)),x&&x.length>0&&ot.samples.push({pts:this.initPTS,dts:this.initPTS,data:x}),P=this.initPTS;G<ht;){if(this.canParse(m,G)){var gt=this.appendFrame(X,m,G);gt?(this.frameIndex++,P=gt.sample.pts,L=G+=gt.length):G=ht}else R.a(m,G)?(x=R.b(m,G),ot.samples.push({pts:P,dts:P,data:x}),L=G+=x.length):G++;if(G===ht&&L!==ht){var ut=Object(q.a)(m,L);this.cachedData=this.cachedData?Object(Q.a)(this.cachedData,ut):ut}}return{audioTrack:X,avcTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0},id3Track:ot,textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},A.demuxSampleAes=function(m,b,L){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},A.flush=function(m){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0},id3Track:this._id3Track,textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},A.destroy=function(){},O}(),K=function(O,A){return Object(M.a)(O)?90*O:9e4*A},N=F,B=W(1);function at(O,A){return 255===O[A]&&240==(246&O[A+1])}function Y(O,A){return 1&O[A+1]?7:9}function J(O,A){return(3&O[A+3])<<11|O[A+4]<<3|(224&O[A+5])>>>5}function $(O,A){return A+1<O.length&&at(O,A)}function z(O,A){if($(O,A)){var m=Y(O,A);if(A+m>=O.length)return!1;var b=J(O,A);if(b<=m)return!1;var L=A+b;return L===O.length||$(O,L)}return!1}function C(O,A,m,b,L){if(!O.samplerate){var P=function(x,G,X,ot){var st,ht,gt,ut,yt=navigator.userAgent.toLowerCase(),St=ot,wt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];st=1+((192&G[X+2])>>>6);var Et=(60&G[X+2])>>>2;if(!(Et>wt.length-1))return gt=(1&G[X+2])<<2,gt|=(192&G[X+3])>>>6,B.b.log("manifest codec:"+ot+", ADTS type:"+st+", samplingIndex:"+Et),/firefox/i.test(yt)?Et>=6?(st=5,ut=new Array(4),ht=Et-3):(st=2,ut=new Array(2),ht=Et):-1!==yt.indexOf("android")?(st=2,ut=new Array(2),ht=Et):(st=5,ut=new Array(4),ot&&(-1!==ot.indexOf("mp4a.40.29")||-1!==ot.indexOf("mp4a.40.5"))||!ot&&Et>=6?ht=Et-3:((ot&&-1!==ot.indexOf("mp4a.40.2")&&(Et>=6&&1===gt||/vivaldi/i.test(yt))||!ot&&1===gt)&&(st=2,ut=new Array(2)),ht=Et)),ut[0]=st<<3,ut[0]|=(14&Et)>>1,ut[1]|=(1&Et)<<7,ut[1]|=gt<<3,5===st&&(ut[1]|=(14&ht)>>1,ut[2]=(1&ht)<<7,ut[2]|=8,ut[3]=0),{config:ut,samplerate:wt[Et],channelCount:gt,codec:"mp4a.40."+st,manifestCodec:St};x.trigger(tt.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+Et})}(A,m,b,L);if(!P)return;O.config=P.config,O.samplerate=P.samplerate,O.channelCount=P.channelCount,O.codec=P.codec,O.manifestCodec=P.manifestCodec,B.b.log("parsed codec:"+O.codec+", rate:"+P.samplerate+", channels:"+P.channelCount)}}function k(O){return 9216e4/O}function v(O,A,m,b,L){var P=function(ut,yt,St,wt,Et){var Gt=Y(ut,yt),Ot=J(ut,yt);if((Ot-=Gt)>0)return{headerLength:Gt,frameLength:Ot,stamp:St+wt*Et}}(A,m,b,L,k(O.samplerate));if(P){var x,X=P.headerLength,ot=P.stamp,st=X+P.frameLength,ht=Math.max(0,m+st-A.length);ht?(x=new Uint8Array(st-X)).set(A.subarray(m+X,A.length),0):x=A.subarray(m+X,m+st);var gt={unit:x,pts:ot};return ht||O.samples.push(gt),{sample:gt,length:st,missing:ht}}}function E(O,A){return(E=Object.setPrototypeOf||function(m,b){return m.__proto__=b,m})(O,A)}var T=function(O){var A,m;function b(P,x){var G;return(G=O.call(this)||this).observer=void 0,G.config=void 0,G.observer=P,G.config=x,G}m=O,(A=b).prototype=Object.create(m.prototype),A.prototype.constructor=A,E(A,m);var L=b.prototype;return L.resetInitSegment=function(P,x,G){O.prototype.resetInitSegment.call(this,P,x,G),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:P,duration:G,inputTimeScale:9e4,dropped:0}},b.probe=function(P){if(!P)return!1;for(var x=(R.b(P,0)||[]).length,G=P.length;x<G;x++)if(z(P,x))return B.b.log("ADTS sync word found !"),!0;return!1},L.canParse=function(P,x){return(X=x)+5<(G=P).length&&at(G,X)&&J(G,X)<=G.length-X;var G,X},L.appendFrame=function(P,x,G){C(P,this.observer,x,G,P.manifestCodec);var X=v(P,x,G,this.initPTS,this.frameIndex);if(X&&0===X.missing)return X},b}(N);T.minProbeByteLength=9;var w=T,H=function(){function O(m,b){this.remainderData=null,this.config=void 0,this.config=b}var A=O.prototype;return A.resetTimeStamp=function(){},A.resetInitSegment=function(){},A.resetContiguity=function(){},O.probe=function(m){return Object(Q.b)({data:m,start:0,end:Math.min(m.length,16384)},["moof"]).length>0},A.demux=function(m){var b=m,L={type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0};if(this.config.progressive){this.remainderData&&(b=Object(Q.a)(this.remainderData,m));var P=Object(Q.h)(b);this.remainderData=P.remainder,L.samples=P.valid||new Uint8Array}else L.samples=b;return{audioTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0},avcTrack:L,id3Track:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0},textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},A.flush=function(){var m={type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0};return m.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0},avcTrack:m,id3Track:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0},textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},A.demuxSampleAes=function(m,b,L){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},A.destroy=function(){},O}();H.minProbeByteLength=1024;var j=H,I=null,Z=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],lt=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ct=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],rt=[0,1,1,4];function mt(O,A,m,b,L){if(!(m+24>A.length)){var P=bt(A,m);if(P&&m+P.frameLength<=A.length){var x=b+L*(9e4*P.samplesPerFrame/P.sampleRate),G={unit:A.subarray(m,m+P.frameLength),pts:x,dts:x};return O.config=[],O.channelCount=P.channelCount,O.samplerate=P.sampleRate,O.samples.push(G),{sample:G,length:P.frameLength,missing:0}}}}function bt(O,A){var m=O[A+1]>>3&3,b=O[A+1]>>1&3,L=O[A+2]>>4&15,P=O[A+2]>>2&3;if(1!==m&&0!==L&&15!==L&&3!==P){var G=O[A+3]>>6,X=1e3*Z[14*(3===m?3-b:3===b?3:4)+L-1],ot=lt[3*(3===m?0:2===m?1:2)+P],st=3===G?1:2,ht=ct[m][b],gt=rt[b],ut=8*ht*gt,yt=Math.floor(ht*X/ot+(O[A+2]>>1&1))*gt;if(null===I){var St=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);I=St?parseInt(St[1]):0}return!!I&&I<=87&&2===b&&X>=224e3&&0===G&&(O[A+3]=128|O[A+3]),{sampleRate:ot,channelCount:st,frameLength:yt,samplesPerFrame:ut}}}function Dt(O,A){return 255===O[A]&&224==(224&O[A+1])&&0!=(6&O[A+1])}function Tt(O,A){return A+1<O.length&&Dt(O,A)}function It(O,A){if(A+1<O.length&&Dt(O,A)){var m=bt(O,A),b=4;null!=m&&m.frameLength&&(b=m.frameLength);var L=A+b;return L===O.length||Tt(O,L)}return!1}var At=function(){function O(m){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=m,this.bytesAvailable=m.byteLength,this.word=0,this.bitsAvailable=0}var A=O.prototype;return A.loadWord=function(){var m=this.data,b=this.bytesAvailable,L=m.byteLength-b,P=new Uint8Array(4),x=Math.min(4,b);if(0===x)throw new Error("no bytes available");P.set(m.subarray(L,L+x)),this.word=new DataView(P.buffer).getUint32(0),this.bitsAvailable=8*x,this.bytesAvailable-=x},A.skipBits=function(m){var b;this.bitsAvailable>m?(this.word<<=m,this.bitsAvailable-=m):(m-=this.bitsAvailable,m-=(b=m>>3)>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=m,this.bitsAvailable-=m)},A.readBits=function(m){var b=Math.min(this.bitsAvailable,m),L=this.word>>>32-b;return m>32&&B.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),(b=m-b)>0&&this.bitsAvailable?L<<b|this.readBits(b):L},A.skipLZ=function(){var m;for(m=0;m<this.bitsAvailable;++m)if(0!=(this.word&2147483648>>>m))return this.word<<=m,this.bitsAvailable-=m,m;return this.loadWord(),m+this.skipLZ()},A.skipUEG=function(){this.skipBits(1+this.skipLZ())},A.skipEG=function(){this.skipBits(1+this.skipLZ())},A.readUEG=function(){var m=this.skipLZ();return this.readBits(m+1)-1},A.readEG=function(){var m=this.readUEG();return 1&m?1+m>>>1:-1*(m>>>1)},A.readBoolean=function(){return 1===this.readBits(1)},A.readUByte=function(){return this.readBits(8)},A.readUShort=function(){return this.readBits(16)},A.readUInt=function(){return this.readBits(32)},A.skipScalingList=function(m){for(var b=8,L=8,P=0;P<m;P++)0!==L&&(L=(b+this.readEG()+256)%256),b=0===L?b:L},A.readSPS=function(){var m,b,L,P=0,x=0,G=0,X=0,ot=this.readUByte.bind(this),st=this.readBits.bind(this),ht=this.readUEG.bind(this),gt=this.readBoolean.bind(this),ut=this.skipBits.bind(this),yt=this.skipEG.bind(this),St=this.skipUEG.bind(this),wt=this.skipScalingList.bind(this);ot();var Et=ot();if(st(5),ut(3),ot(),St(),100===Et||110===Et||122===Et||244===Et||44===Et||83===Et||86===Et||118===Et||128===Et){var Gt=ht();if(3===Gt&&ut(1),St(),St(),ut(1),gt())for(b=3!==Gt?8:12,L=0;L<b;L++)gt()&&wt(L<6?16:64)}St();var Ot=ht();if(0===Ot)ht();else if(1===Ot)for(ut(1),yt(),yt(),m=ht(),L=0;L<m;L++)yt();St(),ut(1);var Lt=ht(),de=ht(),xt=st(1);0===xt&&ut(1),ut(1),gt()&&(P=ht(),x=ht(),G=ht(),X=ht());var Rt=[1,1];if(gt()&&gt())switch(ot()){case 1:Rt=[1,1];break;case 2:Rt=[12,11];break;case 3:Rt=[10,11];break;case 4:Rt=[16,11];break;case 5:Rt=[40,33];break;case 6:Rt=[24,11];break;case 7:Rt=[20,11];break;case 8:Rt=[32,11];break;case 9:Rt=[80,33];break;case 10:Rt=[18,11];break;case 11:Rt=[15,11];break;case 12:Rt=[64,33];break;case 13:Rt=[160,99];break;case 14:Rt=[4,3];break;case 15:Rt=[3,2];break;case 16:Rt=[2,1];break;case 255:Rt=[ot()<<8|ot(),ot()<<8|ot()]}return{width:Math.ceil(16*(Lt+1)-2*P-2*x),height:(2-xt)*(de+1)*16-(xt?2:4)*(G+X),pixelRatio:Rt}},A.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},O}(),jt=function(){function O(m,b,L){this.keyData=void 0,this.decrypter=void 0,this.keyData=L,this.decrypter=new f.a(m,b,{removePKCS7Padding:!1})}var A=O.prototype;return A.decryptBuffer=function(m,b){this.decrypter.decrypt(m,this.keyData.key.buffer,this.keyData.iv.buffer,b)},A.decryptAacSample=function(m,b,L,P){var x=m[b].unit,G=x.subarray(16,x.length-x.length%16),X=G.buffer.slice(G.byteOffset,G.byteOffset+G.length),ot=this;this.decryptBuffer(X,function(st){var ht=new Uint8Array(st);x.set(ht,16),P||ot.decryptAacSamples(m,b+1,L)})},A.decryptAacSamples=function(m,b,L){for(;;b++){if(b>=m.length)return void L();if(!(m[b].unit.length<32)){var P=this.decrypter.isSync();if(this.decryptAacSample(m,b,L,P),!P)return}}},A.getAvcEncryptedData=function(m){for(var b=16*Math.floor((m.length-48)/160)+16,L=new Int8Array(b),P=0,x=32;x<m.length-16;x+=160,P+=16)L.set(m.subarray(x,x+16),P);return L},A.getAvcDecryptedUnit=function(m,b){for(var L=new Uint8Array(b),P=0,x=32;x<m.length-16;x+=160,P+=16)m.set(L.subarray(P,P+16),x);return m},A.decryptAvcSample=function(m,b,L,P,x,G){var X=Yt(x.data),ot=this.getAvcEncryptedData(X),st=this;this.decryptBuffer(ot.buffer,function(ht){x.data=st.getAvcDecryptedUnit(X,ht),G||st.decryptAvcSamples(m,b,L+1,P)})},A.decryptAvcSamples=function(m,b,L,P){if(m instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;b++,L=0){if(b>=m.length)return void P();for(var x=m[b].units;!(L>=x.length);L++){var G=x[L];if(!(G.data.length<=48||1!==G.type&&5!==G.type)){var X=this.decrypter.isSync();if(this.decryptAvcSample(m,b,L,P,G,X),!X)return}}}},O}(),Qt={video:1,audio:2,id3:3,text:4},Jt=function(){function O(m,b,L){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=m,this.config=b,this.typeSupported=L}O.probe=function(m){var b=O.syncOffset(m);return!(b<0||(b&&B.b.warn("MPEG2-TS detected but first sync word found @ offset "+b+", junk ahead ?"),0))},O.syncOffset=function(m){for(var b=Math.min(1e3,m.length-564),L=0;L<b;){if(71===m[L]&&71===m[L+188]&&71===m[L+376])return L;L++}return-1},O.createTrack=function(m,b){return{container:"video"===m||"audio"===m?"video/mp2t":void 0,type:m,id:Qt[m],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===m?b:void 0}};var A=O.prototype;return A.resetInitSegment=function(m,b,L){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=O.createTrack("video",L),this._audioTrack=O.createTrack("audio",L),this._id3Track=O.createTrack("id3",L),this._txtTrack=O.createTrack("text",L),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=b,this._duration=L},A.resetTimeStamp=function(){},A.resetContiguity=function(){var m=this._audioTrack,b=this._avcTrack,L=this._id3Track;m&&(m.pesData=null),b&&(b.pesData=null),L&&(L.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},A.demux=function(m,b,L,P){var x;void 0===L&&(L=!1),void 0===P&&(P=!1),L||(this.sampleAes=null);var G=this._avcTrack,X=this._audioTrack,ot=this._id3Track,st=G.pid,ht=G.pesData,gt=X.pid,ut=ot.pid,yt=X.pesData,St=ot.pesData,wt=!1,Et=this.pmtParsed,Gt=this._pmtId,Ot=m.length;if(this.remainderData&&(Ot=(m=Object(Q.a)(this.remainderData,m)).length,this.remainderData=null),Ot<188&&!P)return this.remainderData=m,{audioTrack:X,avcTrack:G,id3Track:ot,textTrack:this._txtTrack};var Lt=Math.max(0,O.syncOffset(m));(Ot-=(Ot+Lt)%188)<m.byteLength&&!P&&(this.remainderData=new Uint8Array(m.buffer,Ot,m.buffer.byteLength-Ot));for(var de=0,xt=Lt;xt<Ot;xt+=188)if(71===m[xt]){var Rt=!!(64&m[xt+1]),Ee=((31&m[xt+1])<<8)+m[xt+2],Ut=void 0;if((48&m[xt+3])>>4>1){if((Ut=xt+5+m[xt+4])===xt+188)continue}else Ut=xt+4;switch(Ee){case st:Rt&&(ht&&(x=Ft(ht))&&this.parseAVCPES(x,!1),ht={data:[],size:0}),ht&&(ht.data.push(m.subarray(Ut,xt+188)),ht.size+=xt+188-Ut);break;case gt:Rt&&(yt&&(x=Ft(yt))&&(X.isAAC?this.parseAACPES(x):this.parseMPEGPES(x)),yt={data:[],size:0}),yt&&(yt.data.push(m.subarray(Ut,xt+188)),yt.size+=xt+188-Ut);break;case ut:Rt&&(St&&(x=Ft(St))&&this.parseID3PES(x),St={data:[],size:0}),St&&(St.data.push(m.subarray(Ut,xt+188)),St.size+=xt+188-Ut);break;case 0:Rt&&(Ut+=m[Ut]+1),Gt=this._pmtId=_t(m,Ut);break;case Gt:Rt&&(Ut+=m[Ut]+1);var se=Ht(m,Ut,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,L);(st=se.avc)>0&&(G.pid=st),(gt=se.audio)>0&&(X.pid=gt,X.isAAC=se.isAAC),(ut=se.id3)>0&&(ot.pid=ut),wt&&!Et&&(B.b.log("reparse from beginning"),wt=!1,xt=Lt-188),Et=this.pmtParsed=!0;break;case 17:case 8191:break;default:wt=!0}}else de++;de>0&&this.observer.emit(tt.a.ERROR,tt.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+de+" TS packet/s that do not start with 0x47"}),G.pesData=ht,X.pesData=yt,ot.pesData=St;var Se={audioTrack:X,avcTrack:G,id3Track:ot,textTrack:this._txtTrack};return P&&this.extractRemainingSamples(Se),Se},A.flush=function(){var m,b=this.remainderData;return this.remainderData=null,m=b?this.demux(b,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(m),this.sampleAes?this.decrypt(m,this.sampleAes):m},A.extractRemainingSamples=function(m){var b,L=m.audioTrack,P=m.avcTrack,x=m.id3Track,G=P.pesData,X=L.pesData,ot=x.pesData;G&&(b=Ft(G))?(this.parseAVCPES(b,!0),P.pesData=null):P.pesData=G,X&&(b=Ft(X))?(L.isAAC?this.parseAACPES(b):this.parseMPEGPES(b),L.pesData=null):(null!=X&&X.size&&B.b.log("last AAC PES packet truncated,might overlap between fragments"),L.pesData=X),ot&&(b=Ft(ot))?(this.parseID3PES(b),x.pesData=null):x.pesData=ot},A.demuxSampleAes=function(m,b,L){var P=this.demux(m,L,!0,!this.config.progressive),x=this.sampleAes=new jt(this.observer,this.config,b);return this.decrypt(P,x)},A.decrypt=function(m,b){return new Promise(function(L){var P=m.audioTrack,x=m.avcTrack;P.samples&&P.isAAC?b.decryptAacSamples(P.samples,0,function(){x.samples?b.decryptAvcSamples(x.samples,0,0,function(){L(m)}):L(m)}):x.samples&&b.decryptAvcSamples(x.samples,0,0,function(){L(m)})})},A.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},A.parseAVCPES=function(m,b){var L,P=this,x=this._avcTrack,G=this.parseAVCNALu(m.data),X=this.avcSample,ot=!1;m.data=null,X&&G.length&&!x.audFound&&(Nt(X,x),X=this.avcSample=Bt(!1,m.pts,m.dts,"")),G.forEach(function(st){switch(st.type){case 1:L=!0,X||(X=P.avcSample=Bt(!0,m.pts,m.dts,"")),X.frame=!0;var ht=st.data;if(ot&&ht.length>4){var gt=new At(ht).readSliceType();2!==gt&&4!==gt&&7!==gt&&9!==gt||(X.key=!0)}break;case 5:L=!0,X||(X=P.avcSample=Bt(!0,m.pts,m.dts,"")),X.key=!0,X.frame=!0;break;case 6:L=!0;var ut=new At(Yt(st.data));ut.readUByte();for(var yt=0,St=0,wt=!1,Et=0;!wt&&ut.bytesAvailable>1;){yt=0;do{yt+=Et=ut.readUByte()}while(255===Et);St=0;do{St+=Et=ut.readUByte()}while(255===Et);if(4===yt&&0!==ut.bytesAvailable){if(wt=!0,181===ut.readUByte()&&49===ut.readUShort()&&1195456820===ut.readUInt()&&3===ut.readUByte()){for(var Gt=ut.readUByte(),Ot=31&Gt,Lt=[Gt,ut.readUByte()],de=0;de<Ot;de++)Lt.push(ut.readUByte()),Lt.push(ut.readUByte()),Lt.push(ut.readUByte());oe(P._txtTrack.samples,{type:3,pts:m.pts,bytes:Lt})}}else if(5===yt&&0!==ut.bytesAvailable){if(wt=!0,St>16){for(var xt=[],Rt=0;Rt<16;Rt++)xt.push(ut.readUByte().toString(16)),3!==Rt&&5!==Rt&&7!==Rt&&9!==Rt||xt.push("-");for(var Ee=St-16,Ut=new Uint8Array(Ee),se=0;se<Ee;se++)Ut[se]=ut.readUByte();oe(P._txtTrack.samples,{pts:m.pts,payloadType:yt,uuid:xt.join(""),userData:Object(R.f)(Ut),userDataBytes:Ut})}}else if(St<ut.bytesAvailable)for(var Se=0;Se<St;Se++)ut.readUByte()}break;case 7:if(L=!0,ot=!0,!x.sps){var Ae=new At(st.data).readSPS();x.width=Ae.width,x.height=Ae.height,x.pixelRatio=Ae.pixelRatio,x.sps=[st.data],x.duration=P._duration;for(var Re=st.data.subarray(1,4),ye="avc1.",ce=0;ce<3;ce++){var ne=Re[ce].toString(16);ne.length<2&&(ne="0"+ne),ye+=ne}x.codec=ye}break;case 8:L=!0,x.pps||(x.pps=[st.data]);break;case 9:L=!1,x.audFound=!0,X&&Nt(X,x),X=P.avcSample=Bt(!1,m.pts,m.dts,"");break;case 12:L=!1;break;default:L=!1,X&&(X.debug+="unknown NAL "+st.type+" ")}X&&L&&X.units.push(st)}),b&&X&&(Nt(X,x),this.avcSample=null)},A.getLastNalUnit=function(){var m,b,L=this.avcSample;if(!L||0===L.units.length){var P=this._avcTrack.samples;L=P[P.length-1]}if(null!==(m=L)&&void 0!==m&&m.units){var x=L.units;b=x[x.length-1]}return b},A.parseAVCNALu=function(m){var b,L,P=m.byteLength,x=this._avcTrack,G=x.naluState||0,X=G,ot=[],st=0,ht=-1,gt=0;for(-1===G&&(ht=0,gt=31&m[0],G=0,st=1);st<P;)if(b=m[st++],G)if(1!==G)if(b)if(1===b){if(ht>=0){var ut={data:m.subarray(ht,st-G-1),type:gt};ot.push(ut)}else{var yt=this.getLastNalUnit();if(yt&&(X&&st<=4-X&&yt.state&&(yt.data=yt.data.subarray(0,yt.data.byteLength-X)),(L=st-G-1)>0)){var St=new Uint8Array(yt.data.byteLength+L);St.set(yt.data,0),St.set(m.subarray(0,L),yt.data.byteLength),yt.data=St,yt.state=0}}st<P?(ht=st,gt=31&m[st],G=0):G=-1}else G=0;else G=3;else G=b?0:2;else G=b?0:1;if(ht>=0&&G>=0){var wt={data:m.subarray(ht,P),type:gt,state:G};ot.push(wt)}if(0===ot.length){var Et=this.getLastNalUnit();if(Et){var Gt=new Uint8Array(Et.data.byteLength+m.byteLength);Gt.set(Et.data,0),Gt.set(m,Et.data.byteLength),Et.data=Gt}}return x.naluState=G,ot},A.parseAACPES=function(m){var b,L,P,x,G,X=0,ot=this._audioTrack,st=this.aacOverFlow,ht=m.data;if(st){this.aacOverFlow=null;var gt=st.sample.unit.byteLength,ut=Math.min(st.missing,gt),yt=gt-ut;st.sample.unit.set(ht.subarray(0,ut),yt),ot.samples.push(st.sample),X=st.missing}for(b=X,L=ht.length;b<L-1&&!$(ht,b);b++);if(b===X||(b<L-1?(P="AAC PES did not start with ADTS header,offset:"+b,x=!1):(P="no ADTS header found in AAC PES",x=!0),B.b.warn("parsing error:"+P),this.observer.emit(tt.a.ERROR,tt.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.FRAG_PARSING_ERROR,fatal:x,reason:P}),!x)){if(C(ot,this.observer,ht,b,this.audioCodec),void 0!==m.pts)G=m.pts;else{if(!st)return void B.b.warn("[tsdemuxer]: AAC PES unknown PTS");var St=k(ot.samplerate);G=st.sample.pts+St}for(var wt=0;b<L;){if($(ht,b)){if(b+5<L){var Et=v(ot,ht,b,G,wt);if(Et){if(!Et.missing){b+=Et.length,wt++;continue}this.aacOverFlow=Et}}break}b++}}},A.parseMPEGPES=function(m){var b=m.data,L=b.length,P=0,x=0,G=m.pts;if(void 0!==G)for(;x<L;)if(Tt(b,x)){var X=mt(this._audioTrack,b,x,G,P);if(!X)break;x+=X.length,P++}else x++;else B.b.warn("[tsdemuxer]: MPEG PES unknown PTS")},A.parseID3PES=function(m){void 0!==m.pts?this._id3Track.samples.push(m):B.b.warn("[tsdemuxer]: ID3 PES unknown PTS")},O}();function Bt(O,A,m,b){return{key:O,frame:!1,pts:A,dts:m,units:[],debug:b,length:0}}function _t(O,A){return(31&O[A+10])<<8|O[A+11]}function Ht(O,A,m,b){var L={audio:-1,avc:-1,id3:-1,isAAC:!0},P=A+3+((15&O[A+1])<<8|O[A+2])-4;for(A+=12+((15&O[A+10])<<8|O[A+11]);A<P;){var x=(31&O[A+1])<<8|O[A+2];switch(O[A]){case 207:if(!b){B.b.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===L.audio&&(L.audio=x);break;case 21:-1===L.id3&&(L.id3=x);break;case 219:if(!b){B.b.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===L.avc&&(L.avc=x);break;case 3:case 4:m?-1===L.audio&&(L.audio=x,L.isAAC=!1):B.b.log("MPEG audio found, not supported in this browser");break;case 36:B.b.warn("Unsupported HEVC stream type found")}A+=5+((15&O[A+3])<<8|O[A+4])}return L}function Ft(O){var A,m,b,L,P,x=0,G=O.data;if(!O||0===O.size)return null;for(;G[0].length<19&&G.length>1;){var X=new Uint8Array(G[0].length+G[1].length);X.set(G[0]),X.set(G[1],G[0].length),G[0]=X,G.splice(1,1)}if(((A=G[0])[0]<<16)+(A[1]<<8)+A[2]===1){if((m=(A[4]<<8)+A[5])&&m>O.size-6)return null;var ot=A[7];192&ot&&(L=536870912*(14&A[9])+4194304*(255&A[10])+16384*(254&A[11])+128*(255&A[12])+(254&A[13])/2,64&ot?L-(P=536870912*(14&A[14])+4194304*(255&A[15])+16384*(254&A[16])+128*(255&A[17])+(254&A[18])/2)>54e5&&(B.b.warn(Math.round((L-P)/9e4)+"s delta between PTS and DTS, align them"),L=P):P=L);var st=(b=A[8])+9;if(O.size<=st)return null;O.size-=st;for(var ht=new Uint8Array(O.size),gt=0,ut=G.length;gt<ut;gt++){var yt=(A=G[gt]).byteLength;if(st){if(st>yt){st-=yt;continue}A=A.subarray(st),yt-=st,st=0}ht.set(A,x),x+=yt}return m&&(m-=b+3),{data:ht,pts:L,dts:P,len:m}}return null}function Nt(O,A){if(O.units.length&&O.frame){if(void 0===O.pts){var m=A.samples,b=m.length;if(!b)return void A.dropped++;var L=m[b-1];O.pts=L.pts,O.dts=L.dts}A.samples.push(O)}O.debug.length&&B.b.log(O.pts+"/"+O.dts+":"+O.debug)}function oe(O,A){var m=O.length;if(m>0){if(A.pts>=O[m-1].pts)O.push(A);else for(var b=m-1;b>=0;b--)if(A.pts<O[b].pts){O.splice(b,0,A);break}}else O.push(A)}function Yt(O){for(var A=O.byteLength,m=[],b=1;b<A-2;)0===O[b]&&0===O[b+1]&&3===O[b+2]?(m.push(b+2),b+=2):b++;if(0===m.length)return O;var L=A-m.length,P=new Uint8Array(L),x=0;for(b=0;b<L;x++,b++)x===m[0]&&(x++,m.shift()),P[b]=O[x];return P}Jt.minProbeByteLength=188;var ge=Jt;function ve(O,A){return(ve=Object.setPrototypeOf||function(m,b){return m.__proto__=b,m})(O,A)}var re=function(O){var A,m;function b(){return O.apply(this,arguments)||this}m=O,(A=b).prototype=Object.create(m.prototype),A.prototype.constructor=A,ve(A,m);var L=b.prototype;return L.resetInitSegment=function(P,x,G){O.prototype.resetInitSegment.call(this,P,x,G),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:P,duration:G,inputTimeScale:9e4,dropped:0}},b.probe=function(P){if(!P)return!1;for(var x=(R.b(P,0)||[]).length,G=P.length;x<G;x++)if(It(P,x))return B.b.log("MPEG Audio sync word found !"),!0;return!1},L.canParse=function(P,x){return Dt(G=P,X=x)&&4<=G.length-X;var G,X},L.appendFrame=function(P,x,G){if(null!==this.initPTS)return mt(P,x,G,this.initPTS,this.frameIndex)},b}(N);re.minProbeByteLength=4;var $t=re,le=W(16),qt=W(5),Pt=function(){function O(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var A=O.prototype;return A.destroy=function(){},A.resetTimeStamp=function(m){this.initPTS=m,this.lastEndDTS=null},A.resetNextTimestamp=function(){this.lastEndDTS=null},A.resetInitSegment=function(m,b,L){this.audioCodec=b,this.videoCodec=L,this.generateInitSegment(m),this.emitInitSegment=!0},A.generateInitSegment=function(m){var b=this.audioCodec,L=this.videoCodec;if(!m||!m.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var P=this.initData=Object(Q.f)(m);b||(b=pe(P.audio,qt.a.AUDIO)),L||(L=pe(P.video,qt.a.VIDEO));var x={};P.audio&&P.video?x.audiovideo={container:"video/mp4",codec:b+","+L,initSegment:m,id:"main"}:P.audio?x.audio={container:"audio/mp4",codec:b,initSegment:m,id:"audio"}:P.video?x.video={container:"video/mp4",codec:L,initSegment:m,id:"main"}:B.b.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=x},A.remux=function(m,b,L,P,x){var G=this.initPTS,X=this.lastEndDTS,ot={audio:void 0,video:void 0,text:P,id3:L,initSegment:void 0};Object(M.a)(X)||(X=this.lastEndDTS=x||0);var st=b.samples;if(!st||!st.length)return ot;var ht={initPTS:void 0,timescale:1},gt=this.initData;if(gt&&gt.length||(this.generateInitSegment(st),gt=this.initData),!gt||!gt.length)return B.b.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ot;this.emitInitSegment&&(ht.tracks=this.initTracks,this.emitInitSegment=!1),Object(M.a)(G)||(this.initPTS=ht.initPTS=G=De(gt,st,X));var ut=Object(Q.c)(st,gt),yt=X,St=ut+yt;Object(Q.e)(gt,st,G),ut>0?this.lastEndDTS=St:(B.b.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var wt=!!gt.audio,Et=!!gt.video,Gt="";wt&&(Gt+="audio"),Et&&(Gt+="video");var Ot={data1:st,startPTS:yt,startDTS:yt,endPTS:St,endDTS:St,type:Gt,hasAudio:wt,hasVideo:Et,nb:1,dropped:0};return ot.audio="audio"===Ot.type?Ot:void 0,ot.video="audio"!==Ot.type?Ot:void 0,ot.text=P,ot.id3=L,ot.initSegment=ht,ot},O}(),De=function(O,A,m){return Object(Q.d)(O,A)-m};function pe(O,A){var m=O?.codec;return m&&m.length>4?m:"hvc1"===m?"hvc1.1.c.L120.90":"av01"===m?"av01.0.04M.08":"avc1"===m||A===qt.a.VIDEO?"avc1.42e01e":"mp4a.40.5"}var ie,ue=Pt,Zt=W(13);try{ie=self.performance.now.bind(self.performance)}catch{B.b.debug("Unable to use Performance API on this environment"),ie=self.Date.now}var he=[{demux:ge,remux:le.a},{demux:j,remux:ue},{demux:w,remux:le.a},{demux:$t,remux:le.a}],te=1024;he.forEach(function(O){te=Math.max(te,O.demux.minProbeByteLength)});var Ct=function(){function O(m,b,L,P,x){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new Zt.a,this.observer=m,this.typeSupported=b,this.config=L,this.vendor=P,this.id=x}var A=O.prototype;return A.configure=function(m){this.transmuxConfig=m,this.decrypter&&this.decrypter.reset()},A.push=function(m,b,L,P){var x=this,G=L.transmuxing;G.executeStart=ie();var X=new Uint8Array(m),ot=this.cache,st=this.config,ht=this.currentTransmuxState,gt=this.transmuxConfig;P&&(this.currentTransmuxState=P);var ne,Ce,ut=(ne=b,Ce=null,X.byteLength>0&&null!=ne&&null!=ne.key&&null!==ne.iv&&null!=ne.method&&(Ce=ne),Ce);if(ut&&"AES-128"===ut.method){var yt=this.getDecrypter();if(!st.enableSoftwareAES)return this.decryptionPromise=yt.webCryptoDecrypt(X,ut.key.buffer,ut.iv.buffer).then(function(ce){var ne=x.push(ce,null,L);return x.decryptionPromise=null,ne}),this.decryptionPromise;var St=yt.softwareDecrypt(X,ut.key.buffer,ut.iv.buffer);if(!St)return G.executeEnd=ie(),Te(L);X=new Uint8Array(St)}var wt=P||ht,Et=wt.contiguous,Gt=wt.discontinuity,Ot=wt.trackSwitch,Lt=wt.accurateTimeOffset,de=wt.timeOffset,xt=wt.initSegmentChange,Ut=gt.defaultInitPts;if((Gt||Ot||xt)&&this.resetInitSegment(gt.initSegmentData,gt.audioCodec,gt.videoCodec,gt.duration),(Gt||xt)&&this.resetInitialTimestamp(Ut),Et||this.resetContiguity(),this.needsProbing(X,Gt,Ot)){if(ot.dataLength){var Ae=ot.flush();X=Object(Q.a)(Ae,X)}this.configureTransmuxer(X,gt)}var Re=this.transmux(X,ut,de,Lt,L),ye=this.currentTransmuxState;return ye.contiguous=!0,ye.discontinuity=!1,ye.trackSwitch=!1,G.executeEnd=ie(),Re},A.flush=function(m){var b=this,L=m.transmuxing;L.executeStart=ie();var P=this.decrypter,x=this.cache,G=this.currentTransmuxState,X=this.decryptionPromise;if(X)return X.then(function(){return b.flush(m)});var ot=[],st=G.timeOffset;if(P){var ht=P.flush();ht&&ot.push(this.push(ht,null,m))}var gt=x.dataLength;x.reset();var ut=this.demuxer;if(!ut||!this.remuxer)return gt>=te&&this.observer.emit(tt.a.ERROR,tt.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),L.executeEnd=ie(),[Te(m)];var St=ut.flush(st);return Le(St)?St.then(function(wt){return b.flushRemux(ot,wt,m),ot}):(this.flushRemux(ot,St,m),ot)},A.flushRemux=function(m,b,L){var P=b.audioTrack,x=b.avcTrack,G=b.id3Track,X=b.textTrack,ot=this.currentTransmuxState,st=ot.accurateTimeOffset,ht=ot.timeOffset;B.b.log("[transmuxer.ts]: Flushed fragment "+L.sn+(L.part>-1?" p: "+L.part:"")+" of level "+L.level);var gt=this.remuxer.remux(P,x,G,X,ht,st,!0,this.id);m.push({remuxResult:gt,chunkMeta:L}),L.transmuxing.executeEnd=ie()},A.resetInitialTimestamp=function(m){var b=this.demuxer,L=this.remuxer;b&&L&&(b.resetTimeStamp(m),L.resetTimeStamp(m))},A.resetContiguity=function(){var m=this.demuxer,b=this.remuxer;m&&b&&(m.resetContiguity(),b.resetNextTimestamp())},A.resetInitSegment=function(m,b,L,P){var x=this.demuxer,G=this.remuxer;x&&G&&(x.resetInitSegment(b,L,P),G.resetInitSegment(m,b,L))},A.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},A.transmux=function(m,b,L,P,x){return b&&"SAMPLE-AES"===b.method?this.transmuxSampleAes(m,b,L,P,x):this.transmuxUnencrypted(m,L,P,x)},A.transmuxUnencrypted=function(m,b,L,P){var x=this.demuxer.demux(m,b,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(x.audioTrack,x.avcTrack,x.id3Track,x.textTrack,b,L,!1,this.id),chunkMeta:P}},A.transmuxSampleAes=function(m,b,L,P,x){var G=this;return this.demuxer.demuxSampleAes(m,b,L).then(function(X){return{remuxResult:G.remuxer.remux(X.audioTrack,X.avcTrack,X.id3Track,X.textTrack,L,P,!1,G.id),chunkMeta:x}})},A.configureTransmuxer=function(m,b){for(var L,P=this.config,x=this.observer,G=this.typeSupported,X=this.vendor,ot=b.audioCodec,st=b.defaultInitPts,ht=b.duration,gt=b.initSegmentData,ut=b.videoCodec,yt=0,St=he.length;yt<St;yt++)if(he[yt].demux.probe(m)){L=he[yt];break}L||(B.b.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),L={demux:j,remux:ue});var wt=this.demuxer,Et=this.remuxer,Gt=L.remux,Ot=L.demux;Et&&Et instanceof Gt||(this.remuxer=new Gt(x,P,G,X)),wt&&wt instanceof Ot||(this.demuxer=new Ot(x,P,G),this.probe=Ot.probe),this.resetInitSegment(gt,ot,ut,ht),this.resetInitialTimestamp(st)},A.needsProbing=function(m,b,L){return!this.demuxer||!this.remuxer||b||L},A.getDecrypter=function(){var m=this.decrypter;return m||(m=this.decrypter=new f.a(this.observer,this.config)),m},O}(),Te=function(O){return{remuxResult:{},chunkMeta:O}};function Le(O){return"then"in O&&O.then instanceof Function}var be=function(O,A,m,b,L){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=O,this.videoCodec=A,this.initSegmentData=m,this.duration=b,this.defaultInitPts=L},ke=function(O,A,m,b,L,P){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=O,this.contiguous=A,this.accurateTimeOffset=m,this.trackSwitch=b,this.timeOffset=L,this.initSegmentChange=P}},function(Kt,ft,W){var tt,_,f,M,R;tt=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,_=/^([^\/?#]*)([^]*)$/,f=/(?:\/|^)\.(?=\/)/g,M=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Kt.exports=R={buildAbsoluteURL:function(Q,q,F){if(F=F||{},Q=Q.trim(),!(q=q.trim())){if(!F.alwaysNormalize)return Q;var K=R.parseURL(Q);if(!K)throw new Error("Error trying to parse base URL.");return K.path=R.normalizePath(K.path),R.buildURLFromParts(K)}var N=R.parseURL(q);if(!N)throw new Error("Error trying to parse relative URL.");if(N.scheme)return F.alwaysNormalize?(N.path=R.normalizePath(N.path),R.buildURLFromParts(N)):q;var B=R.parseURL(Q);if(!B)throw new Error("Error trying to parse base URL.");if(!B.netLoc&&B.path&&"/"!==B.path[0]){var at=_.exec(B.path);B.netLoc=at[1],B.path=at[2]}B.netLoc&&!B.path&&(B.path="/");var Y={scheme:B.scheme,netLoc:N.netLoc,path:null,params:N.params,query:N.query,fragment:N.fragment};if(!N.netLoc&&(Y.netLoc=B.netLoc,"/"!==N.path[0]))if(N.path){var J=B.path,$=J.substring(0,J.lastIndexOf("/")+1)+N.path;Y.path=R.normalizePath($)}else Y.path=B.path,N.params||(Y.params=B.params,N.query||(Y.query=B.query));return null===Y.path&&(Y.path=F.alwaysNormalize?R.normalizePath(N.path):N.path),R.buildURLFromParts(Y)},parseURL:function(Q){var q=tt.exec(Q);return q?{scheme:q[1]||"",netLoc:q[2]||"",path:q[3]||"",params:q[4]||"",query:q[5]||"",fragment:q[6]||""}:null},normalizePath:function(Q){for(Q=Q.split("").reverse().join("").replace(f,"");Q.length!==(Q=Q.replace(M,"")).length;);return Q.split("").reverse().join("")},buildURLFromParts:function(Q){return Q.scheme+Q.netLoc+Q.path+Q.params+Q.query+Q.fragment}}},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return tt});var tt=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return tt});var tt=function(){function _(){this.chunks=[],this.dataLength=0}var f=_.prototype;return f.push=function(M){this.chunks.push(M),this.dataLength+=M.length},f.flush=function(){var M,R=this.chunks;return R.length?(M=1===R.length?R[0]:function(q,F){for(var K=new Uint8Array(F),N=0,B=0;B<q.length;B++){var at=q[B];K.set(at,N),N+=at.length}return K}(R,this.dataLength),this.reset(),M):new Uint8Array(0)},f.reset=function(){this.chunks.length=0,this.dataLength=0},_}()},function(Kt,ft,W){"use strict";var tt=Object.prototype.hasOwnProperty,_="~";function f(){}function M(F,K,N){this.fn=F,this.context=K,this.once=N||!1}function R(F,K,N,B,at){if("function"!=typeof N)throw new TypeError("The listener must be a function");var Y=new M(N,B||F,at),J=_?_+K:K;return F._events[J]?F._events[J].fn?F._events[J]=[F._events[J],Y]:F._events[J].push(Y):(F._events[J]=Y,F._eventsCount++),F}function Q(F,K){0==--F._eventsCount?F._events=new f:delete F._events[K]}function q(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),(new f).__proto__||(_=!1)),q.prototype.eventNames=function(){var F,K,N=[];if(0===this._eventsCount)return N;for(K in F=this._events)tt.call(F,K)&&N.push(_?K.slice(1):K);return Object.getOwnPropertySymbols?N.concat(Object.getOwnPropertySymbols(F)):N},q.prototype.listeners=function(F){var N=this._events[_?_+F:F];if(!N)return[];if(N.fn)return[N.fn];for(var B=0,at=N.length,Y=new Array(at);B<at;B++)Y[B]=N[B].fn;return Y},q.prototype.listenerCount=function(F){var N=this._events[_?_+F:F];return N?N.fn?1:N.length:0},q.prototype.emit=function(F,K,N,B,at,Y){var J=_?_+F:F;if(!this._events[J])return!1;var $,z,C=this._events[J],k=arguments.length;if(C.fn){switch(C.once&&this.removeListener(F,C.fn,void 0,!0),k){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,K),!0;case 3:return C.fn.call(C.context,K,N),!0;case 4:return C.fn.call(C.context,K,N,B),!0;case 5:return C.fn.call(C.context,K,N,B,at),!0;case 6:return C.fn.call(C.context,K,N,B,at,Y),!0}for(z=1,$=new Array(k-1);z<k;z++)$[z-1]=arguments[z];C.fn.apply(C.context,$)}else{var v,E=C.length;for(z=0;z<E;z++)switch(C[z].once&&this.removeListener(F,C[z].fn,void 0,!0),k){case 1:C[z].fn.call(C[z].context);break;case 2:C[z].fn.call(C[z].context,K);break;case 3:C[z].fn.call(C[z].context,K,N);break;case 4:C[z].fn.call(C[z].context,K,N,B);break;default:if(!$)for(v=1,$=new Array(k-1);v<k;v++)$[v-1]=arguments[v];C[z].fn.apply(C[z].context,$)}}return!0},q.prototype.on=function(F,K,N){return R(this,F,K,N,!1)},q.prototype.once=function(F,K,N){return R(this,F,K,N,!0)},q.prototype.removeListener=function(F,K,N,B){var at=_?_+F:F;if(!this._events[at])return this;if(!K)return Q(this,at),this;var Y=this._events[at];if(Y.fn)Y.fn!==K||B&&!Y.once||N&&Y.context!==N||Q(this,at);else{for(var J=0,$=[],z=Y.length;J<z;J++)(Y[J].fn!==K||B&&!Y[J].once||N&&Y[J].context!==N)&&$.push(Y[J]);$.length?this._events[at]=1===$.length?$[0]:$:Q(this,at)}return this},q.prototype.removeAllListeners=function(F){var K;return F?this._events[K=_?_+F:F]&&Q(this,K):(this._events=new f,this._eventsCount=0),this},q.prototype.off=q.prototype.removeListener,q.prototype.addListener=q.prototype.on,q.prefixed=_,q.EventEmitter=q,Kt.exports=q},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return q});var tt=function(){function F(K,N){this.subtle=void 0,this.aesIV=void 0,this.subtle=K,this.aesIV=N}return F.prototype.decrypt=function(K,N){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},N,K)},F}(),_=function(){function F(K,N){this.subtle=void 0,this.key=void 0,this.subtle=K,this.key=N}return F.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},F}(),f=W(9),M=function(){function F(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=F.prototype;return K.uint8ArrayToUint32Array_=function(N){for(var B=new DataView(N),at=new Uint32Array(4),Y=0;Y<4;Y++)at[Y]=B.getUint32(4*Y);return at},K.initTable=function(){var N=this.sBox,B=this.invSBox,at=this.subMix,Y=at[0],J=at[1],$=at[2],z=at[3],C=this.invSubMix,k=C[0],v=C[1],E=C[2],T=C[3],w=new Uint32Array(256),H=0,j=0,I=0;for(I=0;I<256;I++)w[I]=I<128?I<<1:I<<1^283;for(I=0;I<256;I++){var Z=j^j<<1^j<<2^j<<3^j<<4;N[H]=Z=Z>>>8^255&Z^99,B[Z]=H;var lt=w[H],ct=w[lt],rt=w[ct],mt=257*w[Z]^16843008*Z;Y[H]=mt<<24|mt>>>8,J[H]=mt<<16|mt>>>16,$[H]=mt<<8|mt>>>24,z[H]=mt,k[Z]=(mt=16843009*rt^65537*ct^257*lt^16843008*H)<<24|mt>>>8,v[Z]=mt<<16|mt>>>16,E[Z]=mt<<8|mt>>>24,T[Z]=mt,H?(H=lt^w[w[w[rt^lt]]],j^=w[w[j]]):H=j=1}},K.expandKey=function(N){for(var B=this.uint8ArrayToUint32Array_(N),at=!0,Y=0;Y<B.length&&at;)at=B[Y]===this.key[Y],Y++;if(!at){this.key=B;var J=this.keySize=B.length;if(4!==J&&6!==J&&8!==J)throw new Error("Invalid aes key size="+J);var $,z,C,k,v=this.ksRows=4*(J+6+1),E=this.keySchedule=new Uint32Array(v),T=this.invKeySchedule=new Uint32Array(v),w=this.sBox,H=this.rcon,j=this.invSubMix,I=j[0],Z=j[1],lt=j[2],ct=j[3];for($=0;$<v;$++)$<J?C=E[$]=B[$]:(k=C,$%J==0?(k=w[(k=k<<8|k>>>24)>>>24]<<24|w[k>>>16&255]<<16|w[k>>>8&255]<<8|w[255&k],k^=H[$/J|0]<<24):J>6&&$%J==4&&(k=w[k>>>24]<<24|w[k>>>16&255]<<16|w[k>>>8&255]<<8|w[255&k]),E[$]=C=(E[$-J]^k)>>>0);for(z=0;z<v;z++)$=v-z,k=3&z?E[$]:E[$-4],T[z]=z<4||$<=4?k:I[w[k>>>24]]^Z[w[k>>>16&255]]^lt[w[k>>>8&255]]^ct[w[255&k]],T[z]=T[z]>>>0}},K.networkToHostOrderSwap=function(N){return N<<24|(65280&N)<<8|(16711680&N)>>8|N>>>24},K.decrypt=function(N,B,at){for(var J,$,z,C,k,v,E,T,w,H,j,I,Z,lt=this.keySize+6,ct=this.invKeySchedule,rt=this.invSBox,mt=this.invSubMix,bt=mt[0],Dt=mt[1],Tt=mt[2],It=mt[3],At=this.uint8ArrayToUint32Array_(at),jt=At[0],Qt=At[1],Jt=At[2],Bt=At[3],_t=new Int32Array(N),Ht=new Int32Array(_t.length),Ft=this.networkToHostOrderSwap;B<_t.length;){for(T=Ft(_t[B]),w=Ft(_t[B+1]),H=Ft(_t[B+2]),j=Ft(_t[B+3]),C=T^ct[0],k=j^ct[1],v=H^ct[2],E=w^ct[3],I=4,Z=1;Z<lt;Z++)J=bt[k>>>24]^Dt[v>>16&255]^Tt[E>>8&255]^It[255&C]^ct[I+1],$=bt[v>>>24]^Dt[E>>16&255]^Tt[C>>8&255]^It[255&k]^ct[I+2],z=bt[E>>>24]^Dt[C>>16&255]^Tt[k>>8&255]^It[255&v]^ct[I+3],C=bt[C>>>24]^Dt[k>>16&255]^Tt[v>>8&255]^It[255&E]^ct[I],k=J,v=$,E=z,I+=4;J=rt[k>>>24]<<24^rt[v>>16&255]<<16^rt[E>>8&255]<<8^rt[255&C]^ct[I+1],$=rt[v>>>24]<<24^rt[E>>16&255]<<16^rt[C>>8&255]<<8^rt[255&k]^ct[I+2],z=rt[E>>>24]<<24^rt[C>>16&255]<<16^rt[k>>8&255]<<8^rt[255&v]^ct[I+3],Ht[B]=Ft(rt[C>>>24]<<24^rt[k>>16&255]<<16^rt[v>>8&255]<<8^rt[255&E]^ct[I]^jt),Ht[B+1]=Ft(z^Qt),Ht[B+2]=Ft($^Jt),Ht[B+3]=Ft(J^Bt),jt=T,Qt=w,Jt=H,Bt=j,B+=4}return Ht.buffer},F}(),R=W(1),Q=W(6),q=function(){function F(N,B,at){var Y=(void 0===at?{}:at).removePKCS7Padding,J=void 0===Y||Y;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=N,this.config=B,this.removePKCS7Padding=J,J)try{var $=self.crypto;$&&(this.subtle=$.subtle||$.webkitSubtle)}catch{}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var K=F.prototype;return K.destroy=function(){this.observer=null},K.isSync=function(){return this.config.enableSoftwareAES},K.flush=function(){var N=this.currentResult;if(N){var B,at,Y,J=new Uint8Array(N);return this.reset(),this.removePKCS7Padding?(Y=(at=(B=J).byteLength)&&new DataView(B.buffer).getUint8(at-1))?Object(f.a)(B,0,at-Y):B:J}this.reset()},K.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},K.decrypt=function(N,B,at,Y){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(N),B,at);var J=this.flush();J&&Y(J.buffer)}else this.webCryptoDecrypt(new Uint8Array(N),B,at).then(Y)},K.softwareDecrypt=function(N,B,at){var Y=this.currentIV,J=this.currentResult,$=this.remainderData;this.logOnce("JS AES decrypt"),$&&(N=Object(Q.a)($,N),this.remainderData=null);var z=this.getValidChunk(N);if(!z.length)return null;Y&&(at=Y);var C=this.softwareDecrypter;C||(C=this.softwareDecrypter=new M),C.expandKey(B);var k=J;return this.currentResult=C.decrypt(z.buffer,0,at),this.currentIV=Object(f.a)(z,-16).buffer,k||null},K.webCryptoDecrypt=function(N,B,at){var Y=this,J=this.subtle;return this.key===B&&this.fastAesKey||(this.key=B,this.fastAesKey=new _(J,B)),this.fastAesKey.expandKey().then(function($){return J?new tt(J,at).decrypt(N.buffer,$):Promise.reject(new Error("web crypto not initialized"))}).catch(function($){return Y.onWebCryptoError($,N,B,at)})},K.onWebCryptoError=function(N,B,at,Y){return R.b.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",N),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(B,at,Y)},K.getValidChunk=function(N){var B=N,at=N.length-N.length%16;return at!==N.length&&(B=Object(f.a)(N,0,at),this.remainderData=Object(f.a)(N,at)),B},K.logOnce=function(N){this.logEnabled&&(R.b.log("[decrypter.ts]: "+N),this.logEnabled=!1)},F}()},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return $}),W.d(ft,"b",function(){return z});var tt=W(3),_=function(){function v(){}return v.getSilentFrame=function(E,T){if("mp4a.40.2"===E){if(1===T)return new Uint8Array([0,200,0,128,35,128]);if(2===T)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===T)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===T)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===T)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===T)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===T)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===T)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===T)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},v}(),f=Math.pow(2,32)-1,M=function(){function v(){}return v.init=function(){var E;for(E in v.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})v.types.hasOwnProperty(E)&&(v.types[E]=[E.charCodeAt(0),E.charCodeAt(1),E.charCodeAt(2),E.charCodeAt(3)]);var T=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),w=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);v.HDLR_TYPES={video:T,audio:w};var H=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),j=new Uint8Array([0,0,0,0,0,0,0,0]);v.STTS=v.STSC=v.STCO=j,v.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),v.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),v.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),v.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var I=new Uint8Array([105,115,111,109]),Z=new Uint8Array([97,118,99,49]),lt=new Uint8Array([0,0,0,1]);v.FTYP=v.box(v.types.ftyp,I,lt,I,Z),v.DINF=v.box(v.types.dinf,v.box(v.types.dref,H))},v.box=function(E){for(var T=8,w=arguments.length,H=new Array(w>1?w-1:0),j=1;j<w;j++)H[j-1]=arguments[j];for(var I=H.length,Z=I;I--;)T+=H[I].byteLength;var lt=new Uint8Array(T);for(lt[0]=T>>24&255,lt[1]=T>>16&255,lt[2]=T>>8&255,lt[3]=255&T,lt.set(E,4),I=0,T=8;I<Z;I++)lt.set(H[I],T),T+=H[I].byteLength;return lt},v.hdlr=function(E){return v.box(v.types.hdlr,v.HDLR_TYPES[E])},v.mdat=function(E){return v.box(v.types.mdat,E)},v.mdhd=function(E,T){T*=E;var w=Math.floor(T/(f+1)),H=Math.floor(T%(f+1));return v.box(v.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,E>>24&255,E>>16&255,E>>8&255,255&E,w>>24,w>>16&255,w>>8&255,255&w,H>>24,H>>16&255,H>>8&255,255&H,85,196,0,0]))},v.mdia=function(E){return v.box(v.types.mdia,v.mdhd(E.timescale,E.duration),v.hdlr(E.type),v.minf(E))},v.mfhd=function(E){return v.box(v.types.mfhd,new Uint8Array([0,0,0,0,E>>24,E>>16&255,E>>8&255,255&E]))},v.minf=function(E){return v.box(v.types.minf,"audio"===E.type?v.box(v.types.smhd,v.SMHD):v.box(v.types.vmhd,v.VMHD),v.DINF,v.stbl(E))},v.moof=function(E,T,w){return v.box(v.types.moof,v.mfhd(E),v.traf(w,T))},v.moov=function(E){for(var T=E.length,w=[];T--;)w[T]=v.trak(E[T]);return v.box.apply(null,[v.types.moov,v.mvhd(E[0].timescale,E[0].duration)].concat(w).concat(v.mvex(E)))},v.mvex=function(E){for(var T=E.length,w=[];T--;)w[T]=v.trex(E[T]);return v.box.apply(null,[v.types.mvex].concat(w))},v.mvhd=function(E,T){T*=E;var w=Math.floor(T/(f+1)),H=Math.floor(T%(f+1)),j=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,E>>24&255,E>>16&255,E>>8&255,255&E,w>>24,w>>16&255,w>>8&255,255&w,H>>24,H>>16&255,H>>8&255,255&H,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return v.box(v.types.mvhd,j)},v.sdtp=function(E){var T,w,H=E.samples||[],j=new Uint8Array(4+H.length);for(T=0;T<H.length;T++)j[T+4]=(w=H[T].flags).dependsOn<<4|w.isDependedOn<<2|w.hasRedundancy;return v.box(v.types.sdtp,j)},v.stbl=function(E){return v.box(v.types.stbl,v.stsd(E),v.box(v.types.stts,v.STTS),v.box(v.types.stsc,v.STSC),v.box(v.types.stsz,v.STSZ),v.box(v.types.stco,v.STCO))},v.avc1=function(E){var T,w,H,j=[],I=[];for(T=0;T<E.sps.length;T++)H=(w=E.sps[T]).byteLength,j.push(H>>>8&255),j.push(255&H),j=j.concat(Array.prototype.slice.call(w));for(T=0;T<E.pps.length;T++)H=(w=E.pps[T]).byteLength,I.push(H>>>8&255),I.push(255&H),I=I.concat(Array.prototype.slice.call(w));var Z=v.box(v.types.avcC,new Uint8Array([1,j[3],j[4],j[5],255,224|E.sps.length].concat(j).concat([E.pps.length]).concat(I))),lt=E.width,ct=E.height,rt=E.pixelRatio[0],mt=E.pixelRatio[1];return v.box(v.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,lt>>8&255,255&lt,ct>>8&255,255&ct,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Z,v.box(v.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),v.box(v.types.pasp,new Uint8Array([rt>>24,rt>>16&255,rt>>8&255,255&rt,mt>>24,mt>>16&255,mt>>8&255,255&mt])))},v.esds=function(E){var T=E.config.length;return new Uint8Array([0,0,0,0,3,23+T,0,1,0,4,15+T,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([T]).concat(E.config).concat([6,1,2]))},v.mp4a=function(E){var T=E.samplerate;return v.box(v.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E.channelCount,0,16,0,0,0,0,T>>8&255,255&T,0,0]),v.box(v.types.esds,v.esds(E)))},v.mp3=function(E){var T=E.samplerate;return v.box(v.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E.channelCount,0,16,0,0,0,0,T>>8&255,255&T,0,0]))},v.stsd=function(E){return v.box(v.types.stsd,v.STSD,"audio"===E.type?E.isAAC||"mp3"!==E.codec?v.mp4a(E):v.mp3(E):v.avc1(E))},v.tkhd=function(E){var T=E.id,w=E.duration*E.timescale,H=E.width,j=E.height,I=Math.floor(w/(f+1)),Z=Math.floor(w%(f+1));return v.box(v.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,255&T,0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I,Z>>24,Z>>16&255,Z>>8&255,255&Z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,H>>8&255,255&H,0,0,j>>8&255,255&j,0,0]))},v.traf=function(E,T){var w=v.sdtp(E),H=E.id,j=Math.floor(T/(f+1)),I=Math.floor(T%(f+1));return v.box(v.types.traf,v.box(v.types.tfhd,new Uint8Array([0,0,0,0,H>>24,H>>16&255,H>>8&255,255&H])),v.box(v.types.tfdt,new Uint8Array([1,0,0,0,j>>24,j>>16&255,j>>8&255,255&j,I>>24,I>>16&255,I>>8&255,255&I])),v.trun(E,w.length+16+20+8+16+8+8),w)},v.trak=function(E){return E.duration=E.duration||4294967295,v.box(v.types.trak,v.tkhd(E),v.mdia(E))},v.trex=function(E){var T=E.id;return v.box(v.types.trex,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,255&T,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},v.trun=function(E,T){var w,H,j,I,Z,lt,ct=E.samples||[],rt=ct.length,mt=12+16*rt,bt=new Uint8Array(mt);for(bt.set([0,0,15,1,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt,(T+=8+mt)>>>24&255,T>>>16&255,T>>>8&255,255&T],0),w=0;w<rt;w++)j=(H=ct[w]).duration,bt.set([j>>>24&255,j>>>16&255,j>>>8&255,255&j,(I=H.size)>>>24&255,I>>>16&255,I>>>8&255,255&I,(Z=H.flags).isLeading<<2|Z.dependsOn,Z.isDependedOn<<6|Z.hasRedundancy<<4|Z.paddingValue<<1|Z.isNonSync,61440&Z.degradPrio,15&Z.degradPrio,(lt=H.cts)>>>24&255,lt>>>16&255,lt>>>8&255,255&lt],12+16*w);return v.box(v.types.trun,bt)},v.initSegment=function(E){v.types||v.init();var T=v.moov(E),w=new Uint8Array(v.FTYP.byteLength+T.byteLength);return w.set(v.FTYP),w.set(T,v.FTYP.byteLength),w},v}();M.types=void 0,M.HDLR_TYPES=void 0,M.STTS=void 0,M.STSC=void 0,M.STCO=void 0,M.STSZ=void 0,M.VMHD=void 0,M.SMHD=void 0,M.STSD=void 0,M.FTYP=void 0,M.DINF=void 0;var R=M,Q=W(0),q=W(2),F=W(1),K=W(4),N=W(8);function B(){return(B=Object.assign||function(v){for(var E=1;E<arguments.length;E++){var T=arguments[E];for(var w in T)Object.prototype.hasOwnProperty.call(T,w)&&(v[w]=T[w])}return v}).apply(this,arguments)}var at=null,Y=null,J=!1,$=function(){function v(T,w,H,j){if(void 0===j&&(j=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=T,this.config=w,this.typeSupported=H,this.ISGenerated=!1,null===at){var I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);at=I?parseInt(I[1]):0}if(null===Y){var Z=navigator.userAgent.match(/Safari\/(\d+)/i);Y=Z?parseInt(Z[1]):0}J=!!at&&at<75||!!Y&&Y<600}var E=v.prototype;return E.destroy=function(){},E.resetTimeStamp=function(T){F.b.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=T},E.resetNextTimestamp=function(){F.b.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},E.resetInitSegment=function(){F.b.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},E.getVideoStartPts=function(T){var w=!1,H=T.reduce(function(j,I){var Z=I.pts-j;return Z<-4294967296?(w=!0,z(j,I.pts)):Z>0?j:I.pts},T[0].pts);return w&&F.b.debug("PTS rollover detected"),H},E.remux=function(T,w,H,j,I,Z,lt,ct){var rt,mt,bt,Dt,Tt,It,At=I,jt=I,Jt=w.pid>-1,Bt=w.samples.length,_t=T.samples.length>0,Ht=Bt>1;if((!(T.pid>-1)||_t)&&(!Jt||Ht)||this.ISGenerated||lt){this.ISGenerated||(bt=this.generateIS(T,w,I));var Ft=this.isVideoContiguous,Nt=-1;if(Ht&&(Nt=function(re){for(var $t=0;$t<re.length;$t++)if(re[$t].key)return $t;return-1}(w.samples),!Ft&&this.config.forceKeyFrameOnDiscontinuity))if(It=!0,Nt>0){F.b.warn("[mp4-remuxer]: Dropped "+Nt+" out of "+Bt+" video samples due to a missing keyframe");var oe=this.getVideoStartPts(w.samples);w.samples=w.samples.slice(Nt),w.dropped+=Nt,jt+=(w.samples[0].pts-oe)/(w.timescale||9e4)}else-1===Nt&&(F.b.warn("[mp4-remuxer]: No keyframe found out of "+Bt+" video samples"),It=!1);if(this.ISGenerated){if(_t&&Ht){var Yt=this.getVideoStartPts(w.samples),ge=(z(T.samples[0].pts,Yt)-Yt)/w.inputTimeScale;At+=Math.max(0,ge),jt+=Math.max(0,-ge)}if(_t){if(T.samplerate||(F.b.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),bt=this.generateIS(T,w,I)),mt=this.remuxAudio(T,At,this.isAudioContiguous,Z,Jt||Ht||ct===K.b.AUDIO?jt:void 0),Ht){var ve=mt?mt.endPTS-mt.startPTS:0;w.inputTimeScale||(F.b.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),bt=this.generateIS(T,w,I)),rt=this.remuxVideo(w,jt,Ft,ve)}}else Ht&&(rt=this.remuxVideo(w,jt,Ft,0));rt&&(rt.firstKeyFrame=Nt,rt.independent=-1!==Nt)}}return this.ISGenerated&&(H.samples.length&&(Tt=this.remuxID3(H,I)),j.samples.length&&(Dt=this.remuxText(j,I))),{audio:mt,video:rt,initSegment:bt,independent:It,text:Dt,id3:Tt}},E.generateIS=function(T,w,H){var j,I,Z,lt=T.samples,ct=w.samples,rt=this.typeSupported,mt={},bt=!Object(tt.a)(this._initPTS),Dt="audio/mp4";if(bt&&(j=I=1/0),T.config&&lt.length&&(T.timescale=T.samplerate,T.isAAC||(rt.mpeg?(Dt="audio/mpeg",T.codec=""):rt.mp3&&(T.codec="mp3")),mt.audio={id:"audio",container:Dt,codec:T.codec,initSegment:!T.isAAC&&rt.mpeg?new Uint8Array(0):R.initSegment([T]),metadata:{channelCount:T.channelCount}},bt&&(Z=T.inputTimeScale,j=I=lt[0].pts-Math.round(Z*H))),w.sps&&w.pps&&ct.length&&(w.timescale=w.inputTimeScale,mt.video={id:"main",container:"video/mp4",codec:w.codec,initSegment:R.initSegment([w]),metadata:{width:w.width,height:w.height}},bt)){Z=w.inputTimeScale;var Tt=this.getVideoStartPts(ct),It=Math.round(Z*H);I=Math.min(I,z(ct[0].dts,Tt)-It),j=Math.min(j,Tt-It)}if(Object.keys(mt).length)return this.ISGenerated=!0,bt&&(this._initPTS=j,this._initDTS=I),{tracks:mt,initPTS:j,timescale:Z}},E.remuxVideo=function(T,w,H,j){var I,Z,lt,ct=T.inputTimeScale,rt=T.samples,mt=[],bt=rt.length,Dt=this._initPTS,Tt=this.nextAvcDts,It=8,At=Number.POSITIVE_INFINITY,jt=Number.NEGATIVE_INFINITY,Qt=0,Jt=!1;H&&null!==Tt||(Tt=w*ct-(rt[0].pts-z(rt[0].dts,rt[0].pts)));for(var Bt=0;Bt<bt;Bt++){var _t=rt[Bt];_t.pts=z(_t.pts-Dt,Tt),_t.dts=z(_t.dts-Dt,Tt),_t.dts>_t.pts&&(Qt=Math.max(Math.min(Qt,_t.pts-_t.dts),-18e3)),_t.dts<rt[Bt>0?Bt-1:Bt].dts&&(Jt=!0)}Jt&&rt.sort(function(st,ht){return st.dts-ht.dts||st.pts-ht.pts}),Z=rt[0].dts,lt=rt[rt.length-1].dts;var Ht=Math.round((lt-Z)/(bt-1));if(Qt<0){if(Qt<-2*Ht){F.b.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(N.b)(-Ht,!0)+" ms");for(var Ft=Qt,Nt=0;Nt<bt;Nt++)rt[Nt].dts=Ft=Math.max(Ft,rt[Nt].pts-Ht),rt[Nt].pts=Math.max(Ft,rt[Nt].pts)}else{F.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(N.b)(Qt,!0)+" ms to overcome this issue");for(var oe=0;oe<bt;oe++)rt[oe].dts=rt[oe].dts+Qt}Z=rt[0].dts}if(H){var Yt=Z-Tt,ge=Yt>Ht;if(ge||Yt<-1){F.b.warn(ge?"AVC: "+Object(N.b)(Yt,!0)+" ms ("+Yt+"dts) hole between fragments detected, filling it":"AVC: "+Object(N.b)(-Yt,!0)+" ms ("+Yt+"dts) overlapping between fragments detected");var ve=rt[0].pts-Yt;rt[0].dts=Z=Tt,rt[0].pts=ve,F.b.log("Video: First PTS/DTS adjusted: "+Object(N.b)(ve,!0)+"/"+Object(N.b)(Z,!0)+", delta: "+Object(N.b)(Yt,!0)+" ms")}}J&&(Z=Math.max(0,Z));for(var re=0,$t=0,le=0;le<bt;le++){for(var qt=rt[le],Pt=qt.units,De=Pt.length,pe=0,ie=0;ie<De;ie++)pe+=Pt[ie].data.length;$t+=pe,re+=De,qt.length=pe,qt.dts=Math.max(qt.dts,Z),qt.pts=Math.max(qt.pts,qt.dts,0),At=Math.min(qt.pts,At),jt=Math.max(qt.pts,jt)}lt=rt[bt-1].dts;var ue,Zt=$t+4*re+8;try{ue=new Uint8Array(Zt)}catch{return void this.observer.emit(Q.a.ERROR,Q.a.ERROR,{type:q.b.MUX_ERROR,details:q.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Zt,reason:"fail allocating video mdat "+Zt})}var he=new DataView(ue.buffer);he.setUint32(0,Zt),ue.set(R.types.mdat,4);for(var te=0;te<bt;te++){for(var Ct=rt[te],Te=Ct.units,Le=0,be=0,ke=Te.length;be<ke;be++){var O=Te[be],A=O.data,m=O.data.byteLength;he.setUint32(It,m),ue.set(A,It+=4),It+=m,Le+=4+m}if(te<bt-1)I=rt[te+1].dts-Ct.dts;else{var b=this.config,L=Ct.dts-rt[te>0?te-1:te].dts;if(b.stretchShortVideoTrack&&null!==this.nextAudioPts){var P=Math.floor(b.maxBufferHole*ct),x=(j?At+j*ct:this.nextAudioPts)-Ct.pts;x>P?((I=x-L)<0&&(I=L),F.b.log("[mp4-remuxer]: It is approximately "+x/90+" ms to the next segment; using duration "+I/90+" ms for the last video frame.")):I=L}else I=L}var G=Math.round(Ct.pts-Ct.dts);mt.push(new C(Ct.key,I,Le,G))}if(mt.length&&at&&at<70){var X=mt[0].flags;X.dependsOn=2,X.isNonSync=0}this.nextAvcDts=Tt=lt+I,this.isVideoContiguous=!0;var ot={data1:R.moof(T.sequenceNumber++,Z,B({},T,{samples:mt})),data2:ue,startPTS:At/ct,endPTS:(jt+I)/ct,startDTS:Z/ct,endDTS:Tt/ct,type:"video",hasAudio:!1,hasVideo:!0,nb:mt.length,dropped:T.dropped};return T.samples=[],T.dropped=0,ot},E.remuxAudio=function(T,w,H,j,I){var Z=T.inputTimeScale,lt=Z/(T.samplerate?T.samplerate:Z),ct=T.isAAC?1024:1152,rt=ct*lt,mt=this._initPTS,bt=!T.isAAC&&this.typeSupported.mpeg,Dt=[],Tt=T.samples,It=bt?0:8,At=this.nextAudioPts||-1,jt=w*Z;if(this.isAudioContiguous=H=H||Tt.length&&At>0&&(j&&Math.abs(jt-At)<9e3||Math.abs(z(Tt[0].pts-mt,jt)-At)<20*rt),Tt.forEach(function(A){A.pts=z(A.pts-mt,jt)}),!H||At<0){if(!(Tt=Tt.filter(function(A){return A.pts>=0})).length)return;At=0===I?0:j?Math.max(0,jt):Tt[0].pts}if(T.isAAC)for(var Qt=void 0!==I,Jt=this.config.maxAudioFramesDrift,Bt=0,_t=At;Bt<Tt.length;Bt++){var Ht=Tt[Bt],Ft=Ht.pts,Nt=Ft-_t,oe=Math.abs(1e3*Nt/Z);if(Nt<=-Jt*rt&&Qt)0===Bt&&(F.b.warn("Audio frame @ "+(Ft/Z).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Nt/Z)+" ms."),this.nextAudioPts=At=_t=Ft);else if(Nt>=Jt*rt&&oe<1e4&&Qt){var Yt=Math.round(Nt/rt);(_t=Ft-Yt*rt)<0&&(Yt--,_t+=rt),0===Bt&&(this.nextAudioPts=At=_t),F.b.warn("[mp4-remuxer]: Injecting "+Yt+" audio frame @ "+(_t/Z).toFixed(3)+"s due to "+Math.round(1e3*Nt/Z)+" ms gap.");for(var ge=0;ge<Yt;ge++){var ve=Math.max(_t,0),re=_.getSilentFrame(T.manifestCodec||T.codec,T.channelCount);re||(F.b.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),re=Ht.unit.subarray()),Tt.splice(Bt,0,{unit:re,pts:ve}),_t+=rt,Bt++}}Ht.pts=_t,_t+=rt}for(var $t,le=null,qt=null,Pt=0,De=Tt.length;De--;)Pt+=Tt[De].unit.byteLength;for(var pe=0,ie=Tt.length;pe<ie;pe++){var ue=Tt[pe],Zt=ue.unit,he=ue.pts;if(null!==qt)Dt[pe-1].duration=Math.round((he-qt)/lt);else{if(H&&T.isAAC&&(he=At),le=he,!(Pt>0))return;Pt+=It;try{$t=new Uint8Array(Pt)}catch{return void this.observer.emit(Q.a.ERROR,Q.a.ERROR,{type:q.b.MUX_ERROR,details:q.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Pt,reason:"fail allocating audio mdat "+Pt})}bt||(new DataView($t.buffer).setUint32(0,Pt),$t.set(R.types.mdat,4))}$t.set(Zt,It);var te=Zt.byteLength;It+=te,Dt.push(new C(!0,ct,te,0)),qt=he}var Ct=Dt.length;if(Ct){this.nextAudioPts=At=qt+lt*Dt[Dt.length-1].duration;var Le=bt?new Uint8Array(0):R.moof(T.sequenceNumber++,le/lt,B({},T,{samples:Dt}));T.samples=[];var be=le/Z,ke=At/Z,O={data1:Le,data2:$t,startPTS:be,endPTS:ke,startDTS:be,endDTS:ke,type:"audio",hasAudio:!0,hasVideo:!1,nb:Ct};return this.isAudioContiguous=!0,O}},E.remuxEmptyAudio=function(T,w,H,j){var I=T.inputTimeScale,lt=this.nextAudioPts,ct=(null!==lt?lt:j.startDTS*I)+this._initDTS,mt=I/(T.samplerate?T.samplerate:I)*1024,bt=Math.ceil((j.endDTS*I+this._initDTS-ct)/mt),Dt=_.getSilentFrame(T.manifestCodec||T.codec,T.channelCount);if(F.b.warn("[mp4-remuxer]: remux empty Audio"),Dt){for(var Tt=[],It=0;It<bt;It++){var At=ct+It*mt;Tt.push({unit:Dt,pts:At,dts:At})}return T.samples=Tt,this.remuxAudio(T,w,H,!1)}F.b.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},E.remuxID3=function(T,w){var H=T.samples.length;if(H){for(var j=T.inputTimeScale,I=this._initPTS,Z=this._initDTS,lt=0;lt<H;lt++){var ct=T.samples[lt];ct.pts=z(ct.pts-I,w*j)/j,ct.dts=z(ct.dts-Z,w*j)/j}var rt=T.samples;return T.samples=[],{samples:rt}}},E.remuxText=function(T,w){var H=T.samples.length;if(H){for(var j=T.inputTimeScale,I=this._initPTS,Z=0;Z<H;Z++){var lt=T.samples[Z];lt.pts=z(lt.pts-I,w*j)/j}T.samples.sort(function(rt,mt){return rt.pts-mt.pts});var ct=T.samples;return T.samples=[],{samples:ct}}},v}();function z(v,E){var T;if(null===E)return v;for(T=E<v?-8589934592:8589934592;Math.abs(v-E)>4294967296;)v+=T;return v}var C=function(v,E,T,w){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=E,this.size=T,this.cts=w,this.flags=new k(v)},k=function(v){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=v?2:1,this.isNonSync=v?0:1}},function(Kt,ft,W){"use strict";W.d(ft,"a",function(){return f});var tt=W(11);var f=function(){function M(F,K){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=K?Object(tt.buildAbsoluteURL)(F,K,{alwaysNormalize:!0}):F}var Q;return M.fromURL=function(F,K){return new M(F,K)},M.fromURI=function(F){return new M(F)},(Q=[{key:"uri",get:function(){return this._uri}}])&&function _(M,R){for(var Q=0;Q<R.length;Q++){var q=R[Q];q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(M,q.key,q)}}(M.prototype,Q),M}()},function(Kt,ft,W){function tt(R){var Q={};function q(K){if(Q[K])return Q[K].exports;var N=Q[K]={i:K,l:!1,exports:{}};return R[K].call(N.exports,N,N.exports,q),N.l=!0,N.exports}q.m=R,q.c=Q,q.i=function(K){return K},q.d=function(K,N,B){q.o(K,N)||Object.defineProperty(K,N,{configurable:!1,enumerable:!0,get:B})},q.r=function(K){Object.defineProperty(K,"__esModule",{value:!0})},q.n=function(K){var N=K&&K.__esModule?function(){return K.default}:function(){return K};return q.d(N,"a",N),N},q.o=function(K,N){return Object.prototype.hasOwnProperty.call(K,N)},q.p="/",q.oe=function(K){throw console.error(K),K};var F=q(q.s=ENTRY_MODULE);return F.default||F}function _(R){return(R+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(R,Q,q){var F={};F[q]=[];var K=Q.toString(),N=K.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!N)return F;for(var B,at=N[1],Y=new RegExp("(\\\\n|\\W)"+_(at)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");B=Y.exec(K);)"dll-reference"!==B[3]&&F[q].push(B[3]);for(Y=new RegExp("\\("+_(at)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");B=Y.exec(K);)R[B[2]]||(F[q].push(B[1]),R[B[2]]=W(B[1]).m),F[B[2]]=F[B[2]]||[],F[B[2]].push(B[4]);for(var $=Object.keys(F),z=0;z<$.length;z++)for(var C=0;C<F[$[z]].length;C++)isNaN(1*F[$[z]][C])||(F[$[z]][C]=1*F[$[z]][C]);return F}function M(R){return Object.keys(R).reduce(function(Q,q){return Q||R[q].length>0},!1)}Kt.exports=function(R,Q){var q={main:W.m},F=(Q=Q||{}).all?{main:Object.keys(q.main)}:function(Y,J){for(var $={main:[J]},z={main:[]},C={main:{}};M($);)for(var k=Object.keys($),v=0;v<k.length;v++){var E=k[v],T=$[E].pop();if(C[E]=C[E]||{},!C[E][T]&&Y[E][T]){C[E][T]=!0,z[E]=z[E]||[],z[E].push(T);for(var w=f(Y,Y[E][T],E),H=Object.keys(w),j=0;j<H.length;j++)$[H[j]]=$[H[j]]||[],$[H[j]]=$[H[j]].concat(w[H[j]])}}return z}(q,R),K="";Object.keys(F).filter(function(Y){return"main"!==Y}).forEach(function(Y){for(var J=0;F[Y][J];)J++;F[Y].push(J),q[Y][J]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",K=K+"var "+Y+" = ("+tt.toString().replace("ENTRY_MODULE",JSON.stringify(J))+")({"+F[Y].map(function($){return JSON.stringify($)+": "+q[Y][$].toString()}).join(",")+"});\n"}),K=K+"new (("+tt.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+F.main.map(function(Y){return JSON.stringify(Y)+": "+q.main[Y].toString()}).join(",")+"}))(self);";var N=new window.Blob([K],{type:"text/javascript"});if(Q.bare)return N;var B=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(N),at=new window.Worker(B);return at.objectURL=B,at}},function(Kt,ft,W){"use strict";W.r(ft),W.d(ft,"default",function(){return R});var tt=W(10),_=W(0),f=W(1),M=W(14);function R(K){var N=new M.EventEmitter,B=function(at,Y){K.postMessage({event:at,data:Y})};N.on(_.a.FRAG_DECRYPTED,B),N.on(_.a.ERROR,B),K.addEventListener("message",function(at){var Y=at.data;switch(Y.cmd){case"init":var J=JSON.parse(Y.config);K.transmuxer=new tt.c(N,Y.typeSupported,J,Y.vendor,Y.id),Object(f.a)(J.debug),B("init",null);break;case"configure":K.transmuxer.configure(Y.config);break;case"demux":var $=K.transmuxer.push(Y.data,Y.decryptdata,Y.chunkMeta,Y.state);Object(tt.d)($)?$.then(function(k){Q(K,k)}):Q(K,$);break;case"flush":var z=Y.chunkMeta,C=K.transmuxer.flush(z);Object(tt.d)(C)?C.then(function(k){F(K,k,z)}):F(K,C,z)}})}function Q(K,N){if((B=N.remuxResult).audio||B.video||B.text||B.id3||B.initSegment){var B,at=[],Y=N.remuxResult,J=Y.audio,$=Y.video;J&&q(at,J),$&&q(at,$),K.postMessage({event:"transmuxComplete",data:N},at)}}function q(K,N){N.data1&&K.push(N.data1.buffer),N.data2&&K.push(N.data2.buffer)}function F(K,N,B){N.forEach(function(at){Q(K,at)}),K.postMessage({event:"flush",data:B})}},function(Kt,ft,W){"use strict";W.r(ft),W.d(ft,"default",function(){return oi});var tt=W(11),_=W(3),f=W(0),M=W(2),R=W(1),Q=W(6),q=W(5);var K=function(){function d(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=n}var t;return d.prototype.reloaded=function(n){if(!n)return this.advanced=!0,void(this.updated=!0);var r=this.lastPartSn-n.lastPartSn,o=this.lastPartIndex-n.lastPartIndex;this.updated=this.endSN!==n.endSN||!!o||!!r,this.advanced=this.endSN>n.endSN||r>0||0===r&&o>0,this.misses=this.updated||this.advanced?Math.floor(.6*n.misses):n.misses+1,this.availabilityDelay=n.availabilityDelay},(t=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(_.a)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var n=this.driftEndTime-this.driftStartTime;return n>0?1e3*(this.driftEnd-this.driftStart)/n:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var n;return null!==(n=this.partList)&&void 0!==n&&n.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var n;return null!==(n=this.fragments)&&void 0!==n&&n.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var n;return null!==(n=this.partList)&&void 0!==n&&n.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var n;return null!==(n=this.partList)&&void 0!==n&&n.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&function F(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(d.prototype,t),d}(),N=W(17),B=/^(\d+)x(\d+)$/,at=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Y=function(){function d(t){for(var e in"string"==typeof t&&(t=d.parseAttrList(t)),t)t.hasOwnProperty(e)&&(this[e]=t[e])}var s=d.prototype;return s.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},s.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)n[r]=parseInt(e.slice(2*r,2*r+2),16);return n}return null},s.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},s.decimalFloatingPoint=function(t){return parseFloat(this[t])},s.optionalFloat=function(t,e){var n=this[t];return n?parseFloat(n):e},s.enumeratedString=function(t){return this[t]},s.bool=function(t){return"YES"===this[t]},s.decimalResolution=function(t){var e=B.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},d.parseAttrList=function(t){var e,n={};for(at.lastIndex=0;null!==(e=at.exec(t));){var r=e[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[e[1]]=r}return n},d}(),J={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function $(d,s){return MediaSource.isTypeSupported((s||"video")+'/mp4;codecs="'+d+'"')}var z=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,C=/#EXT-X-MEDIA:(.*)/g,k=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),v=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),E=/\.(mp4|m4s|m4v|m4a)$/i,T=function(){function d(){}return d.findGroup=function(s,t){for(var e=0;e<s.length;e++){var n=s[e];if(n.id===t)return n}},d.convertAVC1ToAVCOTI=function(s){var t=s.split(".");if(t.length>2){var e=t.shift()+".";return(e+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).substr(-4)}return s},d.resolve=function(s,t){return tt.buildAbsoluteURL(t,s,{alwaysNormalize:!0})},d.parseMasterPlaylist=function(s,t){var e,n=[],r={},o=!1;for(z.lastIndex=0;null!=(e=z.exec(s));)if(e[1]){var l=new Y(e[1]),i={attrs:l,bitrate:l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),name:l.NAME,url:d.resolve(e[2],t)},a=l.decimalResolution("RESOLUTION");a&&(i.width=a.width,i.height=a.height),w((l.CODECS||"").split(/[ ,]+/).filter(function(h){return h}),i),i.videoCodec&&-1!==i.videoCodec.indexOf("avc1")&&(i.videoCodec=d.convertAVC1ToAVCOTI(i.videoCodec)),n.push(i)}else if(e[3]){var u=new Y(e[3]);u["DATA-ID"]&&(o=!0,r[u["DATA-ID"]]=u)}return{levels:n,sessionData:o?r:null}},d.parseMasterPlaylistMedia=function(s,t,e,n){var r;void 0===n&&(n=[]);var o=[],l=0;for(C.lastIndex=0;null!==(r=C.exec(s));){var i=new Y(r[1]);if(i.TYPE===e){var a={attrs:i,bitrate:0,id:l++,groupId:i["GROUP-ID"],instreamId:i["INSTREAM-ID"],name:i.NAME||i.LANGUAGE||"",type:e,default:i.bool("DEFAULT"),autoselect:i.bool("AUTOSELECT"),forced:i.bool("FORCED"),lang:i.LANGUAGE,url:i.URI?d.resolve(i.URI,t):""};if(n.length){var u=d.findGroup(n,a.groupId)||n[0];H(a,u,"audioCodec"),H(a,u,"textCodec")}o.push(a)}}return o},d.parseLevelPlaylist=function(s,t,e,n,r){var o,l,i,a=new K(t),u=a.fragments,h=null,c=0,g=0,p=0,y=0,S=null,D=new q.b(n,t),U=-1,V=!1;for(k.lastIndex=0,a.m3u8=s;null!==(o=k.exec(s));){V&&(V=!1,(D=new q.b(n,t)).start=p,D.sn=c,D.cc=y,D.level=e,h&&(D.initSegment=h,D.rawProgramDateTime=h.rawProgramDateTime));var it=o[1];if(it){D.duration=parseFloat(it);var et=(" "+o[2]).slice(1);D.title=et||null,D.tagList.push(et?["INF",it,et]:["INF",it])}else if(o[3])Object(_.a)(D.duration)&&(D.start=p,i&&(D.levelkey=i),D.sn=c,D.level=e,D.cc=y,D.urlId=r,u.push(D),D.relurl=(" "+o[3]).slice(1),j(D,S),S=D,p+=D.duration,c++,g=0,V=!0);else if(o[4]){var nt=(" "+o[4]).slice(1);S?D.setByteRange(nt,S):D.setByteRange(nt)}else if(o[5])D.rawProgramDateTime=(" "+o[5]).slice(1),D.tagList.push(["PROGRAM-DATE-TIME",D.rawProgramDateTime]),-1===U&&(U=u.length);else{if(!(o=o[0].match(v))){R.b.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&void 0===o[l];l++);var vt=(" "+o[l]).slice(1),dt=(" "+o[l+1]).slice(1),pt=o[l+2]?(" "+o[l+2]).slice(1):"";switch(vt){case"PLAYLIST-TYPE":a.type=dt.toUpperCase();break;case"MEDIA-SEQUENCE":c=a.startSN=parseInt(dt);break;case"SKIP":var Mt=new Y(dt),Vt=Mt.decimalInteger("SKIPPED-SEGMENTS");if(Object(_.a)(Vt)){a.skippedSegments=Vt;for(var Xt=Vt;Xt--;)u.unshift(null);c+=Vt}var Wt=Mt.enumeratedString("RECENTLY-REMOVED-DATERANGES");Wt&&(a.recentlyRemovedDateranges=Wt.split("\t"));break;case"TARGETDURATION":a.targetduration=parseFloat(dt);break;case"VERSION":a.version=parseInt(dt);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(dt||pt)&&D.tagList.push(pt?[dt,pt]:[dt]);break;case"DIS":y++;case"GAP":D.tagList.push([vt]);break;case"BITRATE":D.tagList.push([vt,dt]);break;case"DISCONTINUITY-SEQ":y=parseInt(dt);break;case"KEY":var zt,ee=new Y(dt),me=ee.enumeratedString("METHOD"),fe=ee.URI,_e=ee.hexadecimalInteger("IV"),Pe=ee.enumeratedString("KEYFORMATVERSIONS"),li=ee.enumeratedString("KEYID"),We=null!=(zt=ee.enumeratedString("KEYFORMAT"))?zt:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(We)>-1){R.b.warn("Keyformat "+We+" is not supported from the manifest");continue}if("identity"!==We)continue;me&&(i=N.a.fromURL(t,fe),fe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(me)>=0&&(i.method=me,i.keyFormat=We,li&&(i.keyID=li),Pe&&(i.keyFormatVersions=Pe),i.iv=_e));break;case"START":var ui=new Y(dt).decimalFloatingPoint("TIME-OFFSET");Object(_.a)(ui)&&(a.startTimeOffset=ui);break;case"MAP":var or=new Y(dt);D.relurl=or.URI,or.BYTERANGE&&D.setByteRange(or.BYTERANGE),D.level=e,D.sn="initSegment",i&&(D.levelkey=i),D.initSegment=null,h=D,V=!0;break;case"SERVER-CONTROL":var Fe=new Y(dt);a.canBlockReload=Fe.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=Fe.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&Fe.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=Fe.optionalFloat("PART-HOLD-BACK",0),a.holdBack=Fe.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var en=new Y(dt);a.partTarget=en.decimalFloatingPoint("PART-TARGET");break;case"PART":var Ne=a.partList;Ne||(Ne=a.partList=[]);var rn=g>0?Ne[Ne.length-1]:void 0,nn=g++,hi=new q.c(new Y(dt),D,t,nn,rn);Ne.push(hi),D.duration+=hi.duration;break;case"PRELOAD-HINT":var an=new Y(dt);a.preloadHint=an;break;case"RENDITION-REPORT":var sn=new Y(dt);a.renditionReports=a.renditionReports||[],a.renditionReports.push(sn);break;default:R.b.warn("line parsed but not handled: "+o)}}}S&&!S.relurl?(u.pop(),p-=S.duration,a.partList&&(a.fragmentHint=S)):a.partList&&(j(D,S),D.cc=y,a.fragmentHint=D);var lr=u.length,Ye=u[0],ur=u[lr-1];if((p+=a.skippedSegments*a.targetduration)>0&&lr&&ur){a.averagetargetduration=p/lr;var di=ur.sn;a.endSN="initSegment"!==di?di:0,Ye&&(a.startCC=Ye.cc,Ye.initSegment||a.fragments.every(function(Ue){return Ue.relurl&&E.test(null!=(Ge=null===(Me=tt.parseURL(Ue.relurl))||void 0===Me?void 0:Me.path)?Ge:"");var Ge,Me})&&(R.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(D=new q.b(n,t)).relurl=ur.relurl,D.level=e,D.sn="initSegment",Ye.initSegment=D,a.needSidxRanges=!0))}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(p+=a.fragmentHint.duration),a.totalduration=p,a.endCC=y,U>0&&function(Ue,Be){for(var Ge=Ue[Be],Me=Be;Me--;){var qe=Ue[Me];if(!qe)return;qe.programDateTime=Ge.programDateTime-1e3*qe.duration,Ge=qe}}(u,U),a},d}();function w(d,s){["video","audio","text"].forEach(function(t){var e=d.filter(function(r){return!!(i=J[t])&&!0===i[r.slice(0,4)];var i});if(e.length){var n=e.filter(function(r){return 0===r.lastIndexOf("avc1",0)||0===r.lastIndexOf("mp4a",0)});s[t+"Codec"]=n.length>0?n[0]:e[0],d=d.filter(function(r){return-1===e.indexOf(r)})}}),s.unknownCodecs=d}function H(d,s,t){var e=s[t];e&&(d[t]=e)}function j(d,s){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):null!=s&&s.programDateTime&&(d.programDateTime=s.endProgramDateTime),Object(_.a)(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}var I=W(4);function Z(d,s){var t=d.url;return void 0!==t&&0!==t.indexOf("data:")||(t=s.url),t}var lt=function(){function d(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var s=d.prototype;return s.registerListeners=function(){var t=this.hls;t.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(f.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(f.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(f.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},s.unregisterListeners=function(){var t=this.hls;t.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(f.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(f.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(f.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},s.createInternalLoader=function(t){var e=this.hls.config,o=new(e.pLoader||e.loader)(e);return t.loader=o,this.loaders[t.type]=o,o},s.getInternalLoader=function(t){return this.loaders[t.type]},s.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},s.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},s.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},s.onManifestLoading=function(t,e){this.load({id:null,groupId:null,level:0,responseType:"text",type:I.a.MANIFEST,url:e.url,deliveryDirectives:null})},s.onLevelLoading=function(t,e){this.load({id:e.id,groupId:null,level:e.level,responseType:"text",type:I.a.LEVEL,url:e.url,deliveryDirectives:e.deliveryDirectives})},s.onAudioTrackLoading=function(t,e){this.load({id:e.id,groupId:e.groupId,level:null,responseType:"text",type:I.a.AUDIO_TRACK,url:e.url,deliveryDirectives:e.deliveryDirectives})},s.onSubtitleTrackLoading=function(t,e){this.load({id:e.id,groupId:e.groupId,level:null,responseType:"text",type:I.a.SUBTITLE_TRACK,url:e.url,deliveryDirectives:e.deliveryDirectives})},s.load=function(t){var e,n,r,o,l,i,a=this.hls.config,u=this.getInternalLoader(t);if(u){var h=u.context;if(h&&h.url===t.url)return void R.b.trace("[playlist-loader]: playlist request ongoing");R.b.log("[playlist-loader]: aborting previous loader for type: "+t.type),u.abort()}switch(t.type){case I.a.MANIFEST:n=a.manifestLoadingMaxRetry,r=a.manifestLoadingTimeOut,o=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout;break;case I.a.LEVEL:case I.a.AUDIO_TRACK:case I.a.SUBTITLE_TRACK:n=0,r=a.levelLoadingTimeOut;break;default:n=a.levelLoadingMaxRetry,r=a.levelLoadingTimeOut,o=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(t),null!==(e=t.deliveryDirectives)&&void 0!==e&&e.part&&(t.type===I.a.LEVEL&&null!==t.level?i=this.hls.levels[t.level].details:t.type===I.a.AUDIO_TRACK&&null!==t.id?i=this.hls.audioTracks[t.id].details:t.type===I.a.SUBTITLE_TRACK&&null!==t.id&&(i=this.hls.subtitleTracks[t.id].details),i)){var c=i.partTarget,g=i.targetduration;c&&g&&(r=Math.min(1e3*Math.max(3*c,.8*g),r))}var p={timeout:r,maxRetry:n,retryDelay:o,maxRetryDelay:l,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(t,p,y)},s.loadsuccess=function(t,e,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this.handleSidxRequest(t,n),void this.handlePlaylistLoaded(t,e,n,r);this.resetInternalLoader(n.type);var o=t.data;0===o.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),o.indexOf("#EXTINF:")>0||o.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,n,r):this.handleMasterPlaylist(t,e,n,r)):this.handleManifestParsingError(t,n,"no EXTM3U delimiter",r)},s.loaderror=function(t,e,n){void 0===n&&(n=null),this.handleNetworkError(e,n,!1,t)},s.loadtimeout=function(t,e,n){void 0===n&&(n=null),this.handleNetworkError(e,n,!0)},s.handleMasterPlaylist=function(t,e,n,r){var o=this.hls,l=t.data,i=Z(t,n),a=T.parseMasterPlaylist(l,i),u=a.levels,h=a.sessionData;if(u.length){var c=u.map(function(D){return{id:D.attrs.AUDIO,audioCodec:D.audioCodec}}),g=u.map(function(D){return{id:D.attrs.SUBTITLES,textCodec:D.textCodec}}),p=T.parseMasterPlaylistMedia(l,i,"AUDIO",c),y=T.parseMasterPlaylistMedia(l,i,"SUBTITLES",g),S=T.parseMasterPlaylistMedia(l,i,"CLOSED-CAPTIONS");p.length&&(p.some(function(D){return!D.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(R.b.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Y({}),bitrate:0,url:""}))),o.trigger(f.a.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:y,captions:S,url:i,stats:e,networkDetails:r,sessionData:h})}else this.handleManifestParsingError(t,n,"no level found in manifest",r)},s.handleTrackOrLevelPlaylist=function(t,e,n,r){var o=this.hls,l=n.id,i=n.level,a=n.type,u=Z(t,n),h=Object(_.a)(l)?l:0,c=Object(_.a)(i)?i:h,g=function(U){switch(U.type){case I.a.AUDIO_TRACK:return I.b.AUDIO;case I.a.SUBTITLE_TRACK:return I.b.SUBTITLE;default:return I.b.MAIN}}(n),p=T.parseLevelPlaylist(t.data,u,c,g,h);if(p.fragments.length){if(a===I.a.MANIFEST){var y={attrs:new Y({}),bitrate:0,details:p,name:"",url:u};o.trigger(f.a.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:u,stats:e,networkDetails:r,sessionData:null})}if(e.parsing.end=performance.now(),p.needSidxRanges){var S,D=null===(S=p.fragments[0].initSegment)||void 0===S?void 0:S.url;this.load({url:D,isSidxRequest:!0,type:a,level:i,levelDetails:p,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=p,this.handlePlaylistLoaded(t,e,n,r)}else o.trigger(f.a.ERROR,{type:M.b.NETWORK_ERROR,details:M.a.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},s.handleSidxRequest=function(t,e){var n=Object(Q.g)(new Uint8Array(t.data));if(n){var o=e.levelDetails;n.references.forEach(function(l,i){var a=l.info,u=o.fragments[i];0===u.byteRange.length&&u.setByteRange(String(1+a.end-a.start)+"@"+String(a.start)),u.initSegment&&u.initSegment.setByteRange(String(n.moovEndOffset)+"@0")})}},s.handleManifestParsingError=function(t,e,n,r){this.hls.trigger(f.a.ERROR,{type:M.b.NETWORK_ERROR,details:M.a.MANIFEST_PARSING_ERROR,fatal:e.type===I.a.MANIFEST,url:t.url,reason:n,response:t,context:e,networkDetails:r})},s.handleNetworkError=function(t,e,n,r){void 0===n&&(n=!1),R.b.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var o=M.a.UNKNOWN,l=!1,i=this.getInternalLoader(t);switch(t.type){case I.a.MANIFEST:o=n?M.a.MANIFEST_LOAD_TIMEOUT:M.a.MANIFEST_LOAD_ERROR,l=!0;break;case I.a.LEVEL:o=n?M.a.LEVEL_LOAD_TIMEOUT:M.a.LEVEL_LOAD_ERROR,l=!1;break;case I.a.AUDIO_TRACK:o=n?M.a.AUDIO_TRACK_LOAD_TIMEOUT:M.a.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case I.a.SUBTITLE_TRACK:o=n?M.a.SUBTITLE_TRACK_LOAD_TIMEOUT:M.a.SUBTITLE_LOAD_ERROR,l=!1}i&&this.resetInternalLoader(t.type);var a={type:M.b.NETWORK_ERROR,details:o,fatal:l,url:t.url,loader:i,context:t,networkDetails:e};r&&(a.response=r),this.hls.trigger(f.a.ERROR,a)},s.handlePlaylistLoaded=function(t,e,n,r){var o=n.type,l=n.level,i=n.id,a=n.groupId,u=n.loader,h=n.levelDetails,c=n.deliveryDirectives;if(null!=h&&h.targetduration){if(u)switch(h.live&&(u.getCacheAge&&(h.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(h.ageHeader)||(h.ageHeader=0)),o){case I.a.MANIFEST:case I.a.LEVEL:this.hls.trigger(f.a.LEVEL_LOADED,{details:h,level:l||0,id:i||0,stats:e,networkDetails:r,deliveryDirectives:c});break;case I.a.AUDIO_TRACK:this.hls.trigger(f.a.AUDIO_TRACK_LOADED,{details:h,id:i||0,groupId:a||"",stats:e,networkDetails:r,deliveryDirectives:c});break;case I.a.SUBTITLE_TRACK:this.hls.trigger(f.a.SUBTITLE_TRACK_LOADED,{details:h,id:i||0,groupId:a||"",stats:e,networkDetails:r,deliveryDirectives:c})}}else this.handleManifestParsingError(t,n,"invalid target duration",r)},d}(),ct=function(){function d(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var s=d.prototype;return s._registerListeners=function(){this.hls.on(f.a.KEY_LOADING,this.onKeyLoading,this)},s._unregisterListeners=function(){this.hls.off(f.a.KEY_LOADING,this.onKeyLoading)},s.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},s.onKeyLoading=function(t,e){var n=e.frag,r=n.type,o=this.loaders[r];if(n.decryptdata){var l=n.decryptdata.uri;if(l!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;if(o&&(R.b.warn("abort previous key loader for type:"+r),o.abort()),!l)return void R.b.warn("key uri is falsy");var u=n.loader=this.loaders[r]=new(0,i.loader)(i);this.decrypturl=l,this.decryptkey=null;var h={url:l,frag:n,responseType:"arraybuffer"},c={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(h,c,g)}else this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(f.a.KEY_LOADED,{frag:n}))}else R.b.warn("Missing decryption data on fragment in onKeyLoading")},s.loadsuccess=function(t,e,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=null,delete this.loaders[r.type],this.hls.trigger(f.a.KEY_LOADED,{frag:r})):R.b.error("after key load, decryptdata unset")},s.loaderror=function(t,e){var n=e.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(f.a.ERROR,{type:M.b.NETWORK_ERROR,details:M.a.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},s.loadtimeout=function(t,e){var n=e.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(f.a.ERROR,{type:M.b.NETWORK_ERROR,details:M.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},d}();function rt(d,s){var t;try{t=new Event("addtrack")}catch{(t=document.createEvent("Event")).initEvent("addtrack",!1,!1)}t.track=d,s.dispatchEvent(t)}function mt(d,s){var t=d.mode;if("disabled"===t&&(d.mode="hidden"),d.cues&&!d.cues.getCueById(s.id))try{if(d.addCue(s),!d.cues.getCueById(s.id))throw new Error("addCue is failed for: "+s)}catch(n){R.b.debug("[texttrack-utils]: "+n);var e=new self.TextTrackCue(s.startTime,s.endTime,s.text);e.id=s.id,d.addCue(e)}"disabled"===t&&(d.mode=t)}function bt(d){var s=d.mode;if("disabled"===s&&(d.mode="hidden"),d.cues)for(var t=d.cues.length;t--;)d.removeCue(d.cues[t]);"disabled"===s&&(d.mode=s)}function Dt(d,s,t){var e=d.mode;if("disabled"===e&&(d.mode="hidden"),d.cues&&d.cues.length>0)for(var n=function(o,l,i){var a=[],u=function(p,y){if(y<p[0].startTime)return 0;var S=p.length-1;if(y>p[S].endTime)return-1;for(var D=0,U=S;D<=U;){var V=Math.floor((U+D)/2);if(y<p[V].startTime)U=V-1;else{if(!(y>p[V].startTime&&D<S))return V;D=V+1}}return p[D].startTime-y<y-p[U].startTime?D:U}(o,l);if(u>-1)for(var h=u,c=o.length;h<c;h++){var g=o[h];if(g.startTime>=l&&g.endTime<=i)a.push(g);else if(g.startTime>i)return a}return a}(d.cues,s,t),r=0;r<n.length;r++)d.removeCue(n[r]);"disabled"===e&&(d.mode=e)}var Tt=W(7),It=function(){function d(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}var s=d.prototype;return s.destroy=function(){this._unregisterListeners()},s._registerListeners=function(){var t=this.hls;t.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(f.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var t=this.hls;t.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(f.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.onMediaAttached=function(t,e){this.media=e.media},s.onMediaDetaching=function(){this.id3Track&&(bt(this.id3Track),this.id3Track=null,this.media=null)},s.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var n=t[e];if("metadata"===n.kind&&"id3"===n.label)return rt(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},s.onFragParsingMetadata=function(t,e){if(this.media){var n=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var o=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,l=0;l<r.length;l++){var i=Tt.c(r[l].data);if(i){var a=r[l].pts,u=l<r.length-1?r[l+1].pts:n.end;u-a<=0&&(u=a+.25);for(var h=0;h<i.length;h++){var c=i[h];if(!Tt.e(c)){var g=new o(a,u,"");g.value=c,this.id3Track.addCue(g)}}}}}},s.onBufferFlushing=function(t,e){var o=e.type;if(!o||"audio"===o){var l=this.id3Track;l&&Dt(l,e.startOffset,e.endOffset)}},d}();var jt,d,Qt=function(){function d(r){var o=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return o.timeupdate()},this.hls=r,this.config=r.config,this.registerListeners()}var t,n=d.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},n.registerListeners=function(){this.hls.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(f.a.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(f.a.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(f.a.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(f.a.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(f.a.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(f.a.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(f.a.ERROR,this.onError)},n.onMediaAttached=function(r,o){this.media=o.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(r,o){var l=o.details;this.levelDetails=l,l.advanced&&this.timeupdate(),!l.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(r,o){o.details===M.a.BUFFER_STALLED_ERROR&&(this.stallCount++,R.b.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){var r=this.media,o=this.levelDetails;if(r&&o){this.currentTime=r.currentTime;var l=this.computeLatency();if(null!==l){this._latency=l;var i=this.config,u=i.maxLiveSyncPlaybackRate;if(i.lowLatencyMode&&1!==u){var h=this.targetLatency;if(null!==h){var c=l-h,g=c<Math.min(this.maxLatency,h+o.targetduration);if(o.live&&g&&c>.05&&this.forwardBufferLength>1){var p=Math.min(2,Math.max(1,u)),y=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;r.playbackRate=Math.min(p,Math.max(1,y))}else 1!==r.playbackRate&&0!==r.playbackRate&&(r.playbackRate=1)}}}}},n.estimateLiveEdge=function(){var r=this.levelDetails;return null===r?null:r.edge+r.age},n.computeLatency=function(){var r=this.estimateLiveEdge();return null===r?null:r-this.currentTime},(t=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config,o=this.levelDetails;return void 0!==r.liveMaxLatencyDuration?r.liveMaxLatencyDuration:o?r.liveMaxLatencyDurationCount*o.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(null===r)return null;var i=r.targetduration,a=this.config,u=a.liveSyncDuration,g=this.hls.userConfig,p=a.lowLatencyMode&&r.partHoldBack||r.holdBack;return(g.liveSyncDuration||g.liveSyncDurationCount||0===p)&&(p=void 0!==u?u:a.liveSyncDurationCount*i),p+Math.min(1*this.stallCount,i)}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),o=this.targetLatency,l=this.levelDetails;if(null===r||null===o||null===l)return null;var i=l.edge,h=i-(this.config.lowLatencyMode&&l.partTarget||l.targetduration);return Math.min(Math.max(i-l.totalduration,r-o-this.edgeStalled),h)}},{key:"drift",get:function(){var r=this.levelDetails;return null===r?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;return null===r?0:Math.max(r.age-3*(this.config.lowLatencyMode&&r.partTarget||r.targetduration),0)}},{key:"forwardBufferLength",get:function(){var r=this.media,o=this.levelDetails;if(!r||!o)return 0;var l=r.buffered.length;return l?r.buffered.end(l-1):o.edge-this.currentTime}}])&&function At(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(d.prototype,t),d}();(d=jt||(jt={})).No="",d.Yes="YES",d.v2="v2";var Bt=function(){function d(s,t,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=s,this.part=t,this.skip=e}return d.prototype.addDirectives=function(s){var t=new self.URL(s);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},d}(),_t=function(){function d(n){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[n.url],this.attrs=n.attrs,this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.unknownCodecs=n.unknownCodecs,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(r){return r}).join(",").replace(/\.[^.,]+/g,"")}var t;return(t=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(n){var r=n%this.url.length;this._urlId!==r&&(this.details=void 0,this._urlId=r)}}])&&function Jt(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(d.prototype,t),d}();function Ht(d,s,t){switch(s){case"audio":d.audioGroupIds||(d.audioGroupIds=[]),d.audioGroupIds.push(t);break;case"text":d.textGroupIds||(d.textGroupIds=[]),d.textGroupIds.push(t)}}function Ft(d){var s={};d.forEach(function(t){var e=t.groupId||"";t.id=s[e]=s[e]||0,s[e]++})}function Nt(d,s){var t=s.startPTS;if(Object(_.a)(t)){var e,n=0;s.sn>d.sn?(n=t-d.start,e=d):(n=d.start-t,e=s),e.duration!==n&&(e.duration=n)}else s.start=s.sn>d.sn?d.cc===s.cc&&d.minEndPTS?d.start+(d.minEndPTS-d.start):d.start+d.duration:Math.max(d.start-s.duration,0)}function oe(d,s,t,e,n,r){e-t<=0&&(R.b.warn("Fragment should have a positive duration",s),e=t+s.duration,r=n+s.duration);var o=t,l=e,i=s.startPTS,a=s.endPTS;if(Object(_.a)(i)){var u=Math.abs(i-t);s.deltaPTS=Object(_.a)(s.deltaPTS)?Math.max(u,s.deltaPTS):u,o=Math.max(t,i),t=Math.min(t,i),n=Math.min(n,s.startDTS),l=Math.min(e,a),e=Math.max(e,a),r=Math.max(r,s.endDTS)}s.duration=e-t;var h=t-s.start;s.appendedPTS=e,s.start=s.startPTS=t,s.maxStartPTS=o,s.startDTS=n,s.endPTS=e,s.minEndPTS=l,s.endDTS=r;var c,g=s.sn;if(!d||g<d.startSN||g>d.endSN)return 0;var p=g-d.startSN,y=d.fragments;for(y[p]=s,c=p;c>0;c--)Nt(y[c],y[c-1]);for(c=p;c<y.length-1;c++)Nt(y[c],y[c+1]);return d.fragmentHint&&Nt(y[y.length-1],d.fragmentHint),d.PTSKnown=d.alignedSliding=!0,h}function ge(d,s){var t=s.startSN+s.skippedSegments-d.startSN,e=d.fragments;t<0||t>=e.length||ve(s,e[t].start)}function ve(d,s){if(s){for(var t=d.fragments,e=d.skippedSegments;e<t.length;e++)t[e].start+=s;d.fragmentHint&&(d.fragmentHint.start+=s)}}var re=function(){function d(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=R.b.log.bind(R.b,e+":"),this.warn=R.b.warn.bind(R.b,e+":"),this.hls=t}var s=d.prototype;return s.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},s.onError=function(t,e){e.fatal&&e.type===M.b.NETWORK_ERROR&&this.clearTimer()},s.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},s.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},s.stopLoad=function(){this.canLoad=!1,this.clearTimer()},s.switchParams=function(t,e){var n=e?.renditionReports;if(n)for(var r=0;r<n.length;r++){var o=n[r],l=""+o.URI;if(l===t.substr(-l.length)){var i=parseInt(o["LAST-MSN"]),a=parseInt(o["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode){var u=Math.min(e.age-e.partTarget,e.targetduration);void 0!==a&&u>e.partTarget&&(a+=1)}if(Object(_.a)(i))return new Bt(i,Object(_.a)(a)?a:void 0,jt.No)}}},s.loadPlaylist=function(t){},s.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},s.playlistLoaded=function(t,e,n){var r=this,o=e.details,l=e.stats,i=l.loading.end?Math.max(0,self.performance.now()-l.loading.end):0;if(o.advancedDateTime=Date.now()-i,o.live||null!=n&&n.live){if(o.reloaded(n),n&&this.log("live playlist "+t+" "+(o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:"MISSED")),n&&o.fragments.length>0&&function Yt(d,s){for(var t=null,e=d.fragments,n=e.length-1;n>=0;n--){var r=e[n].initSegment;if(r){t=r;break}}d.fragmentHint&&delete d.fragmentHint.endPTS;var o,l=0;if(function(g,p,y){for(var S=p.skippedSegments,D=Math.max(g.startSN,p.startSN)-p.startSN,U=(g.fragmentHint?1:0)+(S?p.endSN:Math.min(g.endSN,p.endSN))-p.startSN,V=p.startSN-g.startSN,it=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,et=g.fragmentHint?g.fragments.concat(g.fragmentHint):g.fragments,nt=D;nt<=U;nt++){var vt=et[V+nt],dt=it[nt];S&&!dt&&nt<S&&(dt=p.fragments[nt]=vt),vt&&dt&&y(vt,dt)}}(d,s,function(g,p){g.relurl&&(l=g.cc-p.cc),Object(_.a)(g.startPTS)&&Object(_.a)(g.endPTS)&&(p.start=p.startPTS=g.startPTS,p.startDTS=g.startDTS,p.appendedPTS=g.appendedPTS,p.maxStartPTS=g.maxStartPTS,p.endPTS=g.endPTS,p.endDTS=g.endDTS,p.minEndPTS=g.minEndPTS,p.duration=g.endPTS-g.startPTS,p.duration&&(o=p),s.PTSKnown=s.alignedSliding=!0),p.elementaryStreams=g.elementaryStreams,p.loader=g.loader,p.stats=g.stats,p.urlId=g.urlId,g.initSegment&&(p.initSegment=g.initSegment,t=g.initSegment)}),t&&(s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments).forEach(function(g){var p;g.initSegment&&g.initSegment.relurl!==(null===(p=t)||void 0===p?void 0:p.relurl)||(g.initSegment=t)}),s.skippedSegments&&(s.deltaUpdateFailed=s.fragments.some(function(g){return!g}),s.deltaUpdateFailed)){R.b.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var i=s.skippedSegments;i--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}var a=s.fragments;if(l){R.b.warn("discontinuity sliding from playlist, take drift into account");for(var u=0;u<a.length;u++)a[u].cc+=l}s.skippedSegments&&(s.startCC=s.fragments[0].cc),function(g,p,y){if(g&&p)for(var S=0,D=0,U=g.length;D<=U;D++){var V=g[D],it=p[D+S];V&&it&&V.index===it.index&&V.fragment.sn===it.fragment.sn?y(V,it):S--}}(d.partList,s.partList,function(g,p){p.elementaryStreams=g.elementaryStreams,p.stats=g.stats}),o?oe(s,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):ge(d,s),a.length&&(s.totalduration=s.edge-a[0].start),s.driftStartTime=d.driftStartTime,s.driftStart=d.driftStart;var h=s.advancedDateTime;if(s.advanced&&h){var c=s.edge;s.driftStart||(s.driftStartTime=h,s.driftStart=c),s.driftEndTime=h,s.driftEnd=c}else s.driftEndTime=d.driftEndTime,s.driftEnd=d.driftEnd,s.advancedDateTime=d.advancedDateTime}(n,o),!this.canLoad||!o.live)return;var a,u=void 0,h=void 0;if(o.canBlockReload&&o.endSN&&o.advanced){var c=this.hls.config.lowLatencyMode,g=o.lastPartSn,p=o.endSN,y=o.lastPartIndex,S=g===p;-1!==y?(u=S?p+1:g,h=S?c?0:y:y+1):u=p+1;var D=o.age,V=Math.min(D+o.ageHeader-o.partTarget,1.5*o.targetduration);if(V>0){if(n&&V>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+V+" with playlist age: "+o.age),V=0;else{var it=Math.floor(V/o.targetduration);u+=it,void 0!==h&&(h+=Math.round(V%o.targetduration/o.partTarget)),this.log("CDN Tune-in age: "+o.ageHeader+"s last advanced "+D.toFixed(2)+"s goal: "+V+" skip sn "+it+" to part "+h)}o.tuneInGoal=V}if(a=this.getDeliveryDirectives(o,e.deliveryDirectives,u,h),c||!S)return void this.loadPlaylist(a)}else a=this.getDeliveryDirectives(o,e.deliveryDirectives,u,h);var et=function(nt,vt){var dt,pt=1e3*nt.levelTargetDuration,Mt=pt/2,Vt=nt.age,Xt=Vt>0&&Vt<3*pt,Wt=vt.loading.end-vt.loading.start,zt=nt.availabilityDelay;if(!1===nt.updated)if(Xt){var ee=333*nt.misses;dt=Math.max(Math.min(Mt,2*Wt),ee),nt.availabilityDelay=(nt.availabilityDelay||0)+dt}else dt=Mt;else Xt?(zt=Math.min(zt||pt/2,Vt),nt.availabilityDelay=zt,dt=zt+pt-Vt):dt=pt-Wt;return Math.round(dt)}(o,l);void 0!==u&&o.canBlockReload&&(et-=o.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(et)+" ms"),this.timer=self.setTimeout(function(){return r.loadPlaylist(a)},et)}else this.clearTimer()},s.getDeliveryDirectives=function(t,e,n,r){var l,i,a,o=(i=n,(a=(l=t).canSkipUntil)&&(void 0!==i?i-l.endSN:0)<a?l.canSkipDateRanges?jt.v2:jt.Yes:jt.No);return null!=e&&e.skip&&t.deltaUpdateFailed&&(n=e.msn,r=e.part,o=jt.No),new Bt(n,r,o)},s.retryLoadingOrFail=function(t){var e,n=this,r=this.hls.config,o=this.retryCount<r.levelLoadingMaxRetry;if(o)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var l=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return n.loadPlaylist()},l),this.warn("retry playlist loading #"+this.retryCount+" in "+l+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return o},d}();function $t(){return($t=Object.assign||function(d){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}return d}).apply(this,arguments)}function qt(d,s){return(qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}var Pt,De=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),pe=function(d){var s,t;function e(i){var a;return(a=d.call(this,i,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,qt(s,t);var r,l=e.prototype;return l._registerListeners=function(){var i=this.hls;i.on(f.a.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(f.a.LEVEL_LOADED,this.onLevelLoaded,this),i.on(f.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(f.a.FRAG_LOADED,this.onFragLoaded,this),i.on(f.a.ERROR,this.onError,this)},l._unregisterListeners=function(){var i=this.hls;i.off(f.a.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(f.a.LEVEL_LOADED,this.onLevelLoaded,this),i.off(f.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(f.a.FRAG_LOADED,this.onFragLoaded,this),i.off(f.a.ERROR,this.onError,this)},l.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,d.prototype.destroy.call(this)},l.startLoad=function(){this._levels.forEach(function(i){i.loadError=0}),d.prototype.startLoad.call(this)},l.onManifestLoaded=function(i,a){var u,h,c=[],g=[],p=[],y={},S=!1,D=!1,U=!1;if(a.levels.forEach(function(nt){var vt=nt.attrs;S=S||!(!nt.width||!nt.height),D=D||!!nt.videoCodec,U=U||!!nt.audioCodec,De&&nt.audioCodec&&-1!==nt.audioCodec.indexOf("mp4a.40.34")&&(nt.audioCodec=void 0);var dt=nt.bitrate+"-"+nt.attrs.RESOLUTION+"-"+nt.attrs.CODECS;(h=y[dt])?h.url.push(nt.url):(h=new _t(nt),y[dt]=h,c.push(h)),vt&&(vt.AUDIO&&Ht(h,"audio",vt.AUDIO),vt.SUBTITLES&&Ht(h,"text",vt.SUBTITLES))}),(S||D)&&U&&(c=c.filter(function(nt){return!!nt.videoCodec||!(!nt.width||!nt.height)})),c=c.filter(function(nt){var vt=nt.audioCodec,dt=nt.videoCodec;return(!vt||$(vt,"audio"))&&(!dt||$(dt,"video"))}),a.audioTracks&&Ft(g=a.audioTracks.filter(function(nt){return!nt.audioCodec||$(nt.audioCodec,"audio")})),a.subtitles&&Ft(p=a.subtitles),c.length>0){u=c[0].bitrate,c.sort(function(nt,vt){return nt.bitrate-vt.bitrate}),this._levels=c;for(var V=0;V<c.length;V++)if(c[V].bitrate===u){this._firstLevel=V,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+u);break}var et={levels:c,audioTracks:g,subtitleTracks:p,firstLevel:this._firstLevel,stats:a.stats,audio:U,video:D,altAudio:!(U&&!D)&&g.some(function(nt){return!!nt.url})};this.hls.trigger(f.a.MANIFEST_PARSED,et),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},l.onError=function(i,a){if(d.prototype.onError.call(this,i,a),!a.fatal){var u=a.context,h=this._levels[this.currentLevelIndex];if(u&&(u.type===I.a.AUDIO_TRACK&&h.audioGroupIds&&u.groupId===h.audioGroupIds[h.urlId]||u.type===I.a.SUBTITLE_TRACK&&h.textGroupIds&&u.groupId===h.textGroupIds[h.urlId]))this.redundantFailover(this.currentLevelIndex);else{var c,g=!1,p=!0;switch(a.details){case M.a.FRAG_LOAD_ERROR:case M.a.FRAG_LOAD_TIMEOUT:case M.a.KEY_LOAD_ERROR:case M.a.KEY_LOAD_TIMEOUT:if(a.frag){var y=this._levels[a.frag.level];y?(y.fragmentError++,y.fragmentError>this.hls.config.fragLoadingMaxRetry&&(c=a.frag.level)):c=a.frag.level}break;case M.a.LEVEL_LOAD_ERROR:case M.a.LEVEL_LOAD_TIMEOUT:u&&(u.deliveryDirectives&&(p=!1),c=u.level),g=!0;break;case M.a.REMUX_ALLOC_ERROR:c=a.level,g=!0}void 0!==c&&this.recoverLevel(a,c,g,p)}}},l.recoverLevel=function(i,a,u,h){var c=i.details,g=this._levels[a];if(g.loadError++,u){if(!this.retryLoadingOrFail(i))return void(this.currentLevelIndex=-1);i.levelRetry=!0}if(h){var p=g.url.length;if(p>1&&g.loadError<p)i.levelRetry=!0,this.redundantFailover(a);else if(-1===this.manualLevelIndex){var y=0===a?this._levels.length-1:a-1;this.currentLevelIndex!==y&&0===this._levels[y].loadError&&(this.warn(c+": switch to "+y),i.levelRetry=!0,this.hls.nextAutoLevel=y)}}},l.redundantFailover=function(i){var a=this._levels[i],u=a.url.length;if(u>1){var h=(a.urlId+1)%u;this.warn("Switching to redundant URL-id "+h),this._levels.forEach(function(c){c.urlId=h}),this.level=i}},l.onFragLoaded=function(i,a){var u=a.frag;if(void 0!==u&&u.type===I.b.MAIN){var h=this._levels[u.level];void 0!==h&&(h.fragmentError=0,h.loadError=0)}},l.onLevelLoaded=function(i,a){var u,h,c=a.level,g=a.details,p=this._levels[c];if(!p)return this.warn("Invalid level index "+c),void(null!==(h=a.deliveryDirectives)&&void 0!==h&&h.skip&&(g.deltaUpdateFailed=!0));c===this.currentLevelIndex?(0===p.fragmentError&&(p.loadError=0,this.retryCount=0),this.playlistLoaded(c,a,p.details)):null!==(u=a.deliveryDirectives)&&void 0!==u&&u.skip&&(g.deltaUpdateFailed=!0)},l.onAudioTrackSwitched=function(i,a){var u=this.hls.levels[this.currentLevelIndex];if(u&&u.audioGroupIds){for(var h=-1,c=this.hls.audioTracks[a.id].groupId,g=0;g<u.audioGroupIds.length;g++)if(u.audioGroupIds[g]===c){h=g;break}h!==u.urlId&&(u.urlId=h,this.startLoad())}},l.loadPlaylist=function(i){var a=this.currentLevelIndex,u=this._levels[a];if(this.canLoad&&u&&u.url.length>0){var h=u.urlId,c=u.url[h];if(i)try{c=i.addDirectives(c)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Attempt loading level index "+a+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+h+" "+c),this.clearTimer(),this.hls.trigger(f.a.LEVEL_LOADING,{url:c,level:a,id:h,deliveryDirectives:i||null})}},l.removeLevel=function(i,a){var u=function(c,g){return g!==a},h=this._levels.filter(function(c,g){return g!==i||c.url.length>1&&void 0!==a&&(c.url=c.url.filter(u),c.audioGroupIds&&(c.audioGroupIds=c.audioGroupIds.filter(u)),c.textGroupIds&&(c.textGroupIds=c.textGroupIds.filter(u)),c.urlId=0,!0)}).map(function(c,g){var p=c.details;return null!=p&&p.fragments&&p.fragments.forEach(function(y){y.level=g}),c});this._levels=h,this.hls.trigger(f.a.LEVELS_UPDATED,{levels:h})},(r=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var a,u=this._levels;if(0!==u.length&&(this.currentLevelIndex!==i||null===(a=u[i])||void 0===a||!a.details)){if(i<0||i>=u.length){var h=i<0;if(this.hls.trigger(f.a.ERROR,{type:M.b.OTHER_ERROR,details:M.a.LEVEL_SWITCH_ERROR,level:i,fatal:h,reason:"invalid level idx"}),h)return;i=Math.min(i,u.length-1)}this.clearTimer();var c=this.currentLevelIndex,g=u[c],p=u[i];this.log("switching to level "+i+" from "+c),this.currentLevelIndex=i;var y=$t({},p,{level:i,maxBitrate:p.maxBitrate,uri:p.uri,urlId:p.urlId});delete y._urlId,this.hls.trigger(f.a.LEVEL_SWITCHING,y);var S=p.details;if(!S||S.live){var D=this.switchParams(p.uri,g?.details);this.loadPlaylist(D)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,void 0===this._startLevel&&(this._startLevel=i),-1!==i&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var i=this.hls.config.startLevel;return void 0!==i?i:this._firstLevel}return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=i)}}])&&function le(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(e.prototype,r),e}(re);!function(d){d.NOT_LOADED="NOT_LOADED",d.BACKTRACKED="BACKTRACKED",d.APPENDING="APPENDING",d.PARTIAL="PARTIAL",d.OK="OK"}(Pt||(Pt={}));var ie=function(){function d(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var s=d.prototype;return s._registerListeners=function(){var t=this.hls;t.on(f.a.BUFFER_APPENDED,this.onBufferAppended,this),t.on(f.a.FRAG_BUFFERED,this.onFragBuffered,this),t.on(f.a.FRAG_LOADED,this.onFragLoaded,this)},s._unregisterListeners=function(){var t=this.hls;t.off(f.a.BUFFER_APPENDED,this.onBufferAppended,this),t.off(f.a.FRAG_BUFFERED,this.onFragBuffered,this),t.off(f.a.FRAG_LOADED,this.onFragLoaded,this)},s.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},s.getAppendedFrag=function(t,e){if(e===I.b.MAIN){var n=this.activeFragment,r=this.activeParts;if(!n)return null;if(r)for(var o=r.length;o--;){var l=r[o],i=l?l.end:n.appendedPTS;if(l.start<=t&&void 0!==i&&t<=i)return o>9&&(this.activeParts=r.slice(o-9)),l}else if(n.start<=t&&void 0!==n.appendedPTS&&t<=n.appendedPTS)return n}return this.getBufferedFrag(t,e)},s.getBufferedFrag=function(t,e){for(var n=this.fragments,r=Object.keys(n),o=r.length;o--;){var l=n[r[o]];if(l?.body.type===e&&l.buffered){var i=l.body;if(i.start<=t&&t<=i.end)return i}}return null},s.detectEvictedFragments=function(t,e,n){var r=this;Object.keys(this.fragments).forEach(function(o){var l=r.fragments[o];if(l)if(l.buffered){var i=l.range[t];i&&i.time.some(function(a){var u=!r.isTimeBuffered(a.startPTS,a.endPTS,e);return u&&r.removeFragment(l.body),u})}else l.body.type===n&&r.removeFragment(l.body)})},s.detectPartialFragments=function(t){var e=this,n=this.timeRanges,r=t.frag,o=t.part;if(n&&"initSegment"!==r.sn){var l=Zt(r),i=this.fragments[l];i&&(Object.keys(n).forEach(function(a){var u=r.elementaryStreams[a];u&&(i.range[a]=e.getBufferedTimes(r,o,null!==o||!0===u.partial,n[a]))}),i.backtrack=i.loaded=null,Object.keys(i.range).length?i.buffered=!0:this.removeFragment(i.body))}},s.fragBuffered=function(t){var e=Zt(t),n=this.fragments[e];n&&(n.backtrack=n.loaded=null,n.buffered=!0)},s.getBufferedTimes=function(t,e,n,r){for(var o={time:[],partial:n},l=e?e.start:t.start,i=e?e.end:t.end,a=t.minEndPTS||i,u=t.maxStartPTS||l,h=0;h<r.length;h++){var c=r.start(h)-this.bufferPadding,g=r.end(h)+this.bufferPadding;if(u>=c&&a<=g){o.time.push({startPTS:Math.max(l,r.start(h)),endPTS:Math.min(i,r.end(h))});break}if(l<g&&i>c)o.partial=!0,o.time.push({startPTS:Math.max(l,r.start(h)),endPTS:Math.min(i,r.end(h))});else if(i<=c)break}return o},s.getPartialFragment=function(t){var e,n,r,o=null,l=0,i=this.bufferPadding,a=this.fragments;return Object.keys(a).forEach(function(u){var h=a[u];h&&ue(h)&&(r=h.body.end+i,t>=(n=h.body.start-i)&&t<=r&&(e=Math.min(t-n,r-t),l<=e&&(o=h.body,l=e)))}),o},s.getState=function(t){var e=Zt(t),n=this.fragments[e];return n?n.buffered?ue(n)?Pt.PARTIAL:Pt.OK:n.backtrack?Pt.BACKTRACKED:Pt.APPENDING:Pt.NOT_LOADED},s.backtrack=function(t,e){var n=Zt(t),r=this.fragments[n];if(!r||r.backtrack)return null;var o=r.backtrack=e||r.loaded;return r.loaded=null,o},s.getBacktrackData=function(t){var e=Zt(t),n=this.fragments[e];if(n){var r,o=n.backtrack;if(null!=o&&null!==(r=o.payload)&&void 0!==r&&r.byteLength)return o;this.removeFragment(t)}return null},s.isTimeBuffered=function(t,e,n){for(var r,o,l=0;l<n.length;l++){if(r=n.start(l)-this.bufferPadding,o=n.end(l)+this.bufferPadding,t>=r&&e<=o)return!0;if(e<=r)return!1}return!1},s.onFragLoaded=function(t,e){var n=e.frag;if("initSegment"!==n.sn&&!n.bitrateTest&&!e.part){var o=Zt(n);this.fragments[o]={body:n,loaded:e,backtrack:null,buffered:!1,range:Object.create(null)}}},s.onBufferAppended=function(t,e){var n=this,r=e.frag,o=e.part,l=e.timeRanges;if(r.type===I.b.MAIN)if(this.activeFragment=r,o){var i=this.activeParts;i||(this.activeParts=i=[]),i.push(o)}else this.activeParts=null;this.timeRanges=l,Object.keys(l).forEach(function(a){var u=l[a];if(n.detectEvictedFragments(a,u),!o)for(var h=0;h<u.length;h++)r.appendedPTS=Math.max(u.end(h),r.appendedPTS||0)})},s.onFragBuffered=function(t,e){this.detectPartialFragments(e)},s.hasFragment=function(t){var e=Zt(t);return!!this.fragments[e]},s.removeFragmentsInRange=function(t,e,n){var r=this;Object.keys(this.fragments).forEach(function(o){var l=r.fragments[o];if(l&&l.buffered){var i=l.body;i.type===n&&i.start<e&&i.end>t&&r.removeFragment(i)}})},s.removeFragment=function(t){var e=Zt(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},s.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},d}();function ue(d){var s,t;return d.buffered&&((null===(s=d.range.video)||void 0===s?void 0:s.partial)||(null===(t=d.range.audio)||void 0===t?void 0:t.partial))}function Zt(d){return d.type+"_"+d.level+"_"+d.urlId+"_"+d.sn}var he=function(){function d(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var s=d.prototype;return s.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},s.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},s.onHandlerDestroyed=function(){},s.hasInterval=function(){return!!this._tickInterval},s.hasNextTick=function(){return!!this._tickTimer},s.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},s.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},s.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},s.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},s.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},s.doTick=function(){},d}(),te={length:0,start:function(){return 0},end:function(){return 0}},Ct=function(){function d(){}return d.isBuffered=function(s,t){try{if(s)for(var e=d.getBuffered(s),n=0;n<e.length;n++)if(t>=e.start(n)&&t<=e.end(n))return!0}catch{}return!1},d.bufferInfo=function(s,t,e){try{if(s){var n,r=d.getBuffered(s),o=[];for(n=0;n<r.length;n++)o.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(o,t,e)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}},d.bufferedInfo=function(s,t,e){t=Math.max(0,t),s.sort(function(y,S){return y.start-S.start||S.end-y.end});var n=[];if(e)for(var r=0;r<s.length;r++){var o=n.length;if(o){var l=n[o-1].end;s[r].start-l<e?s[r].end>l&&(n[o-1].end=s[r].end):n.push(s[r])}else n.push(s[r])}else n=s;for(var i,a=0,u=t,h=t,c=0;c<n.length;c++){var g=n[c].start,p=n[c].end;if(t+e>=g&&t<p)u=g,a=(h=p)-t;else if(t+e<g){i=g;break}}return{len:a,start:u||0,end:h||0,nextStart:i}},d.getBuffered=function(s){try{return s.buffered}catch(t){return R.b.log("failed to get media.buffered",t),te}},d}(),Te=function(d,s,t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=-1),void 0===r&&(r=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=d,this.sn=s,this.id=t,this.size=e,this.part=n,this.partial=r};function Le(d,s){if(d){var t=d.start+s;d.start=d.startPTS=t,d.endPTS=t+d.duration}}function be(d,s){for(var t=s.fragments,e=0,n=t.length;e<n;e++)Le(t[e],d);s.fragmentHint&&Le(s.fragmentHint,d),s.alignedSliding=!0}function O(d,s){var t=d.programDateTime;if(t){var e=(t-s)/1e3;d.start=d.startPTS=e,d.endPTS=e+d.duration}}function A(d,s){if(s.fragments.length&&d.hasProgramDateTime&&s.hasProgramDateTime){var t=s.fragments[0].programDateTime-1e3*s.fragments[0].start;d.fragments.forEach(function(e){O(e,t)}),d.fragmentHint&&O(d.fragmentHint,t),d.alignedSliding=!0}}var m_search=function(d,s){for(var t=0,e=d.length-1,n=null,r=null;t<=e;){var o=s(r=d[n=(t+e)/2|0]);if(o>0)t=n+1;else{if(!(o<0))return r;e=n-1}}return null};function b(d,s,t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=null;return d?n=s[d.sn-s[0].sn+1]||null:0===t&&0===s[0].start&&(n=s[0]),n&&0===L(t,e,n)?n:m_search(s,L.bind(null,t,e))||n}function L(d,s,t){void 0===d&&(d=0),void 0===s&&(s=0);var e=Math.min(s,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-e<=d?1:t.start-e>d&&t.start?-1:0}function P(d,s,t){var e=1e3*Math.min(s,t.duration+(t.deltaPTS?t.deltaPTS:0));return(t.endProgramDateTime||0)-e>d}function x(d){var s="function"==typeof Map?new Map:void 0;return(x=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(t))return s.get(t);s.set(t,n)}function n(){return G(t,arguments,st(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ot(n,t)})(d)}function G(d,s,t){return(G=X()?Reflect.construct:function(e,n,r){var o=[null];o.push.apply(o,n);var l=new(Function.bind.apply(e,o));return r&&ot(l,r.prototype),l}).apply(null,arguments)}function X(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ot(d,s){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}function st(d){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)})(d)}var ht=Math.pow(2,17),gt=function(){function d(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var s=d.prototype;return s.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},s.abort=function(){this.loader&&this.loader.abort()},s.load=function(t,e){var n=this,r=t.url;if(!r)return Promise.reject(new yt({type:M.b.NETWORK_ERROR,details:M.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var o=this.config,l=o.fLoader,i=o.loader;return new Promise(function(a,u){n.loader&&n.loader.destroy();var h=n.loader=t.loader=l?new l(o):new i(o),c=ut(t),g={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:ht};t.stats=h.stats,h.load(c,g,{onSuccess:function(p,y,S,D){n.resetLoader(t,h),a({frag:t,part:null,payload:p.data,networkDetails:D})},onError:function(p,y,S){n.resetLoader(t,h),u(new yt({type:M.b.NETWORK_ERROR,details:M.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:p,networkDetails:S}))},onAbort:function(p,y,S){n.resetLoader(t,h),u(new yt({type:M.b.NETWORK_ERROR,details:M.a.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:S}))},onTimeout:function(p,y,S){n.resetLoader(t,h),u(new yt({type:M.b.NETWORK_ERROR,details:M.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:S}))},onProgress:function(p,y,S,D){e&&e({frag:t,part:null,payload:S,networkDetails:D})}})})},s.loadPart=function(t,e,n){var r=this;this.abort();var o=this.config,l=o.fLoader,i=o.loader;return new Promise(function(a,u){r.loader&&r.loader.destroy();var h=r.loader=t.loader=l?new l(o):new i(o),c=ut(t,e),g={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:ht};e.stats=h.stats,h.load(c,g,{onSuccess:function(p,y,S,D){r.resetLoader(t,h),r.updateStatsFromPart(t,e);var U={frag:t,part:e,payload:p.data,networkDetails:D};n(U),a(U)},onError:function(p,y,S){r.resetLoader(t,h),u(new yt({type:M.b.NETWORK_ERROR,details:M.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:p,networkDetails:S}))},onAbort:function(p,y,S){t.stats.aborted=e.stats.aborted,r.resetLoader(t,h),u(new yt({type:M.b.NETWORK_ERROR,details:M.a.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:S}))},onTimeout:function(p,y,S){r.resetLoader(t,h),u(new yt({type:M.b.NETWORK_ERROR,details:M.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:S}))}})})},s.updateStatsFromPart=function(t,e){var n=t.stats,r=e.stats,o=r.total;if(n.loaded+=r.loaded,o){var l=Math.round(t.duration/e.duration),i=Math.min(Math.round(n.loaded/o),l),a=(l-i)*Math.round(n.loaded/i);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);var u=n.loading,h=r.loading;u.start?u.first+=h.first-h.start:(u.start=h.start,u.first=h.first),u.end=h.end},s.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},d}();function ut(d,s){void 0===s&&(s=null);var t=s||d,e={frag:d,part:s,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;return Object(_.a)(n)&&Object(_.a)(r)&&(e.rangeStart=n,e.rangeEnd=r),e}var yt=function(d){var s,t;function e(n){for(var r,o=arguments.length,l=new Array(o>1?o-1:0),i=1;i<o;i++)l[i-1]=arguments[i];return(r=d.call.apply(d,[this].concat(l))||this).data=void 0,r.data=n,r}return t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,ot(s,t),e}(x(Error)),St=W(15);function Gt(d,s){return(Gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}var Ot="STOPPED",Lt="IDLE",de="KEY_LOADING",xt="FRAG_LOADING",Rt="FRAG_LOADING_WAITING_RETRY",Ee="WAITING_TRACK",Ut="PARSING",se="PARSED",Se="BACKTRACKING",Ae="ENDED",Re="ERROR",ye="WAITING_INIT_PTS",ce="WAITING_LEVEL",ne=function(d){var s,t;function e(i,a,u){var h;return(h=d.call(this)||this).hls=void 0,h.fragPrevious=null,h.fragCurrent=null,h.fragmentTracker=void 0,h.transmuxer=null,h._state=Ot,h.media=void 0,h.mediaBuffer=void 0,h.config=void 0,h.bitrateTest=!1,h.lastCurrentTime=0,h.nextLoadPosition=0,h.startPosition=0,h.loadedmetadata=!1,h.fragLoadError=0,h.retryDate=0,h.levels=null,h.fragmentLoader=void 0,h.levelLastLoaded=null,h.startFragRequested=!1,h.decrypter=void 0,h.initPTS=[],h.onvseeking=null,h.onvended=null,h.logPrefix="",h.log=void 0,h.warn=void 0,h.logPrefix=u,h.log=R.b.log.bind(R.b,u+":"),h.warn=R.b.warn.bind(R.b,u+":"),h.hls=i,h.fragmentLoader=new gt(i.config),h.fragmentTracker=a,h.config=i.config,h.decrypter=new St.a(i,i.config),i.on(f.a.KEY_LOADED,h.onKeyLoaded,function(c){if(void 0===c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}(h)),h}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,Gt(s,t);var r,l=e.prototype;return l.doTick=function(){this.onTickEnd()},l.onTickEnd=function(){},l.startLoad=function(i){},l.stopLoad=function(){this.fragmentLoader.abort();var i=this.fragCurrent;i&&this.fragmentTracker.removeFragment(i),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ot},l._streamEnded=function(i,a){var u=this.fragCurrent,h=this.fragmentTracker;if(!a.live&&u&&u.sn>=a.endSN&&!i.nextStart){var c=a.partList;if(null!=c&&c.length){var g=c[c.length-1];return Ct.isBuffered(this.media,g.start+g.duration/2)}var p=h.getState(u);return p===Pt.PARTIAL||p===Pt.OK}return!1},l.onMediaAttached=function(i,a){var u=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),u.addEventListener("seeking",this.onvseeking),u.addEventListener("ended",this.onvended);var h=this.config;this.levels&&h.autoStartLoad&&this.state===Ot&&this.startLoad(h.startPosition)},l.onMediaDetaching=function(){var i=this.media;null!=i&&i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i&&(i.removeEventListener("seeking",this.onvseeking),i.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},l.onMediaSeeking=function(){var i=this.config,a=this.fragCurrent,u=this.media,c=this.state,g=u?u.currentTime:0,p=Ct.bufferInfo(this.mediaBuffer||u,g,i.maxBufferHole);if(this.log("media seeking to "+(Object(_.a)(g)?g.toFixed(3):g)+", state: "+c),c===Ae)this.resetLoadingState();else if(a&&!p.len){var y=i.maxFragLookUpTolerance,D=g>a.start+a.duration+y;(g<a.start-y||D)&&(D&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.resetLoadingState())}u&&(this.lastCurrentTime=g),this.loadedmetadata||p.len||(this.nextLoadPosition=this.startPosition=g),this.tickImmediate()},l.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},l.onKeyLoaded=function(i,a){if(this.state===de&&a.frag===this.fragCurrent&&this.levels){this.state=Lt;var u=this.levels[a.frag.level].details;u&&this.loadFragment(a.frag,u,a.frag.start)}},l.onHandlerDestroying=function(){this.stopLoad(),d.prototype.onHandlerDestroying.call(this)},l.onHandlerDestroyed=function(){this.state=Ot,this.hls.off(f.a.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,d.prototype.onHandlerDestroyed.call(this)},l.loadKey=function(i,a){this.log("Loading key for "+i.sn+" of ["+a.startSN+"-"+a.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+i.level),this.state=de,this.fragCurrent=i,this.hls.trigger(f.a.KEY_LOADING,{frag:i})},l.loadFragment=function(i,a,u){this._loadFragForPlayback(i,a,u)},l._loadFragForPlayback=function(i,a,u){var h=this;this._doFragLoad(i,a,u,function(c){if(h.fragContextChanged(i))return h.warn("Fragment "+i.sn+(c.part?" p: "+c.part.index:"")+" of level "+i.level+" was dropped during download."),void h.fragmentTracker.removeFragment(i);i.stats.chunkCount++,h._handleFragmentLoadProgress(c)}).then(function(c){if(c){h.fragLoadError=0;var g=h.state;if(!h.fragContextChanged(i))return"payload"in c&&(h.log("Loaded fragment "+i.sn+" of level "+i.level),h.hls.trigger(f.a.FRAG_LOADED,c),h.state===Se)?(h.fragmentTracker.backtrack(i,c),void h.resetFragmentLoading(i)):void h._handleFragmentLoadComplete(c);(g===xt||g===Se||!h.fragCurrent&&g===Ut)&&(h.fragmentTracker.removeFragment(i),h.state=Lt)}}).catch(function(c){h.warn(c),h.resetFragmentLoading(i)})},l.flushMainBuffer=function(i,a,u){if(void 0===u&&(u=null),i-a){var h={startOffset:i,endOffset:a,type:u};this.fragLoadError=0,this.hls.trigger(f.a.BUFFER_FLUSHING,h)}},l._loadInitSegment=function(i){var a=this;this._doFragLoad(i).then(function(u){if(!u||a.fragContextChanged(i)||!a.levels)throw new Error("init load aborted");return u}).then(function(u){var h=a.hls,c=u.payload,g=i.decryptdata;if(c&&c.byteLength>0&&g&&g.key&&g.iv&&"AES-128"===g.method){var p=self.performance.now();return a.decrypter.webCryptoDecrypt(new Uint8Array(c),g.key.buffer,g.iv.buffer).then(function(y){var S=self.performance.now();return h.trigger(f.a.FRAG_DECRYPTED,{frag:i,payload:y,stats:{tstart:p,tdecrypt:S}}),u.payload=y,u})}return u}).then(function(u){var h=a.fragCurrent,c=a.hls;if(!a.levels)throw new Error("init load aborted, missing levels");var p=i.stats;a.state=Lt,a.fragLoadError=0,i.data=new Uint8Array(u.payload),p.parsing.start=p.buffering.start=self.performance.now(),p.parsing.end=p.buffering.end=self.performance.now(),u.frag===h&&c.trigger(f.a.FRAG_BUFFERED,{stats:p,frag:h,part:null,id:i.type}),a.tick()}).catch(function(u){a.warn(u),a.resetFragmentLoading(i)})},l.fragContextChanged=function(i){var a=this.fragCurrent;return!i||!a||i.level!==a.level||i.sn!==a.sn||i.urlId!==a.urlId},l.fragBufferedComplete=function(i,a){this.log("Buffered "+i.type+" sn: "+i.sn+(a?" part: "+a.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+i.level+" "+function(d){for(var s="",t=d.length,e=0;e<t;e++)s+="["+d.start(e).toFixed(3)+","+d.end(e).toFixed(3)+"]";return s}(Ct.getBuffered(this.mediaBuffer?this.mediaBuffer:this.media))),this.state=Lt,this.tick()},l._handleFragmentLoadComplete=function(i){var a=this.transmuxer;if(a){var u=i.frag,h=i.part,c=i.partsLoaded,g=!c||0===c.length||c.some(function(y){return!y}),p=new Te(u.level,u.sn,u.stats.chunkCount+1,0,h?h.index:-1,!g);a.flush(p)}},l._handleFragmentLoadProgress=function(i){},l._doFragLoad=function(i,a,u,h){var c=this;if(void 0===u&&(u=null),!this.levels)throw new Error("frag load aborted, missing levels");if(u=Math.max(i.start,u||0),this.config.lowLatencyMode&&a){var g=a.partList;if(g&&h){u>i.end&&a.fragmentHint&&(i=a.fragmentHint);var p=this.getNextPart(g,i,u);if(p>-1){var y=g[p];return this.log("Loading part sn: "+i.sn+" p: "+y.index+" cc: "+i.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+p+"-"+(g.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+i.level+", target: "+parseFloat(u.toFixed(3))),this.nextLoadPosition=y.start+y.duration,this.state=xt,this.hls.trigger(f.a.FRAG_LOADING,{frag:i,part:g[p],targetBufferTime:u}),this.doFragPartsLoad(i,g,p,h).catch(function(S){return c.handleFragLoadError(S)})}if(!i.url||this.loadedEndOfParts(g,u))return Promise.resolve(null)}}return this.log("Loading fragment "+i.sn+" cc: "+i.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+i.level+", target: "+parseFloat(u.toFixed(3))),Object(_.a)(i.sn)&&!this.bitrateTest&&(this.nextLoadPosition=i.start+i.duration),this.state=xt,this.hls.trigger(f.a.FRAG_LOADING,{frag:i,targetBufferTime:u}),this.fragmentLoader.load(i,h).catch(function(S){return c.handleFragLoadError(S)})},l.doFragPartsLoad=function(i,a,u,h){var c=this;return new Promise(function(g,p){var y=[];!function S(D){var U=a[D];c.fragmentLoader.loadPart(i,U,h).then(function(V){y[U.index]=V;var it=V.part;c.hls.trigger(f.a.FRAG_LOADED,V);var et=a[D+1];if(!et||et.fragment!==i)return g({frag:i,part:it,partsLoaded:y});S(D+1)}).catch(p)}(u)})},l.handleFragLoadError=function(i){var a=i.data;return a&&a.details===M.a.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(f.a.ERROR,a),null},l._handleTransmuxerFlush=function(i){var a=this.getCurrentContext(i);if(a&&this.state===Ut){var u=a.frag,h=a.part,c=a.level,g=self.performance.now();u.stats.parsing.end=g,h&&(h.stats.parsing.end=g),this.updateLevelTiming(u,h,c,i.partial)}else this.fragCurrent||(this.state=Lt)},l.getCurrentContext=function(i){var a=this.levels,u=i.level,h=i.sn,c=i.part;if(!a||!a[u])return this.warn("Levels object was unset while buffering fragment "+h+" of level "+u+". The current chunk will not be buffered."),null;var g=a[u],p=c>-1?function(S,D,U){if(!S||!S.details)return null;var V=S.details.partList;if(V)for(var it=V.length;it--;){var et=V[it];if(et.index===U&&et.fragment.sn===D)return et}return null}(g,h,c):null,y=p?p.fragment:function(S,D,U){if(!S||!S.details)return null;var V=S.details,it=V.fragments[D-V.startSN];return it||((it=V.fragmentHint)&&it.sn===D?it:D<V.startSN&&U&&U.sn===D?U:null)}(g,h,this.fragCurrent);return y?{frag:y,part:p,level:g}:null},l.bufferFragmentData=function(i,a,u,h){if(i&&this.state===Ut){var c=i.data1,g=i.data2,p=c;c&&g&&(p=Object(Q.a)(c,g)),p&&p.length&&(this.hls.trigger(f.a.BUFFER_APPENDING,{type:i.type,frag:a,part:u,chunkMeta:h,parent:a.type,data:p}),i.dropped&&i.independent&&!u&&this.flushBufferGap(a))}},l.flushBufferGap=function(i){var a=this.media;if(a)if(Ct.isBuffered(a,a.currentTime)){var u=a.currentTime,h=Ct.bufferInfo(a,u,0),g=Math.min(2*this.config.maxFragLookUpTolerance,.25*i.duration),p=Math.max(Math.min(i.start-g,h.end-g),u+g);i.start-p>g&&this.flushMainBuffer(p,i.start)}else this.flushMainBuffer(0,i.start)},l.getFwdBufferInfo=function(i,a){var u=this.config,h=this.getLoadPosition();if(!Object(_.a)(h))return null;var c=Ct.bufferInfo(i,h,u.maxBufferHole);if(0===c.len&&void 0!==c.nextStart){var g=this.fragmentTracker.getBufferedFrag(h,a);if(g&&c.nextStart<g.end)return Ct.bufferInfo(i,h,Math.max(c.nextStart,u.maxBufferHole))}return c},l.getMaxBufferLength=function(i){var a,u=this.config;return a=i?Math.max(8*u.maxBufferSize/i,u.maxBufferLength):u.maxBufferLength,Math.min(a,u.maxMaxBufferLength)},l.reduceMaxBufferLength=function(i){var a=this.config;return a.maxMaxBufferLength>=(i||a.maxBufferLength)&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},l.getNextFragment=function(i,a){var u,h,c=a.fragments,g=c.length;if(!g)return null;var p,y=this.config,S=c[0].start;if(a.live){var D=y.initialLiveManifestSize;if(g<D)return this.warn("Not enough fragments to start playback (have: "+g+", need: "+D+")"),null;a.PTSKnown||this.startFragRequested||-1!==this.startPosition||(p=this.getInitialLiveFragment(a,c),this.startPosition=p?this.hls.liveSyncPosition||p.start:i)}else i<=S&&(p=c[0]);return p||(p=this.getFragmentAtPosition(i,y.lowLatencyMode?a.partEnd:a.fragmentEnd,a)),null===(u=p)||void 0===u||!u.initSegment||null!==(h=p)&&void 0!==h&&h.initSegment.data||this.bitrateTest||(p=p.initSegment),p},l.getNextPart=function(i,a,u){for(var h=-1,c=!1,g=!0,p=0,y=i.length;p<y;p++){var S=i[p];if(g=g&&!S.independent,h>-1&&u<S.start)break;var D=S.loaded;!D&&(c||S.independent||g)&&S.fragment===a&&(h=p),c=D}return h},l.loadedEndOfParts=function(i,a){var u=i[i.length-1];return u&&a>u.start&&u.loaded},l.getInitialLiveFragment=function(i,a){var S,u=this.fragPrevious,h=null;if(u){if(i.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+u.programDateTime),h=function(y,S,D){if(null===S||!Array.isArray(y)||!y.length||!Object(_.a)(S)||S<(y[0].programDateTime||0)||S>=(y[y.length-1].endProgramDateTime||0))return null;D=D||0;for(var U=0;U<y.length;++U){var V=y[U];if(P(S,D,V))return V}return null}(a,u.endProgramDateTime,this.config.maxFragLookUpTolerance)),!h){var c=u.sn+1;if(c>=i.startSN&&c<=i.endSN){var g=a[c-i.startSN];u.cc===g.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(h=g).sn)}h||(S=u.cc,(h=m_search(a,function(D){return D.cc<S?1:D.cc>S?-1:0}))&&this.log("Live playlist, switching playlist, load frag with same CC: "+h.sn))}}else{var p=this.hls.liveSyncPosition;null!==p&&(h=this.getFragmentAtPosition(p,this.bitrateTest?i.fragmentEnd:i.edge,i))}return h},l.getFragmentAtPosition=function(i,a,u){var h,c=this.config,g=this.fragPrevious,p=u.fragments,y=u.endSN,S=u.fragmentHint,D=c.maxFragLookUpTolerance,U=!!(c.lowLatencyMode&&u.partList&&S);if(U&&S&&!this.bitrateTest&&(p=p.concat(S),y=S.sn),h=i<a?b(g,p,i,i>a-D?0:D):p[p.length-1]){var V=h.sn-u.startSN,it=g&&h.level===g.level,et=p[V+1];if(this.fragmentTracker.getState(h)===Pt.BACKTRACKED){h=null;for(var nt=V;p[nt]&&this.fragmentTracker.getState(p[nt])===Pt.BACKTRACKED;)h=g?p[nt--]:p[--nt];h||(h=et)}else g&&h.sn===g.sn&&!U&&it&&(h.sn<y&&this.fragmentTracker.getState(et)!==Pt.OK?(this.log("SN "+h.sn+" just loaded, load next one: "+et.sn),h=et):h=null)}return h},l.synchronizeToLiveEdge=function(i){var a=this.config,u=this.media;if(u){var h=this.hls.liveSyncPosition,c=u.currentTime,p=i.edge,y=c>=i.fragments[0].start-a.maxFragLookUpTolerance&&c<=p;null!==h&&u.duration>h&&(c<h||!y)&&(!y&&u.readyState<4||c<p-(void 0!==a.liveMaxLatencyDuration?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*i.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=h),u.readyState&&(this.warn("Playback: "+c.toFixed(3)+" is located too far from the end of live sliding playlist: "+p+", reset currentTime to : "+h.toFixed(3)),u.currentTime=h))}},l.alignPlaylists=function(i,a){var h=this.levelLastLoaded,c=this.fragPrevious,g=null!==h?this.levels[h]:null,p=i.fragments.length;if(!p)return this.warn("No fragments in live playlist"),0;var y=i.fragments[0].start,S=!a,D=i.alignedSliding&&Object(_.a)(y);if(S||!D&&!y){!function ke(d,s,t){s&&(function(e,n,r){if(l=e,a=n,r.details&&(a.endCC>a.startCC||l&&l.cc<a.startCC)){var o=function(l,i){var a=l.fragments,u=i.fragments;if(u.length&&a.length){var h=function(c,g){for(var p=null,y=0,S=c.length;y<S;y++){var D=c[y];if(D&&D.cc===g){p=D;break}}return p}(a,u[0].cc);if(h&&(!h||h.startPTS))return h;R.b.log("No frag in previous level to align on")}else R.b.log("No fragments to align")}(r.details,n);o&&Object(_.a)(o.start)&&(R.b.log("Adjusting PTS using last level due to CC increase within current level "+n.url),be(o.start,n))}var l,a}(d,t,s),!t.alignedSliding&&s.details&&function(e,n){if(n.fragments.length&&e.hasProgramDateTime&&n.hasProgramDateTime){var r=n.fragments[0].programDateTime,o=e.fragments[0].programDateTime,l=(o-r)/1e3+n.fragments[0].start;l&&Object(_.a)(l)&&(R.b.log("Adjusting PTS using programDateTime delta "+(o-r)+"ms, sliding:"+l.toFixed(3)+" "+e.url+" "),be(l,e))}}(t,s.details),t.alignedSliding||!s.details||t.skippedSegments||ge(s.details,t))}(c,g,i);var U=i.fragments[0].start;return this.log("Live playlist sliding: "+U.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+i.startSN+" prev-sn: "+(c?c.sn:"na")+" fragments: "+p),U}return y},l.waitForCdnTuneIn=function(i){return i.live&&i.canBlockReload&&i.tuneInGoal>Math.max(i.partHoldBack,3*i.partTarget)},l.setStartPosition=function(i,a){var u=this.startPosition;if(u<a&&(u=-1),-1===u||-1===this.lastCurrentTime){var h=i.startTimeOffset;Object(_.a)(h)?(u=a+h,h<0&&(u+=i.totalduration),u=Math.min(Math.max(a,u),a+i.totalduration),this.log("Start time offset "+h+" found in playlist, adjust startPosition to "+u),this.startPosition=u):i.live?u=this.hls.liveSyncPosition||a:this.startPosition=u=0,this.lastCurrentTime=u}this.nextLoadPosition=u},l.getLoadPosition=function(){var i=this.media,a=0;return this.loadedmetadata&&i?a=i.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},l.handleFragLoadAborted=function(i,a){this.transmuxer&&"initSegment"!==i.sn&&i.stats.aborted&&(this.warn("Fragment "+i.sn+(a?" part"+a.index:"")+" of level "+i.level+" was aborted"),this.resetFragmentLoading(i))},l.resetFragmentLoading=function(i){this.fragCurrent&&this.fragContextChanged(i)||(this.state=Lt)},l.onFragmentOrKeyLoadError=function(i,a){if(!a.fatal){var u=a.frag;if(u&&u.type===i){var h=this.config;if(this.fragLoadError+1<=h.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(u.level))return;var c=Math.min(Math.pow(2,this.fragLoadError)*h.fragLoadingRetryDelay,h.fragLoadingMaxRetryTimeout);this.warn("Fragment "+u.sn+" of "+i+" "+u.level+" failed to load, retrying in "+c+"ms"),this.retryDate=self.performance.now()+c,this.fragLoadError++,this.state=Rt}else a.levelRetry?(i===I.b.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Lt):(R.b.error(a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.stopLoad(),this.state=Re)}}},l.afterBufferFlushed=function(i,a,u){if(i){var h=Ct.getBuffered(i);this.fragmentTracker.detectEvictedFragments(a,h,u),this.state===Ae&&this.resetLoadingState()}},l.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=Lt},l.resetLiveStartWhenNotLoaded=function(i){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[i].details:null;if(null!=a&&a.live)return this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},l.updateLevelTiming=function(i,a,u,h){var c=this,g=u.details;Object.keys(i.elementaryStreams).reduce(function(p,y){var S=i.elementaryStreams[y];if(S){var D=S.endPTS-S.startPTS;if(D<=0)return c.warn("Could not parse fragment "+i.sn+" "+y+" duration reliably ("+D+") resetting transmuxer to fallback to playlist timing"),c.resetTransmuxer(),p||!1;var U=h?0:oe(g,i,S.startPTS,S.endPTS,S.startDTS,S.endDTS);return c.hls.trigger(f.a.LEVEL_PTS_UPDATED,{details:g,level:u,drift:U,type:y,frag:i,start:S.startPTS,end:S.endPTS}),!0}return p},!1)?(this.state=se,this.hls.trigger(f.a.FRAG_PARSED,{frag:i,part:a})):this.resetLoadingState()},l.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},(r=[{key:"state",get:function(){return this._state},set:function(i){var a=this._state;a!==i&&(this._state=i,this.log(a+"->"+i))}}])&&function Et(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(e.prototype,r),e}(he);function Ce(){return self.MediaSource||self.WebKitMediaSource}function hr(){return self.SourceBuffer||self.WebKitSourceBuffer}var ci=W(18),we=W(10),dr=W(14),Xe=Ce()||{isTypeSupported:function(){return!1}},cr=function(){function d(t,e,n,r){var o=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=n,this.onFlush=r;var l=t.config,i=function(c,g){(g=g||{}).frag=o.frag,g.id=o.id,t.trigger(c,g)};this.observer=new dr.EventEmitter,this.observer.on(f.a.FRAG_DECRYPTED,i),this.observer.on(f.a.ERROR,i);var a={mp4:Xe.isTypeSupported("video/mp4"),mpeg:Xe.isTypeSupported("audio/mpeg"),mp3:Xe.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(l.enableWorker&&typeof Worker<"u"){var h;R.b.log("demuxing in webworker");try{h=this.worker=ci(19),this.onwmsg=this.onWorkerMessage.bind(this),h.addEventListener("message",this.onwmsg),h.onerror=function(c){t.trigger(f.a.ERROR,{type:M.b.OTHER_ERROR,details:M.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},h.postMessage({cmd:"init",typeSupported:a,vendor:u,id:e,config:JSON.stringify(l)})}catch(c){R.b.warn("Error in worker:",c),R.b.error("Error while initializing DemuxerWorker, fallback to inline"),h&&self.URL.revokeObjectURL(h.objectURL),this.transmuxer=new we.c(this.observer,a,l,u,e),this.worker=null}}else this.transmuxer=new we.c(this.observer,a,l,u,e)}var s=d.prototype;return s.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.observer=null},s.push=function(t,e,n,r,o,l,i,a,u,h){var c,g,p=this;u.transmuxing.start=self.performance.now();var y=this.transmuxer,S=this.worker,D=l?l.start:o.start,U=o.decryptdata,V=this.frag,it=!(V&&o.cc===V.cc),et=!(V&&u.level===V.level),nt=V?u.sn-V.sn:-1,vt=this.part?u.part-this.part.index:1,dt=!et&&(1===nt||0===nt&&1===vt),pt=self.performance.now();(et||nt||0===o.stats.parsing.start)&&(o.stats.parsing.start=pt),!l||!vt&&dt||(l.stats.parsing.start=pt);var Mt=!(V&&(null===(c=o.initSegment)||void 0===c?void 0:c.url)===(null===(g=V.initSegment)||void 0===g?void 0:g.url)),Vt=new we.b(it,dt,a,et,D,Mt);if(!dt||it||Mt){R.b.log("[transmuxer-interface, "+o.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+"\n        discontinuity: "+it+"\n        trackSwitch: "+et+"\n        contiguous: "+dt+"\n        accurateTimeOffset: "+a+"\n        timeOffset: "+D+"\n        initSegmentChange: "+Mt);var Xt=new we.a(n,r,e,i,h);this.configureTransmuxer(Xt)}if(this.frag=o,this.part=l,S)S.postMessage({cmd:"demux",data:t,decryptdata:U,chunkMeta:u,state:Vt},t instanceof ArrayBuffer?[t]:[]);else if(y){var Wt=y.push(t,U,u,Vt);Object(we.d)(Wt)?Wt.then(function(zt){p.handleTransmuxComplete(zt)}):this.handleTransmuxComplete(Wt)}},s.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:t});else if(n){var o=n.flush(t);Object(we.d)(o)?o.then(function(l){e.handleFlushResult(l,t)}):this.handleFlushResult(o,t)}},s.handleFlushResult=function(t,e){var n=this;t.forEach(function(r){n.handleTransmuxComplete(r)}),this.onFlush(e)},s.onWorkerMessage=function(t){var e=t.data,n=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}},s.configureTransmuxer=function(t){var e=this.worker,n=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):n&&n.configure(t)},s.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},d}(),fi=function(){function d(t,e,n,r){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=n,this.hls=r}var s=d.prototype;return s.destroy=function(){this.hls=this.fragmentTracker=this.media=null},s.poll=function(t){var e=this.config,n=this.media,r=this.stalled,o=n.currentTime,l=n.seeking,i=this.seeking&&!l,a=!this.seeking&&l;if(this.seeking=l,o===t){if((a||i)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&Ct.getBuffered(n).length){var u=Ct.bufferInfo(n,o,0),c=u.nextStart||0;if(u.len>0||c){if(l){var g=u.len>2,p=!c||c-o>2&&!this.fragmentTracker.getPartialFragment(o);if(g||p)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var y,S=Math.max(c,u.start||0)-o,D=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,U=null!=D&&null!==(y=D.details)&&void 0!==y&&y.live?2*D.details.targetduration:2;if(S>0&&S<=U)return void this._trySkipBufferHole(null)}var V=self.performance.now();if(null!==r){var it=V-r;!l&&it>=250&&this._reportStall(u.len);var et=Ct.bufferInfo(n,o,e.maxBufferHole);this._tryFixBufferStall(et,it)}else this.stalled=V}}}else if(this.moved=!0,null!==r){if(this.stallReported){var nt=self.performance.now()-r;R.b.warn("playback not stuck anymore @"+o+", after "+Math.round(nt)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},s._tryFixBufferStall=function(t,e){var n=this.config,l=this.fragmentTracker.getPartialFragment(this.media.currentTime);l&&this._trySkipBufferHole(l)||t.len>n.maxBufferHole&&e>1e3*n.highBufferWatchdogPeriod&&(R.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},s._reportStall=function(t){var e=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,R.b.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},s._trySkipBufferHole=function(t){for(var e=this.config,n=this.hls,r=this.media,o=r.currentTime,l=0,i=Ct.getBuffered(r),a=0;a<i.length;a++){var u=i.start(a);if(o+e.maxBufferHole>=l&&o<u){var h=Math.max(u+.05,r.currentTime+.1);return R.b.warn("skipping hole, adjusting currentTime from "+o+" to "+h),this.moved=!0,this.stalled=null,r.currentTime=h,t&&n.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+o+" to "+h,frag:t}),h}l=i.end(a)}return 0},s._tryNudgeBuffer=function(){var t=this.config,e=this.hls,n=this.media,r=n.currentTime,o=(this.nudgeRetry||0)+1;if(this.nudgeRetry=o,o<t.nudgeMaxRetry){var l=r+o*t.nudgeOffset;R.b.warn("Nudging 'currentTime' from "+r+" to "+l),n.currentTime=l,e.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.b.error("Playhead still not moving while enough data buffered @"+r+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_STALLED_ERROR,fatal:!0})},d}();function gr(d,s){return(gr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}var gi=function(d){var s,t;function e(i,a){var u;return(u=d.call(this,i,a,"[stream-controller]")||this).audioCodecSwap=!1,u.gapController=null,u.level=-1,u._forceStartLoad=!1,u.altAudio=!1,u.audioOnly=!1,u.fragPlaying=null,u.onvplaying=null,u.onvseeked=null,u.fragLastKbps=0,u.stalled=!1,u.couldBacktrack=!1,u.audioCodecSwitch=!1,u.videoBuffer=null,u._registerListeners(),u}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,gr(s,t);var r,l=e.prototype;return l._registerListeners=function(){var i=this.hls;i.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.on(f.a.MANIFEST_PARSED,this.onManifestParsed,this),i.on(f.a.LEVEL_LOADING,this.onLevelLoading,this),i.on(f.a.LEVEL_LOADED,this.onLevelLoaded,this),i.on(f.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.on(f.a.ERROR,this.onError,this),i.on(f.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(f.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(f.a.BUFFER_CREATED,this.onBufferCreated,this),i.on(f.a.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(f.a.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(f.a.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var i=this.hls;i.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.off(f.a.MANIFEST_PARSED,this.onManifestParsed,this),i.off(f.a.LEVEL_LOADED,this.onLevelLoaded,this),i.off(f.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.off(f.a.ERROR,this.onError,this),i.off(f.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(f.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(f.a.BUFFER_CREATED,this.onBufferCreated,this),i.off(f.a.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(f.a.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(f.a.FRAG_BUFFERED,this.onFragBuffered,this)},l.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},l.startLoad=function(i){if(this.levels){var a=this.lastCurrentTime,u=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=u.startLevel;-1===h&&(u.config.testBandwidth?(h=0,this.bitrateTest=!0):h=u.nextAutoLevel),this.level=u.nextLoadLevel=h,this.loadedmetadata=!1}a>0&&-1===i&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),i=a),this.state=Lt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()}else this._forceStartLoad=!0,this.state=Ot},l.stopLoad=function(){this._forceStartLoad=!1,d.prototype.stopLoad.call(this)},l.doTick=function(){switch(this.state){case Lt:this.doTickIdle();break;case ce:var i,a=this.levels,h=null==a||null===(i=a[this.level])||void 0===i?void 0:i.details;if(h&&(!h.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(h))break;this.state=Lt;break}break;case Rt:var c,g=self.performance.now(),p=this.retryDate;(!p||g>=p||null!==(c=this.media)&&void 0!==c&&c.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=Lt)}this.onTickEnd()},l.onTickEnd=function(){d.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},l.doTickIdle=function(){var i,a,u=this.hls,c=this.levels,g=this.media,y=u.nextLoadLevel;if(null!==this.levelLastLoaded&&(g||!this.startFragRequested&&u.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&c&&c[y]){var S=c[y];this.level=u.nextLoadLevel=y;var D=S.details;if(!D||this.state===ce||D.live&&this.levelLastLoaded!==y)this.state=ce;else{var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:g,I.b.MAIN);if(null!==U&&!(U.len>=this.getMaxBufferLength(S.maxBitrate))){if(this._streamEnded(U,D)){var V={};return this.altAudio&&(V.type="video"),this.hls.trigger(f.a.BUFFER_EOS,V),void(this.state=Ae)}var it=U.end,et=this.getNextFragment(it,D);if(this.couldBacktrack&&!this.fragPrevious&&et&&"initSegment"!==et.sn){var nt=et.sn-D.startSN;nt>1&&this.fragmentTracker.removeFragment(et=D.fragments[nt-1])}et&&this.fragmentTracker.getState(et)===Pt.OK&&this.nextLoadPosition>it&&(this.afterBufferFlushed(g,this.audioOnly&&!this.altAudio?q.a.AUDIO:q.a.VIDEO,I.b.MAIN),et=this.getNextFragment(this.nextLoadPosition,D)),et&&(!et.initSegment||et.initSegment.data||this.bitrateTest||(et=et.initSegment),"identity"!==(null===(i=et.decryptdata)||void 0===i?void 0:i.keyFormat)||null!==(a=et.decryptdata)&&void 0!==a&&a.key?this.loadFragment(et,D,it):this.loadKey(et,D))}}}},l.loadFragment=function(i,a,u){var h,c=this.fragmentTracker.getState(i);if(this.fragCurrent=i,c===Pt.BACKTRACKED){var g=this.fragmentTracker.getBacktrackData(i);if(g)return this._handleFragmentLoadProgress(g),void this._handleFragmentLoadComplete(g);c=Pt.NOT_LOADED}c===Pt.NOT_LOADED||c===Pt.PARTIAL?"initSegment"===i.sn?this._loadInitSegment(i):this.bitrateTest?(i.bitrateTest=!0,this.log("Fragment "+i.sn+" of level "+i.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(i)):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,i,a,u)):c===Pt.APPENDING?this.reduceMaxBufferLength(i.duration)&&this.fragmentTracker.removeFragment(i):0===(null===(h=this.media)||void 0===h?void 0:h.buffered.length)&&this.fragmentTracker.removeAllFragments()},l.getAppendedFrag=function(i){var a=this.fragmentTracker.getAppendedFrag(i,I.b.MAIN);return a&&"fragment"in a?a.fragment:a},l.getBufferedFrag=function(i){return this.fragmentTracker.getBufferedFrag(i,I.b.MAIN)},l.followingBufferedFrag=function(i){return i?this.getBufferedFrag(i.end+.5):null},l.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},l.nextLevelSwitch=function(){var i=this.levels,a=this.media;if(null!=a&&a.readyState){var u,h=this.getAppendedFrag(a.currentTime);if(h&&h.start>1&&this.flushMainBuffer(0,h.start-1),!a.paused&&i){var g=this.fragLastKbps;u=g&&this.fragCurrent?this.fragCurrent.duration*i[this.hls.nextLoadLevel].maxBitrate/(1e3*g)+1:0}else u=0;var p=this.getBufferedFrag(a.currentTime+u);if(p){var y=this.followingBufferedFrag(p);if(y){this.abortCurrentFrag();var D=y.duration,U=Math.max(p.end,(y.maxStartPTS?y.maxStartPTS:y.start)+Math.min(Math.max(D-this.config.maxFragLookUpTolerance,.5*D),.75*D));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},l.abortCurrentFrag=function(){var i=this.fragCurrent;this.fragCurrent=null,null!=i&&i.loader&&i.loader.abort(),this.state===de&&(this.state=Lt),this.nextLoadPosition=this.getLoadPosition()},l.flushMainBuffer=function(i,a){d.prototype.flushMainBuffer.call(this,i,a,this.altAudio?"video":null)},l.onMediaAttached=function(i,a){d.prototype.onMediaAttached.call(this,i,a);var u=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),u.addEventListener("playing",this.onvplaying),u.addEventListener("seeked",this.onvseeked),this.gapController=new fi(this.config,u,this.fragmentTracker,this.hls)},l.onMediaDetaching=function(){var i=this.media;i&&(i.removeEventListener("playing",this.onvplaying),i.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),d.prototype.onMediaDetaching.call(this)},l.onMediaPlaying=function(){this.tick()},l.onMediaSeeked=function(){var i=this.media,a=i?i.currentTime:null;Object(_.a)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},l.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(f.a.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},l.onManifestParsed=function(i,a){var u,h,c,g=!1,p=!1;a.levels.forEach(function(y){(u=y.audioCodec)&&(-1!==u.indexOf("mp4a.40.2")&&(g=!0),-1!==u.indexOf("mp4a.40.5")&&(p=!0))}),this.audioCodecSwitch=g&&p&&"function"!=typeof(null==(c=hr())||null===(h=c.prototype)||void 0===h?void 0:h.changeType),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},l.onLevelLoading=function(i,a){var u=this.levels;if(u&&this.state===Lt){var h=u[a.level];(!h.details||h.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(h.details))&&(this.state=ce)}},l.onLevelLoaded=function(i,a){var u,h=this.levels,c=a.level,g=a.details;if(h){this.log("Level "+c+" loaded ["+g.startSN+","+g.endSN+"], cc ["+g.startCC+", "+g.endCC+"] duration:"+g.totalduration);var y=this.fragCurrent;!y||this.state!==xt&&this.state!==Rt||y.level!==a.level&&y.loader&&(this.state=Lt,y.loader.abort());var S=h[c],D=0;if(g.live||null!==(u=S.details)&&void 0!==u&&u.live){if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed)return;D=this.alignPlaylists(g,S.details)}if(S.details=g,this.levelLastLoaded=c,this.hls.trigger(f.a.LEVEL_UPDATED,{details:g,level:c}),this.state===ce){if(this.waitForCdnTuneIn(g))return;this.state=Lt}this.startFragRequested?g.live&&this.synchronizeToLiveEdge(g):this.setStartPosition(g,D),this.tick()}else this.warn("Levels were reset while loading level "+c)},l._handleFragmentLoadProgress=function(i){var a,u=i.frag,h=i.part,c=i.payload,g=this.levels;if(g){var p=g[u.level],y=p.details;if(y){var S=p.videoCodec,D=y.PTSKnown||!y.live,U=null===(a=u.initSegment)||void 0===a?void 0:a.data,V=this._getAudioCodec(p),it=this.transmuxer=this.transmuxer||new cr(this.hls,I.b.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),et=h?h.index:-1,vt=new Te(u.level,u.sn,u.stats.chunkCount,c.byteLength,et,-1!==et);it.push(c,U,V,S,u,h,y.totalduration,D,vt,this.initPTS[u.cc])}else this.warn("Dropping fragment "+u.sn+" of level "+u.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered")},l.onAudioTrackSwitching=function(i,a){var u=this.altAudio,c=a.id;if(!a.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var g=this.fragCurrent;null!=g&&g.loader&&(this.log("Switching to main audio track, cancel main fragment load"),g.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var p=this.hls;u&&p.trigger(f.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),p.trigger(f.a.AUDIO_TRACK_SWITCHED,{id:c})}},l.onAudioTrackSwitched=function(i,a){var h=!!this.hls.audioTracks[a.id].url;if(h){var c=this.videoBuffer;c&&this.mediaBuffer!==c&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=c)}this.altAudio=h,this.tick()},l.onBufferCreated=function(i,a){var u,h,c=a.tracks,g=!1;for(var p in c){var y=c[p];if("main"===y.id){if(h=p,u=y,"video"===p){var S=c[p];S&&(this.videoBuffer=S.buffer)}}else g=!0}g&&u?(this.log("Alternate track found, use "+h+".buffered to schedule main fragment loading"),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media},l.onFragBuffered=function(i,a){var u=a.frag,h=a.part;if(!u||u.type===I.b.MAIN){if(this.fragContextChanged(u))return this.warn("Fragment "+u.sn+(h?" p: "+h.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===se&&(this.state=Lt));var c=h?h.stats:u.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),"initSegment"!==u.sn&&(this.fragPrevious=u),this.fragBufferedComplete(u,h)}},l.onError=function(i,a){switch(a.details){case M.a.FRAG_LOAD_ERROR:case M.a.FRAG_LOAD_TIMEOUT:case M.a.KEY_LOAD_ERROR:case M.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(I.b.MAIN,a);break;case M.a.LEVEL_LOAD_ERROR:case M.a.LEVEL_LOAD_TIMEOUT:this.state!==Re&&(a.fatal?(this.warn(""+a.details),this.state=Re):a.levelRetry||this.state!==ce||(this.state=Lt));break;case M.a.BUFFER_FULL_ERROR:if("main"===a.parent&&(this.state===Ut||this.state===se)){var u=!0,h=this.getFwdBufferInfo(this.media,I.b.MAIN);h&&h.len>.5&&(u=!this.reduceMaxBufferLength(h.len)),u&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},l.checkBuffer=function(){var i=this.media,a=this.gapController;if(i&&a&&i.readyState){var u=Ct.getBuffered(i);!this.loadedmetadata&&u.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=i.currentTime}},l.onFragLoadEmergencyAborted=function(){this.state=Lt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},l.onBufferFlushed=function(i,a){var u=a.type;(u!==q.a.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((u===q.a.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,u,I.b.MAIN)},l.onLevelsUpdated=function(i,a){this.levels=a.levels},l.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},l.seekToStartPos=function(){var i=this.media,a=i.currentTime,u=this.startPosition;if(u>=0&&a<u){if(i.seeking)return void R.b.log("could not seek to "+u+", already seeking at "+a);var h=Ct.getBuffered(i),c=(h.length?h.start(0):0)-u;c>0&&(c<this.config.maxBufferHole||c<this.config.maxFragLookUpTolerance)&&(R.b.log("adjusting start position by "+c+" to match buffer start"),this.startPosition=u+=c),this.log("seek to target start position "+u+" from current time "+a),i.currentTime=u}},l._getAudioCodec=function(i){var a=this.config.defaultAudioCodec||i.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),a},l._loadBitrateTestFrag=function(i){var a=this;this._doFragLoad(i).then(function(u){var h=a.hls;if(u&&!h.nextLoadLevel&&!a.fragContextChanged(i)){a.fragLoadError=0,a.state=Lt,a.startFragRequested=!1,a.bitrateTest=!1;var c=i.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),h.trigger(f.a.FRAG_LOADED,u)}})},l._handleTransmuxComplete=function(i){var a,u="main",h=this.hls,c=i.remuxResult,g=i.chunkMeta,p=this.getCurrentContext(g);if(!p)return this.warn("The loading context changed while buffering fragment "+g.sn+" of level "+g.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(g.level);var y=p.frag,S=p.part,D=p.level,U=c.video,V=c.text,it=c.id3,et=c.initSegment,nt=this.altAudio?void 0:c.audio;if(!this.fragContextChanged(y)){if(this.state=Ut,et){et.tracks&&(this._bufferInitSegment(D,et.tracks,y,g),h.trigger(f.a.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:u,tracks:et.tracks}));var vt=et.initPTS,dt=et.timescale;Object(_.a)(vt)&&(this.initPTS[y.cc]=vt,h.trigger(f.a.INIT_PTS_FOUND,{frag:y,id:u,initPTS:vt,timescale:dt}))}if(U&&!1!==c.independent){if(D.details){var pt=U.startPTS,Mt=U.endPTS,Vt=U.startDTS,Xt=U.endDTS;if(S)S.elementaryStreams[U.type]={startPTS:pt,endPTS:Mt,startDTS:Vt,endDTS:Xt};else if(U.firstKeyFrame&&U.independent&&(this.couldBacktrack=!0),U.dropped&&U.independent){if(this.getLoadPosition()+this.config.maxBufferHole<pt)return void this.backtrack(y);y.setElementaryStreamInfo(U.type,y.start,Mt,y.start,Xt,!0)}y.setElementaryStreamInfo(U.type,pt,Mt,Vt,Xt),this.bufferFragmentData(U,y,S,g)}}else if(!1===c.independent)return void this.backtrack(y);if(nt){var Wt=nt.startPTS,zt=nt.endPTS,ee=nt.startDTS,me=nt.endDTS;S&&(S.elementaryStreams[q.a.AUDIO]={startPTS:Wt,endPTS:zt,startDTS:ee,endDTS:me}),y.setElementaryStreamInfo(q.a.AUDIO,Wt,zt,ee,me),this.bufferFragmentData(nt,y,S,g)}null!=it&&null!==(a=it.samples)&&void 0!==a&&a.length&&h.trigger(f.a.FRAG_PARSING_METADATA,{frag:y,id:u,samples:it.samples}),V&&h.trigger(f.a.FRAG_PARSING_USERDATA,{frag:y,id:u,samples:V.samples})}},l._bufferInitSegment=function(i,a,u,h){var c=this;if(this.state===Ut){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var g=a.audio,p=a.video,y=a.audiovideo;if(g){var S=i.audioCodec,D=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(S&&(S=-1!==S.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==g.metadata.channelCount&&-1===D.indexOf("firefox")&&(S="mp4a.40.5")),-1!==D.indexOf("android")&&"audio/mpeg"!==g.container&&this.log("Android: force audio codec to "+(S="mp4a.40.2")),i.audioCodec&&i.audioCodec!==S&&this.log('Swapping manifest audio codec "'+i.audioCodec+'" for "'+S+'"'),g.levelCodec=S,g.id="main",this.log("Init audio buffer, container:"+g.container+", codecs[selected/level/parsed]=["+(S||"")+"/"+(i.audioCodec||"")+"/"+g.codec+"]")}p&&(p.levelCodec=i.videoCodec,p.id="main",this.log("Init video buffer, container:"+p.container+", codecs[level/parsed]=["+(i.videoCodec||"")+"/"+p.codec+"]")),y&&this.log("Init audiovideo buffer, container:"+y.container+", codecs[level/parsed]=["+(i.attrs.CODECS||"")+"/"+y.codec+"]"),this.hls.trigger(f.a.BUFFER_CODECS,a),Object.keys(a).forEach(function(U){var V=a[U].initSegment;null!=V&&V.byteLength&&c.hls.trigger(f.a.BUFFER_APPENDING,{type:U,data:V,frag:u,part:null,chunkMeta:h,parent:u.type})}),this.tick()}},l.backtrack=function(i){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(i);var a=this.fragmentTracker.backtrack(i);this.fragPrevious=null,this.nextLoadPosition=i.start,a?this.resetFragmentLoading(i):this.state=Se},l.checkFragmentChanged=function(){var i=this.media,a=null;if(i&&i.readyState>1&&!1===i.seeking){var u=i.currentTime;if(Ct.isBuffered(i,u)?a=this.getAppendedFrag(u):Ct.isBuffered(i,u+.1)&&(a=this.getAppendedFrag(u+.1)),a){var h=this.fragPlaying,c=a.level;h&&a.sn===h.sn&&h.level===c&&a.urlId===h.urlId||(this.hls.trigger(f.a.FRAG_CHANGED,{frag:a}),h&&h.level===c||this.hls.trigger(f.a.LEVEL_SWITCHED,{level:c}),this.fragPlaying=a)}}},(r=[{key:"nextLevel",get:function(){var i=this.nextBufferedFrag;return i?i.level:-1}},{key:"currentLevel",get:function(){var i=this.media;if(i){var a=this.getAppendedFrag(i.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var i=this.media;if(i){var a=this.getAppendedFrag(i.currentTime);return this.followingBufferedFrag(a)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&function fr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(e.prototype,r),e}(ne),Ke=function(){function d(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=n}var s=d.prototype;return s.sample=function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t},s.getTotalWeight=function(){return this.totalWeight_},s.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},d}(),vi=function(){function d(t,e,n){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ke(t),this.fast_=new Ke(e)}var s=d.prototype;return s.update=function(t,e){var n=this.slow_,r=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new Ke(t,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new Ke(e,r.getEstimate(),r.getTotalWeight()))},s.sample=function(t,e){var n=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*e/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},s.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},s.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},s.destroy=function(){},d}();var pi=function(){function d(r){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=r;var o=r.config;this.bwEstimator=new vi(o.abrEwmaSlowVoD,o.abrEwmaFastVoD,o.abrEwmaDefaultEstimate),this.registerListeners()}var t,n=d.prototype;return n.registerListeners=function(){var r=this.hls;r.on(f.a.FRAG_LOADING,this.onFragLoading,this),r.on(f.a.FRAG_LOADED,this.onFragLoaded,this),r.on(f.a.FRAG_BUFFERED,this.onFragBuffered,this),r.on(f.a.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.a.ERROR,this.onError,this)},n.unregisterListeners=function(){var r=this.hls;r.off(f.a.FRAG_LOADING,this.onFragLoading,this),r.off(f.a.FRAG_LOADED,this.onFragLoaded,this),r.off(f.a.FRAG_BUFFERED,this.onFragBuffered,this),r.off(f.a.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.a.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},n.onFragLoading=function(r,o){var l,i=o.frag;i.type===I.b.MAIN&&(this.timer||(this.fragCurrent=i,this.partCurrent=null!=(l=o.part)?l:null,this.timer=self.setInterval(this.onCheck,100)))},n.onLevelLoaded=function(r,o){var l=this.hls.config;o.details.live?this.bwEstimator.update(l.abrEwmaSlowLive,l.abrEwmaFastLive):this.bwEstimator.update(l.abrEwmaSlowVoD,l.abrEwmaFastVoD)},n._abandonRulesCheck=function(){var r=this.fragCurrent,o=this.partCurrent,l=this.hls,i=l.autoLevelEnabled,a=l.config,u=l.media;if(r&&u){var h=o?o.stats:r.stats,c=o?o.duration:r.duration;if(h.aborted)return R.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!u.paused&&u.playbackRate&&u.readyState){var g=performance.now()-h.loading.start,p=Math.abs(u.playbackRate);if(!(g<=500*c/p)){var y=l.levels,S=l.minAutoLevel,U=h.total||Math.max(h.loaded,Math.round(c*y[r.level].maxBitrate/8)),V=Math.max(1,h.bwEstimate?h.bwEstimate/8:1e3*h.loaded/g),it=(U-h.loaded)/V,et=u.currentTime,nt=(Ct.bufferInfo(u,et,a.maxBufferHole).end-et)/p;if(!(nt>=2*c/p||it<=nt)){var vt,dt=Number.POSITIVE_INFINITY;for(vt=r.level-1;vt>S&&!((dt=c*y[vt].maxBitrate/(6.4*V))<nt);vt--);if(!(dt>=it)){var pt=this.bwEstimator.getEstimate();R.b.warn("Fragment "+r.sn+(o?" part "+o.index:"")+" of level "+r.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+vt+"\n      Current BW estimate: "+(Object(_.a)(pt)?(pt/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+it.toFixed(3)+" s\n      Estimated load time for the next fragment: "+dt.toFixed(3)+" s\n      Time to underbuffer: "+nt.toFixed(3)+" s"),l.nextLoadLevel=vt,this.bwEstimator.sample(g,h.loaded),this.clearTimer(),r.loader&&(this.fragCurrent=this.partCurrent=null,r.loader.abort()),l.trigger(f.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:o,stats:h})}}}}}},n.onFragLoaded=function(r,o){var l=o.frag,i=o.part;if(l.type===I.b.MAIN&&Object(_.a)(l.sn)){var a=i?i.stats:l.stats,u=i?i.duration:l.duration;if(this.clearTimer(),this.lastLoadedFragLevel=l.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var h=this.hls.levels[l.level],c=(h.loaded?h.loaded.bytes:0)+a.loaded,g=(h.loaded?h.loaded.duration:0)+u;h.loaded={bytes:c,duration:g},h.realBitrate=Math.round(8*c/g)}l.bitrateTest&&(this.onFragBuffered(f.a.FRAG_BUFFERED,{stats:a,frag:l,part:i,id:l.type}),l.bitrateTest=!1)}},n.onFragBuffered=function(r,o){var l=o.frag,i=o.part,a=i?i.stats:l.stats;if(!a.aborted&&l.type===I.b.MAIN&&"initSegment"!==l.sn){var u=a.parsing.end-a.loading.start;this.bwEstimator.sample(u,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=l.bitrateTest?u/1e3:0}},n.onError=function(r,o){switch(o.details){case M.a.FRAG_LOAD_ERROR:case M.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},n.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},n.getNextABRAutoLevel=function(){var r=this.fragCurrent,o=this.partCurrent,l=this.hls,i=l.maxAutoLevel,a=l.config,u=l.minAutoLevel,h=l.media,c=o?o.duration:r?r.duration:0,g=h?h.currentTime:0,p=h&&0!==h.playbackRate?Math.abs(h.playbackRate):1,y=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,S=(Ct.bufferInfo(h,g,a.maxBufferHole).end-g)/p,D=this.findBestLevel(y,u,i,S,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(D>=0)return D;R.b.trace((S?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var U=c?Math.min(c,a.maxStarvationDelay):a.maxStarvationDelay,V=a.abrBandWidthFactor,it=a.abrBandWidthUpFactor;if(!S){var et=this.bitrateTestDelay;et&&(U=(c?Math.min(c,a.maxLoadingDelay):a.maxLoadingDelay)-et,R.b.trace("bitrate test took "+Math.round(1e3*et)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*U)+" ms"),V=it=1)}return D=this.findBestLevel(y,u,i,S+U,V,it),Math.max(D,0)},n.findBestLevel=function(r,o,l,i,a,u){for(var h,c=this.fragCurrent,g=this.partCurrent,p=this.lastLoadedFragLevel,y=this.hls.levels,S=y[p],D=!(null==S||null===(h=S.details)||void 0===h||!h.live),U=S?.codecSet,V=g?g.duration:c?c.duration:0,it=l;it>=o;it--){var et=y[it];if(et&&(!U||et.codecSet===U)){var dt,nt=et.details,vt=(g?nt?.partTarget:nt?.averagetargetduration)||V,pt=y[it].maxBitrate,Mt=pt*vt/(dt=it<=p?a*r:u*r);if(R.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+it+"/"+Math.round(dt)+"/"+pt+"/"+vt+"/"+i+"/"+Mt),dt>pt&&(!Mt||D&&!this.bitrateTestDelay||Mt<i))return it}}return-1},(t=[{key:"nextAutoLevel",get:function(){var r=this._nextAutoLevel,o=this.bwEstimator;if(!(-1===r||o&&o.canEstimate()))return r;var l=this.getNextABRAutoLevel();return-1!==r&&(l=Math.min(r,l)),l},set:function(r){this._nextAutoLevel=r}}])&&function vr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(d.prototype,t),d}(),pr=W(13);function ze(){return(ze=Object.assign||function(d){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}return d}).apply(this,arguments)}function mr(d,s){return(mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}var mi=function(d){var s,t;function e(r,o){var l;return(l=d.call(this,r,o,"[audio-stream-controller]")||this).videoBuffer=null,l.videoTrackCC=-1,l.waitingVideoCC=-1,l.audioSwitch=!1,l.trackId=-1,l.waitingData=null,l.mainDetails=null,l.bufferFlushed=!1,l._registerListeners(),l}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,mr(s,t);var n=e.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},n._registerListeners=function(){var r=this.hls;r.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.a.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(f.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(f.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(f.a.ERROR,this.onError,this),r.on(f.a.BUFFER_RESET,this.onBufferReset,this),r.on(f.a.BUFFER_CREATED,this.onBufferCreated,this),r.on(f.a.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(f.a.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(f.a.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var r=this.hls;r.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.a.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(f.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(f.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(f.a.ERROR,this.onError,this),r.off(f.a.BUFFER_RESET,this.onBufferReset,this),r.off(f.a.BUFFER_CREATED,this.onBufferCreated,this),r.off(f.a.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(f.a.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(f.a.FRAG_BUFFERED,this.onFragBuffered,this)},n.onInitPtsFound=function(r,o){var l=o.frag,a=o.initPTS;if("main"===o.id){var u=l.cc;this.initPTS[l.cc]=a,this.log("InitPTS for cc: "+u+" found from main: "+a),this.videoTrackCC=u,this.state===ye&&this.tick()}},n.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=Ot);var o=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,o>0&&-1===r?(this.log("Override startPosition with lastCurrentTime @"+o.toFixed(3)),this.state=Lt):(this.loadedmetadata=!1,this.state=Ee),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},n.doTick=function(){switch(this.state){case Lt:this.doTickIdle();break;case Ee:var r,o=this.levels,i=null==o||null===(r=o[this.trackId])||void 0===r?void 0:r.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=ye}break;case Rt:var a,u=performance.now(),h=this.retryDate;(!h||u>=h||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=Lt);break;case ye:var c=this.waitingData;if(c){var g=c.frag,p=c.part,y=c.cache,S=c.complete;if(void 0!==this.initPTS[g.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=xt;var D={frag:g,part:p,payload:y.flush(),networkDetails:null};this._handleFragmentLoadProgress(D),S&&d.prototype._handleFragmentLoadComplete.call(this,D)}else if(this.videoTrackCC!==this.waitingVideoCC)R.b.log("Waiting fragment cc ("+g.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),V=Ct.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);L(V.end,this.config.maxFragLookUpTolerance,g)<0&&(R.b.log("Waiting fragment cc ("+g.cc+") @ "+g.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=Lt}this.onTickEnd()},n.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Lt)},n.onTickEnd=function(){var r=this.media;r&&r.readyState&&(!this.loadedmetadata&&(this.mediaBuffer?this.mediaBuffer:r).buffered.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime)},n.doTickIdle=function(){var r,o,l=this.hls,i=this.levels,a=this.media,u=this.trackId;if(i&&i[u]&&(a||!this.startFragRequested&&l.config.startFragPrefetch)){var c=i[u].details;if(!c||c.live&&this.levelLastLoaded!==u||this.waitForCdnTuneIn(c))this.state=Ee;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,q.a.AUDIO,I.b.AUDIO));var g=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,I.b.AUDIO);if(null!==g){var p=g.len,y=this.getMaxBufferLength(),S=this.audioSwitch;if(!(p>=y)||S){if(!S&&this._streamEnded(g,c))return l.trigger(f.a.BUFFER_EOS,{type:"audio"}),void(this.state=Ae);var D=c.fragments[0].start,U=g.end;if(S){var V=this.getLoadPosition();U=V,c.PTSKnown&&V<D&&(g.end>D||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=D+.05)}var it=this.getNextFragment(U,c);it?"identity"!==(null===(r=it.decryptdata)||void 0===r?void 0:r.keyFormat)||null!==(o=it.decryptdata)&&void 0!==o&&o.key?this.loadFragment(it,c,U):this.loadKey(it,c):this.bufferFlushed=!0}}}}},n.getMaxBufferLength=function(){var r=d.prototype.getMaxBufferLength.call(this),o=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,I.b.MAIN);return null===o?r:Math.max(r,o.len)},n.onMediaDetaching=function(){this.videoBuffer=null,d.prototype.onMediaDetaching.call(this)},n.onAudioTracksUpdated=function(r,o){var l=o.audioTracks;this.resetTransmuxer(),this.levels=l.map(function(i){return new _t(i)})},n.onAudioTrackSwitching=function(r,o){var l=!!o.url;this.trackId=o.id;var i=this.fragCurrent;null!=i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),l?this.setInterval(100):this.resetTransmuxer(),l?(this.audioSwitch=!0,this.state=Lt):this.state=Ot,this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},n.onLevelLoaded=function(r,o){this.mainDetails=o.details},n.onAudioTrackLoaded=function(r,o){var l,i=this.levels,a=o.details,u=o.id;if(i){this.log("Track "+u+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var h=i[u],c=0;if(a.live||null!==(l=h.details)&&void 0!==l&&l.live){var g=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!g)return;!h.details&&a.hasProgramDateTime&&g.hasProgramDateTime?(A(a,g),c=a.fragments[0].start):c=this.alignPlaylists(a,h.details)}h.details=a,this.levelLastLoaded=u,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(h.details,c),this.state!==Ee||this.waitForCdnTuneIn(a)||(this.state=Lt),this.tick()}else this.warn("Audio tracks were reset while loading level "+u)},n._handleFragmentLoadProgress=function(r){var o,l=r.frag,i=r.part,a=r.payload,h=this.trackId,c=this.levels;if(c){var g=c[h],p=g.details,y=this.config.defaultAudioCodec||g.audioCodec||"mp4a.40.2",S=this.transmuxer;S||(S=this.transmuxer=new cr(this.hls,I.b.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var D=this.initPTS[l.cc],U=null===(o=l.initSegment)||void 0===o?void 0:o.data;if(void 0!==D){var V=i?i.index:-1,et=new Te(l.level,l.sn,l.stats.chunkCount,a.byteLength,V,-1!==V);S.push(a,U,y,"",l,i,p.totalduration,!1,et,D)}else R.b.log("Unknown video PTS for cc "+l.cc+", waiting for video PTS before demuxing audio frag "+l.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+h),(this.waitingData=this.waitingData||{frag:l,part:i,cache:new pr.a,complete:!1}).cache.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=ye}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered")},n._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:d.prototype._handleFragmentLoadComplete.call(this,r)},n.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},n.onBufferCreated=function(r,o){var l=o.tracks.audio;l&&(this.mediaBuffer=l.buffer),o.tracks.video&&(this.videoBuffer=o.tracks.video.buffer)},n.onFragBuffered=function(r,o){var l=o.frag,i=o.part;l.type===I.b.AUDIO&&(this.fragContextChanged(l)?this.warn("Fragment "+l.sn+(i?" p: "+i.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==l.sn&&(this.fragPrevious=l,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(f.a.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(l,i)))},n.onError=function(r,o){switch(o.details){case M.a.FRAG_LOAD_ERROR:case M.a.FRAG_LOAD_TIMEOUT:case M.a.KEY_LOAD_ERROR:case M.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(I.b.AUDIO,o);break;case M.a.AUDIO_TRACK_LOAD_ERROR:case M.a.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Re&&this.state!==Ot&&(this.state=o.fatal?Re:Lt,this.warn(o.details+" while loading frag, switching to "+this.state+" state"));break;case M.a.BUFFER_FULL_ERROR:if("audio"===o.parent&&(this.state===Ut||this.state===se)){var l=!0,i=this.getFwdBufferInfo(this.mediaBuffer,I.b.AUDIO);i&&i.len>.5&&(l=!this.reduceMaxBufferLength(i.len)),l&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},n.onBufferFlushed=function(r,o){o.type===q.a.AUDIO&&(this.bufferFlushed=!0)},n._handleTransmuxComplete=function(r){var o,l="audio",i=this.hls,a=r.remuxResult,u=r.chunkMeta,h=this.getCurrentContext(u);if(!h)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(u.level);var c=h.frag,g=h.part,p=a.audio,y=a.text,S=a.id3,D=a.initSegment;if(!this.fragContextChanged(c)){if(this.state=Ut,this.audioSwitch&&p&&this.completeAudioSwitch(),null!=D&&D.tracks&&(this._bufferInitSegment(D.tracks,c,u),i.trigger(f.a.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:l,tracks:D.tracks})),p){var U=p.startPTS,V=p.endPTS,it=p.startDTS,et=p.endDTS;g&&(g.elementaryStreams[q.a.AUDIO]={startPTS:U,endPTS:V,startDTS:it,endDTS:et}),c.setElementaryStreamInfo(q.a.AUDIO,U,V,it,et),this.bufferFragmentData(p,c,g,u)}if(null!=S&&null!==(o=S.samples)&&void 0!==o&&o.length){var nt=ze({frag:c,id:l},S);i.trigger(f.a.FRAG_PARSING_METADATA,nt)}if(y){var vt=ze({frag:c,id:l},y);i.trigger(f.a.FRAG_PARSING_USERDATA,vt)}}},n._bufferInitSegment=function(r,o,l){if(this.state===Ut){r.video&&delete r.video;var i=r.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(f.a.BUFFER_CODECS,r);var a=i.initSegment;null!=a&&a.byteLength&&this.hls.trigger(f.a.BUFFER_APPENDING,{type:"audio",frag:o,part:null,chunkMeta:l,parent:o.type,data:a}),this.tick()}}},n.loadFragment=function(r,o,l){var i=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||i===Pt.NOT_LOADED||i===Pt.PARTIAL)&&("initSegment"===r.sn?this._loadInitSegment(r):o.live&&!Object(_.a)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=ye):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,r,o,l)))},n.completeAudioSwitch=function(){var r=this.hls,l=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(f.a.AUDIO_TRACK_SWITCHED,{id:l})},e}(ne);function Tr(d,s){return(Tr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}var yi=function(d){var s,t;function e(i){var a;return(a=d.call(this,i,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,Tr(s,t);var r,l=e.prototype;return l.registerListeners=function(){var i=this.hls;i.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.on(f.a.MANIFEST_PARSED,this.onManifestParsed,this),i.on(f.a.LEVEL_LOADING,this.onLevelLoading,this),i.on(f.a.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(f.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(f.a.ERROR,this.onError,this)},l.unregisterListeners=function(){var i=this.hls;i.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.off(f.a.MANIFEST_PARSED,this.onManifestParsed,this),i.off(f.a.LEVEL_LOADING,this.onLevelLoading,this),i.off(f.a.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(f.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(f.a.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,d.prototype.destroy.call(this)},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},l.onManifestParsed=function(i,a){this.tracks=a.audioTracks||[]},l.onAudioTrackLoaded=function(i,a){var u=a.id,h=a.details,c=this.tracksInGroup[u];if(c){var g=c.details;c.details=a.details,this.log("audioTrack "+u+" loaded ["+h.startSN+"-"+h.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,a,g))}else this.warn("Invalid audio track id "+u)},l.onLevelLoading=function(i,a){this.switchLevel(a.level)},l.onLevelSwitching=function(i,a){this.switchLevel(a.level)},l.switchLevel=function(i){var a=this.hls.levels[i];if(null!=a&&a.audioGroupIds){var u=a.audioGroupIds[a.urlId];if(this.groupId!==u){this.groupId=u;var h=this.tracks.filter(function(g){return!u||g.groupId===u});this.selectDefaultTrack&&!h.some(function(g){return g.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var c={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(f.a.AUDIO_TRACKS_UPDATED,c),this.selectInitialTrack()}}},l.onError=function(i,a){d.prototype.onError.call(this,i,a),!a.fatal&&a.context&&a.context.type===I.a.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},l.setAudioTrack=function(i){var a=this.tracksInGroup;if(i<0||i>=a.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var u=a[this.trackId];this.log("Now switching to audio-track index "+i);var h=a[i],c=h.id,g=h.groupId,p=void 0===g?"":g,y=h.name,S=h.type,D=h.url;if(this.trackId=i,this.trackName=y,this.selectDefaultTrack=!1,this.hls.trigger(f.a.AUDIO_TRACK_SWITCHING,{id:c,groupId:p,name:y,type:S,url:D}),!h.details||h.details.live){var U=this.switchParams(h.url,u?.details);this.loadPlaylist(U)}}},l.selectInitialTrack=function(){var a=this.findTrackId(this.trackName)||this.findTrackId();-1!==a?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},l.findTrackId=function(i){for(var a=this.tracksInGroup,u=0;u<a.length;u++){var h=a[u];if((!this.selectDefaultTrack||h.default)&&(!i||i===h.name))return h.id}return-1},l.loadPlaylist=function(i){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var u=a.id,h=a.groupId,c=a.url;if(i)try{c=i.addDirectives(c)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("loading audio-track playlist for id: "+u),this.clearTimer(),this.hls.trigger(f.a.AUDIO_TRACK_LOADING,{url:c,id:u,groupId:h,deliveryDirectives:i||null})}},(r=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&function yr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(e.prototype,r),e}(re);function Er(d,s){return(Er=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}var Ti=function(d){var s,t;function e(i,a){var u;return(u=d.call(this,i,a,"[subtitle-stream-controller]")||this).levels=[],u.currentTrackId=-1,u.tracksBuffered=[],u.mainDetails=null,u._registerListeners(),u}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,Er(s,t);var r,l=e.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var i=this.hls;i.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.on(f.a.LEVEL_LOADED,this.onLevelLoaded,this),i.on(f.a.ERROR,this.onError,this),i.on(f.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(f.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(f.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(f.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var i=this.hls;i.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.off(f.a.LEVEL_LOADED,this.onLevelLoaded,this),i.off(f.a.ERROR,this.onError,this),i.off(f.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(f.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(f.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(f.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=Lt,this.setInterval(500),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(i,a){this.mainDetails=a.details},l.onSubtitleFragProcessed=function(i,a){var u=a.frag,h=a.success;if(this.fragPrevious=u,this.state=Lt,h){var c=this.tracksBuffered[this.currentTrackId];if(c){for(var g,p=u.start,y=0;y<c.length;y++)if(p>=c[y].start&&p<=c[y].end){g=c[y];break}var S=u.start+u.duration;g?g.end=S:c.push(g={start:p,end:S}),this.fragmentTracker.fragBuffered(u)}}},l.onBufferFlushing=function(i,a){var u=a.startOffset,h=a.endOffset;if(0===u&&h!==Number.POSITIVE_INFINITY){var c=this.currentTrackId,g=this.levels;if(!g.length||!g[c]||!g[c].details)return;var p=h-g[c].details.targetduration;if(p<=0)return;a.endOffsetSubtitles=Math.max(0,p),this.tracksBuffered.forEach(function(y){for(var S=0;S<y.length;)if(y[S].end<=p)y.shift();else{if(!(y[S].start<p))break;y[S].start=p,S++}}),this.fragmentTracker.removeFragmentsInRange(u,p,I.b.SUBTITLE)}},l.onError=function(i,a){var u,h=a.frag;h&&h.type===I.b.SUBTITLE&&(null!==(u=this.fragCurrent)&&void 0!==u&&u.loader&&this.fragCurrent.loader.abort(),this.state=Lt)},l.onSubtitleTracksUpdated=function(i,a){var u=this,h=a.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(c){return new _t(c)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(c){u.tracksBuffered[c.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(i,a){if(this.currentTrackId=a.id,this.levels.length&&-1!==this.currentTrackId){var u=this.levels[this.currentTrackId];this.mediaBuffer=null!=u&&u.details?this.mediaBufferTimeRanges:null,u&&this.setInterval(500)}else this.clearInterval()},l.onSubtitleTrackLoaded=function(i,a){var u,h=a.details,c=a.id,g=this.currentTrackId,p=this.levels;if(p.length){var y=p[g];if(!(c>=p.length||c!==g)&&y){if(this.mediaBuffer=this.mediaBufferTimeRanges,h.live||null!==(u=y.details)&&void 0!==u&&u.live){var S=this.mainDetails;if(h.deltaUpdateFailed||!S)return;var D=S.fragments[0];y.details?0===this.alignPlaylists(h,y.details)&&D&&ve(h,D.start):h.hasProgramDateTime&&S.hasProgramDateTime?A(h,S):D&&ve(h,D.start)}y.details=h,this.levelLastLoaded=c,this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===Lt&&(b(null,h.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0))}}},l._handleFragmentLoadComplete=function(i){var a=i.frag,u=i.payload,h=a.decryptdata,c=this.hls;if(!this.fragContextChanged(a)&&u&&u.byteLength>0&&h&&h.key&&h.iv&&"AES-128"===h.method){var g=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(u),h.key.buffer,h.iv.buffer).then(function(p){var y=performance.now();c.trigger(f.a.FRAG_DECRYPTED,{frag:a,payload:p,stats:{tstart:g,tdecrypt:y}})})}},l.doTick=function(){if(this.media){if(this.state===Lt){var i,a=this.currentTrackId,u=this.levels;if(!u.length||!u[a]||!u[a].details)return;var h=u[a].details,c=h.targetduration,g=this.config,y=Ct.bufferedInfo(this.mediaBufferTimeRanges,this.media.currentTime-c,g.maxBufferHole),S=y.end;if(y.len>this.getMaxBufferLength()+c)return;var D,U=h.fragments,V=U.length,et=this.fragPrevious;S<h.edge?!(D=b(et,U,S,g.maxFragLookUpTolerance))&&et&&et.start<U[0].start&&(D=U[0]):D=U[V-1],null!==(i=D)&&void 0!==i&&i.encrypted?this.loadKey(D,h):D&&this.fragmentTracker.getState(D)===Pt.NOT_LOADED&&this.loadFragment(D,h,S)}}else this.state=Lt},l.loadFragment=function(i,a,u){this.fragCurrent=i,d.prototype.loadFragment.call(this,i,a,u)},(r=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&function br(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(e.prototype,r),e}(ne);function Lr(d,s){return(Lr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}function Qe(d){for(var s=[],t=0;t<d.length;t++){var e=d[t];"subtitles"===e.kind&&e.label&&s.push(d[t])}return s}var kt,bi=function(d){var s,t;function e(i){var a;return(a=d.call(this,i,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a.subtitleDisplay=!0,a.registerListeners(),a}t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,Lr(s,t);var r,l=e.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},l.registerListeners=function(){var i=this.hls;i.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.on(f.a.MANIFEST_PARSED,this.onManifestParsed,this),i.on(f.a.LEVEL_LOADING,this.onLevelLoading,this),i.on(f.a.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(f.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(f.a.ERROR,this.onError,this)},l.unregisterListeners=function(){var i=this.hls;i.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),i.off(f.a.MANIFEST_PARSED,this.onManifestParsed,this),i.off(f.a.LEVEL_LOADING,this.onLevelLoading,this),i.off(f.a.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(f.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(f.a.ERROR,this.onError,this)},l.onMediaAttached=function(i,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(i){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,i)},l.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Qe(this.media.textTracks).forEach(function(i){bt(i)}),this.subtitleTrack=-1,this.media=null)},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(i,a){this.tracks=a.subtitleTracks},l.onSubtitleTrackLoaded=function(i,a){var u=a.id,h=a.details,g=this.tracksInGroup[this.trackId];if(g){var p=g.details;g.details=a.details,this.log("subtitle track "+u+" loaded ["+h.startSN+"-"+h.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,a,p))}else this.warn("Invalid subtitle track id "+u)},l.onLevelLoading=function(i,a){this.switchLevel(a.level)},l.onLevelSwitching=function(i,a){this.switchLevel(a.level)},l.switchLevel=function(i){var a=this.hls.levels[i];if(null!=a&&a.textGroupIds){var u=a.textGroupIds[a.urlId];if(this.groupId!==u){var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,c=this.tracks.filter(function(y){return!u||y.groupId===u});this.tracksInGroup=c;var g=this.findTrackId(h?.name)||this.findTrackId();this.groupId=u;var p={subtitleTracks:c};this.log("Updating subtitle tracks, "+c.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(f.a.SUBTITLE_TRACKS_UPDATED,p),-1!==g&&this.setSubtitleTrack(g,h)}}},l.findTrackId=function(i){for(var a=this.tracksInGroup,u=0;u<a.length;u++){var h=a[u];if((!this.selectDefaultTrack||h.default)&&(!i||i===h.name))return h.id}return-1},l.onError=function(i,a){d.prototype.onError.call(this,i,a),!a.fatal&&a.context&&a.context.type===I.a.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},l.loadPlaylist=function(i){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var u=a.id,h=a.groupId,c=a.url;if(i)try{c=i.addDirectives(c)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(f.a.SUBTITLE_TRACK_LOADING,{url:c,id:u,groupId:h,deliveryDirectives:i||null})}},l.toggleTrackModes=function(i){var a=this,u=this.media,h=this.subtitleDisplay,c=this.trackId;if(u){var g=Qe(u.textTracks),p=g.filter(function(D){return D.groupId===a.groupId});if(-1===i)[].slice.call(g).forEach(function(D){D.mode="disabled"});else{var y=p[c];y&&(y.mode="disabled")}var S=p[i];S&&(S.mode=h?"showing":"hidden")}},l.setSubtitleTrack=function(i,a){var u,h=this.tracksInGroup;if(this.media){if(this.trackId!==i&&this.toggleTrackModes(i),!(this.trackId===i&&(-1===i||null!==(u=h[i])&&void 0!==u&&u.details)||i<-1||i>=h.length)){this.clearTimer();var c=h[i];if(this.log("Switching to subtitle track "+i),this.trackId=i,c){var p=c.groupId;this.hls.trigger(f.a.SUBTITLE_TRACK_SWITCH,{id:c.id,groupId:void 0===p?"":p,name:c.name,type:c.type,url:c.url});var V=this.switchParams(c.url,a?.details);this.loadPlaylist(V)}else this.hls.trigger(f.a.SUBTITLE_TRACK_SWITCH,{id:i})}}else this.queuedDefaultTrack=i},l.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var i=-1,a=Qe(this.media.textTracks),u=0;u<a.length;u++)if("hidden"===a[u].mode)i=u;else if("showing"===a[u].mode){i=u;break}this.subtitleTrack!==i&&(this.subtitleTrack=i)}},(r=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setSubtitleTrack(i,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}])&&function Sr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(e.prototype,r),e}(re),Ei=function(){function d(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var s=d.prototype;return s.append=function(t,e){var n=this.queues[e];n.push(t),1===n.length&&this.buffers[e]&&this.executeNext(e)},s.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},s.appendBlocker=function(t){var e,n=new Promise(function(o){e=o});return this.append({execute:e,onStart:function(){},onComplete:function(){},onError:function(){}},t),n},s.executeNext=function(t){var r=this.buffers[t],o=this.queues[t];if(o.length){var l=o[0];try{l.execute()}catch(i){R.b.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),l.onError(i),r&&r.updating||(o.shift(),this.executeNext(t))}}},s.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},s.current=function(t){return this.queues[t][0]},d}(),Ar=Ce(),Dr=/([ha]vc.)(?:\.[^.,]+)+/,Si=function(){function d(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var n=e.hls,r=e.media,o=e.mediaSource;R.b.log("[buffer-controller]: Media source opened"),r&&(e.updateMediaElementDuration(),n.trigger(f.a.MEDIA_ATTACHED,{media:r})),o&&o.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){R.b.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){R.b.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var s=d.prototype;return s.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},s.destroy=function(){this.unregisterListeners(),this.details=null},s.registerListeners=function(){var t=this.hls;t.on(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(f.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(f.a.BUFFER_RESET,this.onBufferReset,this),t.on(f.a.BUFFER_APPENDING,this.onBufferAppending,this),t.on(f.a.BUFFER_CODECS,this.onBufferCodecs,this),t.on(f.a.BUFFER_EOS,this.onBufferEos,this),t.on(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(f.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(f.a.FRAG_PARSED,this.onFragParsed,this),t.on(f.a.FRAG_CHANGED,this.onFragChanged,this)},s.unregisterListeners=function(){var t=this.hls;t.off(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(f.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(f.a.BUFFER_RESET,this.onBufferReset,this),t.off(f.a.BUFFER_APPENDING,this.onBufferAppending,this),t.off(f.a.BUFFER_CODECS,this.onBufferCodecs,this),t.off(f.a.BUFFER_EOS,this.onBufferEos,this),t.off(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(f.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(f.a.FRAG_PARSED,this.onFragParsed,this),t.off(f.a.FRAG_CHANGED,this.onFragChanged,this)},s._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Ei(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},s.onManifestParsed=function(t,e){var n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,R.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},s.onMediaAttaching=function(t,e){var n=this.media=e.media;if(n&&Ar){var r=this.mediaSource=new Ar;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(r),this._objectUrl=n.src}},s.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,n=this._objectUrl;if(e){if(R.b.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(r){R.b.warn("[buffer-controller]: onMediaDetaching: "+r.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(n&&self.URL.revokeObjectURL(n),t.src===n?(t.removeAttribute("src"),t.load()):R.b.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(f.a.MEDIA_DETACHED,void 0)},s.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(e){var n=t.sourceBuffer[e];try{n&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(n),t.sourceBuffer[e]=void 0)}catch(r){R.b.warn("[buffer-controller]: Failed to reset the "+e+" buffer",r)}}),this._initSourceBuffer()},s.onBufferCodecs=function(t,e){var n=this,r=this.getSourceBufferTypes().length;Object.keys(e).forEach(function(o){if(r){var l=n.tracks[o];if(l&&"function"==typeof l.buffer.changeType){var i=e[o],a=i.codec,u=i.levelCodec,h=i.container;(l.levelCodec||l.codec).replace(Dr,"$1")!==(u||a).replace(Dr,"$1")&&n.appendChangeType(o,h+";codecs="+(u||a))}}else n.pendingTracks[o]=e[o]}),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},s.appendChangeType=function(t,e){var n=this,r=this.operationQueue,o={execute:function(){var l=n.sourceBuffer[t];l&&(R.b.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),l.changeType(e)),r.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(l){R.b.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",l)}};r.append(o,t)},s.onBufferAppending=function(t,e){var n=this,r=this.hls,o=this.operationQueue,l=this.tracks,i=e.data,a=e.type,u=e.frag,h=e.part,c=e.chunkMeta,g=c.buffering[a],p=self.performance.now();g.start=p;var y=u.stats.buffering,S=h?h.stats.buffering:null;0===y.start&&(y.start=p),S&&0===S.start&&(S.start=p);var U="audio"===a&&1===c.id&&"audio/mpeg"===l.audio?.container;o.append({execute:function(){if(g.executeStart=self.performance.now(),U){var it=n.sourceBuffer[a];if(it){var et=u.start-it.timestampOffset;Math.abs(et)>=.1&&(R.b.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+u.start+" (delta: "+et+") sn: "+u.sn+")"),it.timestampOffset=u.start)}}n.appendExecutor(i,a)},onStart:function(){},onComplete:function(){var it=self.performance.now();g.executeEnd=g.end=it,0===y.first&&(y.first=it),S&&0===S.first&&(S.first=it);var et=n.sourceBuffer,nt={};for(var vt in et)nt[vt]=Ct.getBuffered(et[vt]);n.appendError=0,n.hls.trigger(f.a.BUFFER_APPENDED,{type:a,frag:u,part:h,chunkMeta:c,parent:u.type,timeRanges:nt})},onError:function(it){R.b.error("[buffer-controller]: Error encountered while trying to append to the "+a+" SourceBuffer",it);var et={type:M.b.MEDIA_ERROR,parent:u.type,details:M.a.BUFFER_APPEND_ERROR,err:it,fatal:!1};it.code===DOMException.QUOTA_EXCEEDED_ERR?et.details=M.a.BUFFER_FULL_ERROR:(n.appendError++,et.details=M.a.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(R.b.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),et.fatal=!0)),r.trigger(f.a.ERROR,et)}},a)},s.onBufferFlushing=function(t,e){var n=this,r=this.operationQueue,o=function(l){return{execute:n.removeExecutor.bind(n,l,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(f.a.BUFFER_FLUSHED,{type:l})},onError:function(i){R.b.warn("[buffer-controller]: Failed to remove from "+l+" SourceBuffer",i)}}};e.type?r.append(o(e.type),e.type):this.getSourceBufferTypes().forEach(function(l){r.append(o(l),l)})},s.onFragParsed=function(t,e){var n=this,r=e.frag,o=e.part,l=[],i=o?o.elementaryStreams:r.elementaryStreams;i[q.a.AUDIOVIDEO]?l.push("audiovideo"):(i[q.a.AUDIO]&&l.push("audio"),i[q.a.VIDEO]&&l.push("video")),0===l.length&&R.b.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers(function(){var a=self.performance.now();r.stats.buffering.end=a,o&&(o.stats.buffering.end=a),n.hls.trigger(f.a.FRAG_BUFFERED,{frag:r,part:o,stats:o?o.stats:r.stats,id:r.type})},l)},s.onFragChanged=function(t,e){this.flushBackBuffer()},s.onBufferEos=function(t,e){var n=this;this.getSourceBufferTypes().reduce(function(r,o){var l=n.sourceBuffer[o];return e.type&&e.type!==o||l&&!l.ended&&(l.ended=!0,R.b.log("[buffer-controller]: "+o+" sourceBuffer now EOS")),r&&!(l&&!l.ended)},!0)&&this.blockBuffers(function(){var r=n.mediaSource;r&&"open"===r.readyState&&r.endOfStream()})},s.onLevelUpdated=function(t,e){var n=e.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},s.flushBackBuffer=function(){var t=this.hls,e=this.details,n=this.media,r=this.sourceBuffer;if(n&&null!==e){var o=this.getSourceBufferTypes();if(o.length){var l=e.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(_.a)(l)&&!(l<0)){var i=n.currentTime,a=e.levelTargetDuration,u=Math.max(l,a),h=Math.floor(i/a)*a-u;o.forEach(function(c){var g=r[c];if(g){var p=Ct.getBuffered(g);p.length>0&&h>p.start(0)&&(t.trigger(f.a.BACK_BUFFER_REACHED,{bufferEnd:h}),e.live&&t.trigger(f.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),t.trigger(f.a.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:c}))}})}}}},s.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,r=this.mediaSource,o=t.fragments[0].start+t.totalduration,l=this.media.duration,i=Object(_.a)(r.duration)?r.duration:0;t.live&&e.config.liveDurationInfinity?(R.b.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(o>i&&o>l||!Object(_.a)(l))&&(R.b.log("[buffer-controller]: Updating Media Source duration to "+o.toFixed(3)),r.duration=o)}},s.updateSeekableRange=function(t){var e=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=e&&e.setLiveSeekableRange){var r=Math.max(0,n[0].start),o=Math.max(r,r+t.totalduration);e.setLiveSeekableRange(r,o)}},s.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,n=this.pendingTracks,r=Object.keys(n).length;if(r&&!t||2===r){this.createSourceBuffers(n),this.pendingTracks={};var o=this.getSourceBufferTypes();if(0===o.length)return void this.hls.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});o.forEach(function(l){e.executeNext(l)})}},s.createSourceBuffers=function(t){var e=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var r=0;for(var o in t)if(!e[o]){var l=t[o];if(!l)throw Error("source buffer exists for track "+o+", however track does not");var i=l.levelCodec||l.codec,a=l.container+";codecs="+i;R.b.log("[buffer-controller]: creating sourceBuffer("+a+")");try{var u=e[o]=n.addSourceBuffer(a),h=o;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[o]={buffer:u,codec:i,container:l.container,levelCodec:l.levelCodec,id:l.id},r++}catch(c){R.b.error("[buffer-controller]: error while trying to add sourceBuffer: "+c.message),this.hls.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,mimeType:a})}}r&&this.hls.trigger(f.a.BUFFER_CREATED,{tracks:this.tracks})},s._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},s._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},s._onSBUpdateError=function(t,e){R.b.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(f.a.ERROR,{type:M.b.MEDIA_ERROR,details:M.a.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(t);n&&n.onError(e)},s.removeExecutor=function(t,e,n){var r=this.media,o=this.mediaSource,l=this.operationQueue,i=this.sourceBuffer[t];if(!r||!o||!i)return R.b.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void l.shiftAndExecuteNext(t);var a=Object(_.a)(r.duration)?r.duration:1/0,u=Object(_.a)(o.duration)?o.duration:1/0,h=Math.max(0,e),c=Math.min(n,a,u);c>h?(R.b.log("[buffer-controller]: Removing ["+h+","+c+"] from the "+t+" SourceBuffer"),i.remove(h,c)):l.shiftAndExecuteNext(t)},s.appendExecutor=function(t,e){var n=this.operationQueue,r=this.sourceBuffer[e];if(!r)return R.b.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(e);r.ended=!1,r.appendBuffer(t)},s.blockBuffers=function(t,e){var n=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return R.b.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var r=this.operationQueue,o=e.map(function(l){return r.appendBlocker(l)});Promise.all(o).then(function(){t(),e.forEach(function(l){var i=n.sourceBuffer[l];i&&i.updating||r.shiftAndExecuteNext(l)})})},s.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},s.addBufferListener=function(t,e,n){var r=this.sourceBuffer[t];if(r){var o=n.bind(this,t);this.listeners[t].push({event:e,listener:o}),r.addEventListener(e,o)}},s.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(n){e.removeEventListener(n.event,n.listener)})},d}(),Rr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},kr=function(d){var s=d;return Rr.hasOwnProperty(d)&&(s=Rr[d]),String.fromCharCode(s)},Li={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ai={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Di={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ri={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ki=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(d){d[d.ERROR=0]="ERROR",d[d.TEXT=1]="TEXT",d[d.WARNING=2]="WARNING",d[d.INFO=2]="INFO",d[d.DEBUG=3]="DEBUG",d[d.DATA=3]="DATA"}(kt||(kt={}));var _i=function(){function d(){this.time=null,this.verboseLevel=kt.ERROR}return d.prototype.log=function(s,t){this.verboseLevel>=s&&R.b.log(this.time+" ["+s+"] "+t)},d}(),Ie=function(d){for(var s=[],t=0;t<d.length;t++)s.push(d[t].toString(16));return s},_r=function(){function d(t,e,n,r,o){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=n||!1,this.background=r||"black",this.flash=o||!1}var s=d.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var r=e[n];t.hasOwnProperty(r)&&(this[r]=t[r])}},s.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},s.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},s.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},d}(),Ii=function(){function d(t,e,n,r,o,l){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new _r(e,n,r,o,l)}var s=d.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},s.setPenState=function(t){this.penState.copy(t)},s.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},s.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},s.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},d}(),Ci=function(){function d(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<100;e++)this.chars.push(new Ii);this.logger=t,this.pos=0,this.currPenState=new _r}var s=d.prototype;return s.equals=function(t){for(var e=!0,n=0;n<100;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e},s.copy=function(t){for(var e=0;e<100;e++)this.chars[e].copy(t.chars[e])},s.isEmpty=function(){for(var t=!0,e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},s.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(kt.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(kt.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},s.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(t){t>=144&&this.backSpace();var e=kr(t);this.pos>=100?this.logger.log(kt.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},s.clearFromPos=function(t){var e;for(e=t;e<100;e++)this.chars[e].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var t=[],e=!0,n=0;n<100;n++){var r=this.chars[n].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")},s.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},d}(),$e=function(){function d(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<15;e++)this.rows.push(new Ci(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=d.prototype;return s.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},s.equals=function(t){for(var e=!0,n=0;n<15;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},s.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},s.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},s.backSpace=function(){this.rows[this.currRow].backSpace()},s.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},s.insertChar=function(t){this.rows[this.currRow].insertChar(t)},s.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},s.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},s.setCursor=function(t){this.logger.log(kt.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},s.setPAC=function(t){this.logger.log(kt.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<15;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){var l=o.rows[r].cueStartTime,i=this.logger.time;if(l&&null!==i&&l<i)for(var a=0;a<this.nrRollUpRows;a++)this.rows[e-this.nrRollUpRows+a+1].copy(o.rows[r+a])}}this.currRow=e;var u=this.rows[this.currRow];if(null!==t.indent){var c=Math.max(t.indent-1,0);u.setCursor(t.indent),t.color=u.chars[c].penState.foreground}this.setPen({foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1})},s.setBkgData=function(t){this.logger.log(kt.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},s.setRollUpRows=function(t){this.nrRollUpRows=t},s.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(kt.TEXT,this.getDisplayText());var e=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(kt.INFO,"Rolling up")}else this.logger.log(kt.DEBUG,"roll_up but nrRollUpRows not set yet")},s.getDisplayText=function(t){t=t||!1;for(var e=[],n="",o=0;o<15;o++){var l=this.rows[o].getTextString();l&&e.push(t?"Row "+(o+1)+": '"+l+"'":l.trim())}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},s.getTextAndFormat=function(){return this.rows},d}(),Ir=function(){function d(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new $e(n),this.nonDisplayedMemory=new $e(n),this.lastOutputScreen=new $e(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var s=d.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(t){this.outputFilter=t},s.setPAC=function(t){this.writeScreen.setPAC(t)},s.setBkgData=function(t){this.writeScreen.setBkgData(t)},s.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(kt.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},s.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);this.logger.log(kt.INFO,(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(kt.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(kt.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(kt.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(kt.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(t){this.logger.log(kt.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},s.ccFON=function(){this.logger.log(kt.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(kt.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(kt.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(kt.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(kt.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(kt.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(kt.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(kt.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(kt.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(t){this.logger.log(kt.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},s.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(kt.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},s.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},d}();function Oe(d,s,t){t.a=d,t.b=s}function Cr(d,s,t){return t.a===d&&t.b===s}var wr=function(){function d(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new _i;this.channels=[null,new Ir(t,e,r),new Ir(t+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var s=d.prototype;return s.getHandler=function(t){return this.channels[t].getHandler()},s.setHandler=function(t,e){this.channels[t].setHandler(e)},s.addData=function(t,e){var n,r,o,l=!1;this.logger.time=t;for(var i=0;i<e.length;i+=2)if(o=127&e[i+1],0!=(r=127&e[i])||0!==o){if(this.logger.log(kt.DATA,"["+Ie([e[i],e[i+1]])+"] -> ("+Ie([r,o])+")"),(n=this.parseCmd(r,o))||(n=this.parseMidrow(r,o)),n||(n=this.parsePAC(r,o)),n||(n=this.parseBackgroundAttributes(r,o)),!n&&(l=this.parseChars(r,o))){var a=this.currentChannel;a&&a>0?this.channels[a].insertChars(l):this.logger.log(kt.WARNING,"No channel found yet. TEXT-MODE?")}n||l||this.logger.log(kt.WARNING,"Couldn't parse cleaned data "+Ie([r,o])+" orig: "+Ie([e[i],e[i+1]]))}},s.parseCmd=function(t,e){var n=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;if(Cr(t,e,n))return Oe(null,null,n),this.logger.log(kt.DEBUG,"Repeated command ("+Ie([t,e])+") is dropped"),!0;var r=20===t||21===t||23===t?1:2,o=this.channels[r];return 20===t||21===t||28===t||29===t?32===e?o.ccRCL():33===e?o.ccBS():34===e?o.ccAOF():35===e?o.ccAON():36===e?o.ccDER():37===e?o.ccRU(2):38===e?o.ccRU(3):39===e?o.ccRU(4):40===e?o.ccFON():41===e?o.ccRDC():42===e?o.ccTR():43===e?o.ccRTD():44===e?o.ccEDM():45===e?o.ccCR():46===e?o.ccENM():47===e&&o.ccEOC():o.ccTO(e-32),Oe(t,e,n),this.currentChannel=r,!0},s.parseMidrow=function(t,e){var n=0;if((17===t||25===t)&&e>=32&&e<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(kt.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(e),this.logger.log(kt.DEBUG,"MIDROW ("+Ie([t,e])+")"),!0)}return!1},s.parsePAC=function(t,e){var r=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;if(Cr(t,e,r))return Oe(null,null,r),!0;var o=t<=23?1:2,l=this.channels[o];return!!l&&(l.setPAC(this.interpretPAC(e>=64&&e<=95?1===o?Li[t]:Di[t]:1===o?Ai[t]:Ri[t],e)),Oe(t,e,r),this.currentChannel=o,!0)},s.interpretPAC=function(t,e){var n,r={color:null,italics:!1,indent:null,underline:!1,row:t};return r.underline=1==(1&(n=e>95?e-96:e-64)),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},s.parseChars=function(t,e){var n,r,o=null,l=null;if(t>=25?(n=2,l=t-8):(n=1,l=t),l>=17&&l<=19?(this.logger.log(kt.INFO,"Special char '"+kr(r=17===l?e+80:18===l?e+112:e+144)+"' in channel "+n),o=[r]):t>=32&&t<=127&&(o=0===e?[t]:[t,e]),o){var i=Ie(o);this.logger.log(kt.DEBUG,"Char codes =  "+i.join(",")),Oe(t,e,this.cmdHistory)}return o},s.parseBackgroundAttributes=function(t,e){var n;if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;var r={};return 16===t||24===t?(n=Math.floor((e-32)/2),r.background=ki[n],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0)),this.channels[t<=23?1:2].setBkgData(r),Oe(t,e,this.cmdHistory),!0},s.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},s.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var n=this.channels[e];n&&n.cueSplitAtTime(t)}},d}(),je=function(){function d(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var s=d.prototype;return s.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},s.newCue=function(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},s.reset=function(){this.cueRanges=[],this.startTime=null},d}(),Ze=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var d=["","lr","rl"],s=["start","middle","end","left","right"];function t(o,l){if("string"!=typeof l||!Array.isArray(o))return!1;var i=l.toLowerCase();return!!~o.indexOf(i)&&i}function e(o){return t(s,o)}function n(o){for(var l=arguments.length,i=new Array(l>1?l-1:0),a=1;a<l;a++)i[a-1]=arguments[a];for(var u=1;u<arguments.length;u++){var h=arguments[u];for(var c in h)o[c]=h[c]}return o}function r(o,l,i){var a=this,u={enumerable:!0};a.hasBeenReset=!1;var h="",c=!1,g=o,p=l,y=i,S=null,D="",U=!0,V="auto",it="start",et=50,nt="middle",vt=50,dt="middle";Object.defineProperty(a,"id",n({},u,{get:function(){return h},set:function(pt){h=""+pt}})),Object.defineProperty(a,"pauseOnExit",n({},u,{get:function(){return c},set:function(pt){c=!!pt}})),Object.defineProperty(a,"startTime",n({},u,{get:function(){return g},set:function(pt){if("number"!=typeof pt)throw new TypeError("Start time must be set to a number.");g=pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",n({},u,{get:function(){return p},set:function(pt){if("number"!=typeof pt)throw new TypeError("End time must be set to a number.");p=pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",n({},u,{get:function(){return y},set:function(pt){y=""+pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",n({},u,{get:function(){return S},set:function(pt){S=pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",n({},u,{get:function(){return D},set:function(pt){var Mt=t(d,pt);if(!1===Mt)throw new SyntaxError("An invalid or illegal string was specified.");D=Mt,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",n({},u,{get:function(){return U},set:function(pt){U=!!pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",n({},u,{get:function(){return V},set:function(pt){if("number"!=typeof pt&&"auto"!==pt)throw new SyntaxError("An invalid number or illegal string was specified.");V=pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",n({},u,{get:function(){return it},set:function(pt){var Mt=e(pt);if(!Mt)throw new SyntaxError("An invalid or illegal string was specified.");it=Mt,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",n({},u,{get:function(){return et},set:function(pt){if(pt<0||pt>100)throw new Error("Position must be between 0 and 100.");et=pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",n({},u,{get:function(){return nt},set:function(pt){var Mt=e(pt);if(!Mt)throw new SyntaxError("An invalid or illegal string was specified.");nt=Mt,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",n({},u,{get:function(){return vt},set:function(pt){if(pt<0||pt>100)throw new Error("Size must be between 0 and 100.");vt=pt,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",n({},u,{get:function(){return dt},set:function(pt){var Mt=e(pt);if(!Mt)throw new SyntaxError("An invalid or illegal string was specified.");dt=Mt,this.hasBeenReset=!0}})),a.displayState=void 0}return r.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},r}(),wi=function(){function d(){}return d.prototype.decode=function(s,t){if(!s)return"";if("string"!=typeof s)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(s))},d}();function Or(d){function s(e,n,r,o){return 3600*(0|e)+60*(0|n)+(0|r)+parseFloat(o||0)}var t=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?s(t[2],t[3],0,t[4]):s(t[1],t[2],t[3],t[4]):null}var Oi=function(){function d(){this.values=Object.create(null)}var s=d.prototype;return s.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},s.get=function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},s.has=function(t){return t in this.values},s.alt=function(t,e,n){for(var r=0;r<n.length;++r)if(e===n[r]){this.set(t,e);break}},s.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},s.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1},d}();function xr(d,s,t,e){var n=e?d.split(e):[d];for(var r in n)if("string"==typeof n[r]){var o=n[r].split(t);2===o.length&&s(o[0],o[1])}}var Je=new Ze(0,0,""),He="middle"===Je.align?"middle":"center";function xi(d,s,t){var e=d;function n(){var o=Or(d);if(null===o)throw new Error("Malformed timestamp: "+e);return d=d.replace(/^[^\sa-zA-Z-]+/,""),o}function r(){d=d.replace(/^\s+/,"")}if(r(),s.startTime=n(),r(),"--\x3e"!==d.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+e);d=d.substr(3),r(),s.endTime=n(),r(),function(o,l){var i=new Oi;xr(o,function(h,c){var g;switch(h){case"region":for(var p=t.length-1;p>=0;p--)if(t[p].id===c){i.set(h,t[p].region);break}break;case"vertical":i.alt(h,c,["rl","lr"]);break;case"line":g=c.split(","),i.integer(h,g[0]),i.percent(h,g[0])&&i.set("snapToLines",!1),i.alt(h,g[0],["auto"]),2===g.length&&i.alt("lineAlign",g[1],["start",He,"end"]);break;case"position":g=c.split(","),i.percent(h,g[0]),2===g.length&&i.alt("positionAlign",g[1],["start",He,"end","line-left","line-right","auto"]);break;case"size":i.percent(h,c);break;case"align":i.alt(h,c,["start",He,"end","left","right"])}},/:/,/\s/),l.region=i.get("region",null),l.vertical=i.get("vertical","");var a=i.get("line","auto");"auto"===a&&-1===Je.line&&(a=-1),l.line=a,l.lineAlign=i.get("lineAlign","start"),l.snapToLines=i.get("snapToLines",!0),l.size=i.get("size",100),l.align=i.get("align",He);var u=i.get("position","auto");"auto"===u&&50===Je.position&&(u="start"===l.align||"left"===l.align?0:"end"===l.align||"right"===l.align?100:50),l.position=u}(d,s)}function Pr(d){return d.replace(/<br(?: \/)?>/gi,"\n")}var Pi=function(){function d(){this.state="INITIAL",this.buffer="",this.decoder=new wi,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var s=d.prototype;return s.parse=function(t){var e=this;function n(){var a=e.buffer,u=0;for(a=Pr(a);u<a.length&&"\r"!==a[u]&&"\n"!==a[u];)++u;var h=a.substr(0,u);return"\r"===a[u]&&++u,"\n"===a[u]&&++u,e.buffer=a.substr(u),h}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var o=(r=n()).match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var l=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:r=n(),e.state){case"HEADER":/:/.test(r)?xr(r,function(a,u){},/:/):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new Ze(0,0,""),e.state="CUE",-1===r.indexOf("--\x3e")){e.cue.id=r;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{xi(r,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var i=-1!==r.indexOf("--\x3e");if(!r||i&&(l=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=r;continue;case"BADCUE":r||(e.state="ID")}}}catch{"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},s.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(t){this.onparsingerror&&this.onparsingerror(t)}return this.onflush&&this.onflush(),this},d}(),Mr=W(8),Mi=W(16),Fi=/\r\n|\n\r|\n|\r/g,tr=function(d,s,t){return void 0===t&&(t=0),d.substr(t,s.length)===s},er=function(d){for(var s=5381,t=d.length;t;)s=33*s^d.charCodeAt(--t);return(s>>>0).toString()};function rr(d,s,t){return er(d.toString())+er(s.toString())+er(t)}function Fr(){return(Fr=Object.assign||function(d){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}return d}).apply(this,arguments)}var Nr=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ur=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ui={left:"start",center:"center",right:"end",start:"start",end:"end"};function Br(d,s,t,e,n){var r=Object(Q.b)(new Uint8Array(d),["mdat"]);if(0!==r.length){var o=r[0],l=Object(Tt.f)(new Uint8Array(d,o.start,o.end-o.start)),i=Object(Mr.c)(s,1,t);try{e(function(a,u){var h=(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!h)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(c).reduce(function(U,V){return U[V]=h.getAttribute("ttp:"+V)||c[V],U},{}),p="preserve"!==h.getAttribute("xml:space"),y=Gr(ir(h,"styling","style")),S=Gr(ir(h,"layout","region")),D=ir(h,"body","[begin]");return[].map.call(D,function(U){var V=function Wt(zt,ee){return[].slice.call(zt.childNodes).reduce(function(me,fe,_e){var Pe;return"br"===fe.nodeName&&_e?me+"\n":null!==(Pe=fe.childNodes)&&void 0!==Pe&&Pe.length?Wt(fe,ee):ee?me+fe.textContent.trim().replace(/\s+/g," "):me+fe.textContent},"")}(U,p);if(!V||!U.hasAttribute("begin"))return null;var it=nr(U.getAttribute("begin"),g),et=nr(U.getAttribute("dur"),g),nt=nr(U.getAttribute("end"),g);if(null===it)throw jr(U);if(null===nt){if(null===et)throw jr(U);nt=it+et}var vt=new Ze(it-u,nt-u,V);vt.id=rr(vt.startTime,vt.endTime,vt.text);var dt=S[U.getAttribute("region")],pt=y[U.getAttribute("style")];vt.position=10,vt.size=80;var Wt,zt,ee,Mt=(Wt=dt,zt=pt,ee="http://www.w3.org/ns/ttml#styling",["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(me,fe){var _e=Kr(zt,ee,fe)||Kr(Wt,ee,fe);return _e&&(me[fe]=_e),me},{})),Vt=Mt.textAlign;if(Vt){var Xt=Ui[Vt];Xt&&(vt.lineAlign=Xt),vt.align=Vt}return Fr(vt,Mt),vt}).filter(function(U){return null!==U})}(l,i))}catch(a){n(a)}}else n(new Error("Could not parse IMSC1 mdat"))}function ir(d,s,t){var e=d.getElementsByTagName(s)[0];return e?[].slice.call(e.querySelectorAll(t)):[]}function Gr(d){return d.reduce(function(s,t){var e=t.getAttribute("xml:id");return e&&(s[e]=t),s},{})}function Kr(d,s,t){return d.hasAttributeNS(s,t)?d.getAttributeNS(s,t):null}function jr(d){return new Error("Could not parse ttml timestamp "+d)}function nr(d,s){if(!d)return null;var n,r,t=Or(d);return null===t&&(Nr.test(d)?(n=s,t=3600*(0|(r=Nr.exec(d))[1])+60*(0|r[2])+(0|r[3])+((0|r[4])+(0|r[5])/n.subFrameRate)/n.frameRate):Ur.test(d)&&(t=function(e,n){var r=Ur.exec(e),o=Number(r[1]);switch(r[2]){case"h":return 3600*o;case"m":return 60*o;case"ms":return 1e3*o;case"f":return o/n.frameRate;case"t":return o/n.tickRate}return o}(d,s))),t}var Bi=function(){function d(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new je(this,"textTrack1"),n=new je(this,"textTrack2"),r=new je(this,"textTrack3"),o=new je(this,"textTrack4");this.cea608Parser1=new wr(1,e,n),this.cea608Parser2=new wr(3,r,o)}t.on(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(f.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(f.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(f.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(f.a.FRAG_LOADING,this.onFragLoading,this),t.on(f.a.FRAG_LOADED,this.onFragLoaded,this),t.on(f.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(f.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(f.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(f.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this)}var s=d.prototype;return s.destroy=function(){var t=this.hls;t.off(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(f.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(f.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(f.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(f.a.FRAG_LOADING,this.onFragLoading,this),t.off(f.a.FRAG_LOADED,this.onFragLoaded,this),t.off(f.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(f.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(f.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(f.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(f.a.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},s.addCues=function(t,e,n,r,o){for(var l,a,h=!1,c=o.length;c--;){var g=o[c],p=(l=g[0],a=e,Math.min(g[1],n)-Math.max(l,a));if(p>=0&&(g[0]=Math.min(g[0],e),g[1]=Math.max(g[1],n),h=!0,p/(n-e)>.5))return}if(h||o.push([e,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[t],e,n,r);else{var S=this.Cues.newCue(null,e,n,r);this.hls.trigger(f.a.CUES_PARSED,{type:"captions",cues:S,track:t})}},s.onInitPtsFound=function(t,e){var n=this,r=e.frag,i=e.timescale,a=this.unparsedVttFrags;"main"===e.id&&(this.initPTS[r.cc]=e.initPTS,this.timescale[r.cc]=i),a.length&&(this.unparsedVttFrags=[],a.forEach(function(u){n.onFragLoaded(f.a.FRAG_LOADED,u)}))},s.getExistingTrack=function(t){var e=this.media;if(e)for(var n=0;n<e.textTracks.length;n++){var r=e.textTracks[n];if(r[t])return r}return null},s.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},s.createNativeTrack=function(t){if(!this.captionsTracks[t]){var n=this.captionsTracks,r=this.media,o=this.captionsProperties[t],l=o.label,i=o.languageCode,a=this.getExistingTrack(t);if(a)n[t]=a,bt(n[t]),rt(n[t],r);else{var u=this.createTextTrack("captions",l,i);u&&(u[t]=!0,n[t]=u)}}},s.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(f.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},s.createTextTrack=function(t,e,n){var r=this.media;if(r)return r.addTextTrack(t,e,n)},s.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},s.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){bt(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}},s.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},s._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)bt(e[n])}},s.onSubtitleTracksUpdated=function(t,e){var n=this;this.textTracks=[];var r=e.subtitleTracks||[],o=r.some(function(u){return"stpp.ttml.im1t"===u.textCodec});if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var l=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,h){var c;if(h<i.length){for(var g=null,p=0;p<i.length;p++)if(Gi(i[p],u)){g=i[p];break}g&&(c=g)}c?bt(c):(c=n.createTextTrack("subtitles",u.name,u.lang))&&(c.mode="disabled"),c&&(c.groupId=u.groupId,n.textTracks.push(c))})}else if(!l&&this.tracks&&this.tracks.length){var a=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(f.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}},s.onManifestLoaded=function(t,e){var n=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(r){var o=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(o){var i=n.captionsProperties["textTrack"+o[1]];i&&(i.label=r.name,r.lang&&(i.languageCode=r.lang),i.media=r)}})},s.onFragLoading=function(t,e){var n=this.cea608Parser1,r=this.cea608Parser2,o=this.lastSn;if(this.enabled&&n&&r&&e.frag.type===I.b.MAIN){var i,a,u=e.frag.sn,h=null!=(i=null==e||null===(a=e.part)||void 0===a?void 0:a.index)?i:-1;u===o+1||u===o&&h===this.lastPartIndex+1||(n.reset(),r.reset()),this.lastSn=u,this.lastPartIndex=h}},s.onFragLoaded=function(t,e){var n=e.frag,r=e.payload,o=this.initPTS,l=this.unparsedVttFrags;if(n.type===I.b.SUBTITLE)if(r.byteLength){if(!Object(_.a)(o[n.cc]))return l.push(e),void(o.length&&this.hls.trigger(f.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")}));var i=n.decryptdata;if(null==i||null==i.key||"AES-128"!==i.method||"stats"in e){var u=this.tracks[n.level],h=this.vttCCs;h[n.cc]||(h[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&"stpp.ttml.im1t"===u.textCodec?this._parseIMSC1(n,r):this._parseVTTs(n,r,h)}}else this.hls.trigger(f.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},s._parseIMSC1=function(t,e){var n=this,r=this.hls;Br(e,this.initPTS[t.cc],this.timescale[t.cc],function(o){n._appendCues(o,t.level),r.trigger(f.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(o){R.b.log("Failed to parse IMSC1: "+o),r.trigger(f.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:o})})},s._parseVTTs=function(t,e,n){var r=this,o=this.hls;!function Ni(d,s,t,e,n,r,o,l){var i,a=new Pi,u=Object(Tt.f)(new Uint8Array(d)).trim().replace(Fi,"\n").split("\n"),h=[],c=Object(Mr.a)(s,t),g="00:00.000",p=0,y=0,S=!0,D=!1;a.oncue=function(U){var V=e[n],it=e.ccOffset,et=(p-c)/9e4;if(null!=V&&V.new&&(void 0!==y?it=e.ccOffset=V.start:function(pt,Mt,Vt){var Xt=pt[Mt],Wt=pt[Xt.prevCC];if(!Wt||!Wt.new&&Xt.new)return pt.ccOffset=pt.presentationOffset=Xt.start,void(Xt.new=!1);for(;null!==(zt=Wt)&&void 0!==zt&&zt.new;){var zt;pt.ccOffset+=Xt.start-Wt.start,Xt.new=!1,Wt=pt[(Xt=Wt).prevCC]}pt.presentationOffset=Vt}(e,n,et)),et&&(it=et-e.presentationOffset),D){var nt=U.endTime-U.startTime,vt=Object(Mi.b)(9e4*(U.startTime+it-y),9e4*r)/9e4;U.startTime=vt,U.endTime=vt+nt}var dt=U.text.trim();U.text=decodeURIComponent(encodeURIComponent(dt)),U.id||(U.id=rr(U.startTime,U.endTime,dt)),U.endTime>0&&h.push(U)},a.onparsingerror=function(U){i=U},a.onflush=function(){i?l(i):o(h)},u.forEach(function(U){if(S){if(tr(U,"X-TIMESTAMP-MAP=")){S=!1,D=!0,U.substr(16).split(",").forEach(function(V){tr(V,"LOCAL:")?g=V.substr(6):tr(V,"MPEGTS:")&&(p=parseInt(V.substr(7)))});try{y=function(V){var it=parseInt(V.substr(-3)),et=parseInt(V.substr(-6,2)),nt=parseInt(V.substr(-9,2)),vt=V.length>9?parseInt(V.substr(0,V.indexOf(":"))):0;if(!(Object(_.a)(it)&&Object(_.a)(et)&&Object(_.a)(nt)&&Object(_.a)(vt)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+V);return it+=1e3*et,(it+=6e4*nt)+36e5*vt}(g)/1e3}catch(V){D=!1,i=V}return}""===U&&(S=!1)}a.parse(U+"\n")}),a.flush()}(e,this.initPTS[t.cc],this.timescale[t.cc],n,t.cc,t.start,function(l){r._appendCues(l,t.level),o.trigger(f.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(l){r._fallbackToIMSC1(t,e),R.b.log("Failed to parse VTT cue: "+l),o.trigger(f.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:l})})},s._fallbackToIMSC1=function(t,e){var n=this,r=this.tracks[t.level];r.textCodec||Br(e,this.initPTS[t.cc],this.timescale[t.cc],function(){r.textCodec="stpp.ttml.im1t",n._parseIMSC1(t,e)},function(){r.textCodec="wvtt"})},s._appendCues=function(t,e){var n=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[e];if("disabled"===r.mode)return;t.forEach(function(l){return mt(r,l)})}else n.trigger(f.a.CUES_PARSED,{type:"subtitles",cues:t,track:this.tracks[e].default?"default":"subtitles"+e})},s.onFragDecrypted=function(t,e){var n=e.frag;if(n.type===I.b.SUBTITLE){if(!Object(_.a)(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(f.a.FRAG_LOADED,e)}},s.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},s.onFragParsingUserdata=function(t,e){var n=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&n&&r)for(var o=0;o<e.samples.length;o++){var l=e.samples[o].bytes;if(l){var i=this.extractCea608Data(l);n.addData(e.samples[o].pts,i[0]),r.addData(e.samples[o].pts,i[1])}}},s.onBufferFlushing=function(t,e){var n=e.startOffset,r=e.endOffset,o=e.endOffsetSubtitles,l=e.type,i=this.media;if(i&&!(i.currentTime<r)){if(!l||"video"===l){var a=this.captionsTracks;Object.keys(a).forEach(function(h){return Dt(a[h],n,r)})}if(this.config.renderTextTracksNatively&&0===n&&void 0!==o){var u=this.textTracks;Object.keys(u).forEach(function(h){return Dt(u[h],n,o)})}}},s.extractCea608Data=function(t){for(var e=31&t[0],n=2,r=[[],[]],o=0;o<e;o++){var l=t[n++],i=127&t[n++],a=127&t[n++],u=3&l;0===i&&0===a||0!=(4&l)&&(0!==u&&1!==u||(r[u].push(i),r[u].push(a)))}return r},d}();function Gi(d,s){return d&&d.label===s.name&&!(d.textTrack1||d.textTrack2)}function Hr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}var xe,Ki=function(){function d(r){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=r,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var s,t,e,n=d.prototype;return n.setStreamController=function(r){this.streamController=r},n.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},n.registerListeners=function(){var r=this.hls;r.on(f.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(f.a.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.a.BUFFER_CODECS,this.onBufferCodecs,this),r.on(f.a.MEDIA_DETACHING,this.onMediaDetaching,this)},n.unregisterListener=function(){var r=this.hls;r.off(f.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(f.a.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.a.BUFFER_CODECS,this.onBufferCodecs,this),r.off(f.a.MEDIA_DETACHING,this.onMediaDetaching,this)},n.onFpsDropLevelCapping=function(r,o){d.isLevelAllowed(o.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(o.droppedLevel)},n.onMediaAttaching=function(r,o){this.media=o.media instanceof HTMLVideoElement?o.media:null},n.onManifestParsed=function(r,o){var l=this.hls;this.restrictedLevels=[],this.firstLevel=o.firstLevel,l.config.capLevelToPlayerSize&&o.video&&this.startCapping()},n.onBufferCodecs=function(r,o){this.hls.config.capLevelToPlayerSize&&o.video&&this.startCapping()},n.onMediaDetaching=function(){this.stopCapping()},n.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var r=this.hls.levels;if(r.length){var o=this.hls;o.autoLevelCapping=this.getMaxLevel(r.length-1),o.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=o.autoLevelCapping}}},n.getMaxLevel=function(r){var o=this,l=this.hls.levels;if(!l.length)return-1;var i=l.filter(function(a,u){return d.isLevelAllowed(u,o.restrictedLevels)&&u<=r});return this.clientRect=null,d.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},n.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},n.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},n.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,o={width:0,height:0};if(r){var l=r.getBoundingClientRect();o.width=l.width,o.height=l.height,o.width||o.height||(o.width=l.right-l.left||r.width||0,o.height=l.bottom-l.top||r.height||0)}return this.clientRect=o,o},d.isLevelAllowed=function(r,o){return void 0===o&&(o=[]),-1===o.indexOf(r)},d.getMaxLevelByMediaSize=function(r,o,l){if(!r||!r.length)return-1;for(var i,a,u=r.length-1,h=0;h<r.length;h+=1){var c=r[h];if((c.width>=o||c.height>=l)&&(i=c,!(a=r[h+1])||i.width!==a.width||i.height!==a.height)){u=h;break}}return u},s=d,e=[{key:"contentScaleFactor",get:function(){var r=1;try{r=self.devicePixelRatio}catch{}return r}}],(t=[{key:"mediaWidth",get:function(){return this.getDimensions().width*d.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*d.contentScaleFactor}}])&&Hr(s.prototype,t),e&&Hr(s,e),d}(),ji=function(){function d(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var s=d.prototype;return s.setStreamController=function(t){this.streamController=t},s.registerListeners=function(){this.hls.on(f.a.MEDIA_ATTACHING,this.onMediaAttaching,this)},s.unregisterListeners=function(){this.hls.off(f.a.MEDIA_ATTACHING,this.onMediaAttaching)},s.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},s.onMediaAttaching=function(t,e){var n=this.hls.config;if(n.capLevelOnFPSDrop){var r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},s.checkFPS=function(t,e,n){var r=performance.now();if(e){if(this.lastTime){var l=n-this.lastDroppedFrames,i=e-this.lastDecodedFrames,a=1e3*l/(r-this.lastTime),u=this.hls;if(u.trigger(f.a.FPS_DROP,{currentDropped:l,currentDecoded:i,totalDroppedFrames:n}),a>0&&l>u.config.fpsDroppedMonitoringThreshold*i){var h=u.currentLevel;R.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=h)&&(u.trigger(f.a.FPS_DROP_LEVEL_CAPPING,{level:h-=1,droppedLevel:u.currentLevel}),u.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=e}},s.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},d}();!function(d){d.WIDEVINE="com.widevine.alpha",d.PLAYREADY="com.microsoft.playready"}(xe||(xe={}));var Hi=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var ae,ar,Wr,Vi=function(){function d(r){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=r,this._config=r.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var t,n=d.prototype;return n.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},n._registerListeners=function(){this.hls.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(f.a.MANIFEST_PARSED,this.onManifestParsed,this)},n._unregisterListeners=function(){this.hls.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(f.a.MANIFEST_PARSED,this.onManifestParsed,this)},n.getLicenseServerUrl=function(r){switch(r){case xe.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+r+'"')},n._attemptKeySystemAccess=function(r,o,l){var i=this,a=function(h,c,g,p){if(h===xe.WIDEVINE)return S=g,D=p,U={audioCapabilities:[],videoCapabilities:[]},c.forEach(function(V){U.audioCapabilities.push({contentType:'audio/mp4; codecs="'+V+'"',robustness:D.audioRobustness||""})}),S.forEach(function(V){U.videoCapabilities.push({contentType:'video/mp4; codecs="'+V+'"',robustness:D.videoRobustness||""})}),[U];throw new Error("Unknown key-system: "+h);var S,D,U}(r,o,l,this._drmSystemOptions);R.b.log("Requesting encrypted media key-system access");var u=this.requestMediaKeySystemAccess(r,a);this.mediaKeysPromise=u.then(function(h){return i._onMediaKeySystemAccessObtained(r,h)}),u.catch(function(h){R.b.error('Failed to obtain key-system "'+r+'" access:',h)})},n._onMediaKeySystemAccessObtained=function(r,o){var l=this;R.b.log('Access for key-system "'+r+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:o,mediaKeySystemDomain:r};this._mediaKeysList.push(i);var a=Promise.resolve().then(function(){return o.createMediaKeys()}).then(function(u){return i.mediaKeys=u,R.b.log('Media-keys created for key-system "'+r+'"'),l._onMediaKeysCreated(),u});return a.catch(function(u){R.b.error("Failed to create media-keys:",u)}),a},n._onMediaKeysCreated=function(){var r=this;this._mediaKeysList.forEach(function(o){o.mediaKeysSession||(o.mediaKeysSession=o.mediaKeys.createSession(),r._onNewMediaKeySession(o.mediaKeysSession))})},n._onNewMediaKeySession=function(r){var o=this;R.b.log("New key-system session "+r.sessionId),r.addEventListener("message",function(l){o._onKeySessionMessage(r,l.message)},!1)},n._onKeySessionMessage=function(r,o){R.b.log("Got EME message event, creating license request"),this._requestLicense(o,function(l){R.b.log("Received license data (length: "+(l&&l.byteLength)+"), updating key-session"),r.update(l)})},n.onMediaEncrypted=function(r){var o=this;if(R.b.log('Media is encrypted using "'+r.initDataType+'" init data type'),!this.mediaKeysPromise)return R.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var l=function(i){o._media&&(o._attemptSetMediaKeys(i),o._generateRequestWithPreferredKeySession(r.initDataType,r.initData))};this.mediaKeysPromise.then(l).catch(l)},n._attemptSetMediaKeys=function(r){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var o=this._mediaKeysList[0];if(!o||!o.mediaKeys)return R.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_KEYS,fatal:!0});R.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(o.mediaKeys),this._hasSetMediaKeys=!0}},n._generateRequestWithPreferredKeySession=function(r,o){var l=this,i=this._mediaKeysList[0];if(!i)return R.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(i.mediaKeysSessionInitialized)R.b.warn("Key-Session already initialized but requested again");else{var a=i.mediaKeysSession;if(!a)return R.b.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!o)return R.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});R.b.log('Generating key-session request for "'+r+'" init data type'),i.mediaKeysSessionInitialized=!0,a.generateRequest(r,o).then(function(){R.b.debug("Key-session generation succeeded")}).catch(function(u){R.b.error("Error generating key-session request:",u),l.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},n._createLicenseXhr=function(r,o,l){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,r,o,l);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,i,r),a=void 0}catch(u){R.b.error(u)}try{i.readyState||i.open("POST",r,!0),a&&a.call(this.hls,i,r)}catch(u){throw new Error("issue setting up KeySystem license XHR "+u)}return i},n._onLicenseRequestReadyStageChange=function(r,o,l,i){if(4===r.readyState)if(200===r.status){this._requestLicenseFailureCount=0,R.b.log("License request succeeded");var a=r.response,u=this._licenseResponseCallback;if(u)try{a=u.call(this.hls,r,o)}catch(c){R.b.error(c)}i(a)}else{if(R.b.error("License Request XHR failed ("+o+"). Status: "+r.status+" ("+r.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});R.b.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left"),this._requestLicense(l,i)}},n._generateLicenseRequestChallenge=function(r,o){if(r.mediaKeySystemDomain===xe.WIDEVINE)return o;throw new Error("unsupported key-system: "+r.mediaKeySystemDomain)},n._requestLicense=function(r,o){R.b.log("Requesting content license for key-system");var l=this._mediaKeysList[0];if(!l)return R.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var i=this.getLicenseServerUrl(l.mediaKeySystemDomain),a=this._createLicenseXhr(i,r,o);R.b.log("Sending license request to URL: "+i);var u=this._generateLicenseRequestChallenge(l,r);a.send(u)}catch(h){R.b.error("Failure requesting DRM license: "+h),this.hls.trigger(f.a.ERROR,{type:M.b.KEY_SYSTEM_ERROR,details:M.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},n.onMediaAttached=function(r,o){if(this._emeEnabled){var l=o.media;this._media=l,l.addEventListener("encrypted",this._onMediaEncrypted)}},n.onMediaDetached=function(){var r=this._media,o=this._mediaKeysList;r&&(r.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(o.map(function(l){if(l.mediaKeysSession)return l.mediaKeysSession.close().catch(function(){})})).then(function(){return r.setMediaKeys(null)}).catch(function(){}))},n.onManifestParsed=function(r,o){if(this._emeEnabled){var l=o.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),i=o.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(xe.WIDEVINE,l,i)}},(t=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&function Vr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}(d.prototype,t),d}();function Yr(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}function qr(d,s,t){return s&&Yr(d.prototype,s),t&&Yr(d,t),d}function Xr(d,s){var t=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(t)return(t=t.call(d)).next.bind(t);if(Array.isArray(d)||(t=function(n,r){if(n){if("string"==typeof n)return zr(n,r);var o=Object.prototype.toString.call(n).slice(8,-1);if("Object"===o&&n.constructor&&(o=n.constructor.name),"Map"===o||"Set"===o)return Array.from(n);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return zr(n,r)}}(d))||s&&d&&"number"==typeof d.length){t&&(d=t);var e=0;return function(){return e>=d.length?{done:!0}:{done:!1,value:d[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function zr(d,s){(null==s||s>d.length)&&(s=d.length);for(var t=0,e=new Array(s);t<s;t++)e[t]=d[t];return e}function sr(){return(sr=Object.assign||function(d){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}return d}).apply(this,arguments)}(function(d){d.MANIFEST="m",d.AUDIO="a",d.VIDEO="v",d.MUXED="av",d.INIT="i",d.CAPTION="c",d.TIMED_TEXT="tt",d.KEY="k",d.OTHER="o"})(ae||(ae={})),function(d){d.DASH="d",d.HLS="h",d.SMOOTH="s",d.OTHER="o"}(ar||(ar={})),function(d){d.VOD="v",d.LIVE="l"}(Wr||(Wr={}));var Wi=function(){function d(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(o){try{e.apply(o,{ot:ae.MANIFEST,su:!e.initialized})}catch(l){R.b.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=function(o){try{var l=o.frag,i=e.hls.levels[l.level],a=e.getObjectType(l),u={d:1e3*l.duration,ot:a};a!==ae.VIDEO&&a!==ae.AUDIO&&a!=ae.MUXED||(u.br=i.bitrate/1e3,u.tb=e.getTopBandwidth(a)/1e3,u.bl=e.getBufferLength(a)),e.apply(o,u)}catch(h){R.b.warn("Could not generate segment CMCD data.",h)}},this.hls=t;var n=this.config=t.config,r=n.cmcd;null!=r&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||d.uuid(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.registerListeners())}var s=d.prototype;return s.registerListeners=function(){var t=this.hls;t.on(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(f.a.MEDIA_DETACHED,this.onMediaDetached,this),t.on(f.a.BUFFER_CREATED,this.onBufferCreated,this)},s.unregisterListeners=function(){var t=this.hls;t.off(f.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(f.a.MEDIA_DETACHED,this.onMediaDetached,this),t.off(f.a.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},s.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},s.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},s.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},s.onBufferCreated=function(t,e){var n,r;this.audioBuffer=null===(n=e.tracks.audio)||void 0===n?void 0:n.buffer,this.videoBuffer=null===(r=e.tracks.video)||void 0===r?void 0:r.buffer},s.createData=function(){var t;return{v:1,sf:ar.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},s.apply=function(t,e){if(void 0===e&&(e={}),sr(e,this.createData()),this.starved&&(e.ot===ae.INIT||e.ot===ae.VIDEO||e.ot===ae.MUXED)&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering),this.useHeaders){var r=d.toHeaders(e);if(!Object.keys(r).length)return;t.headers||(t.headers={}),sr(t.headers,r)}else{var o=d.toQuery(e);if(!o)return;t.url=d.appendQueryToUri(t.url,o)}},s.getObjectType=function(t){var e=t.type;return"subtitle"===e?ae.TIMED_TEXT:"initSegment"===t.sn?ae.INIT:"audio"===e?ae.AUDIO:"main"===e?this.hls.audioTracks.length?ae.VIDEO:ae.MUXED:void 0},s.getTopBandwidth=function(t){var e,n=0,r=this.hls;if(t===ae.AUDIO)e=r.audioTracks;else{var o=r.maxAutoLevel;e=r.levels.slice(0,o>-1?o+1:r.levels.length)}for(var i,a=Xr(e);!(i=a()).done;){var u=i.value;u.bitrate>n&&(n=u.bitrate)}return n>0?n:NaN},s.getBufferLength=function(t){var e=this.hls.media,n=t===ae.AUDIO?this.audioBuffer:this.videoBuffer;return n&&e?1e3*Ct.bufferInfo(n,e.currentTime,this.config.maxBufferHole).len:NaN},s.createPlaylistLoader=function(){var e=this.applyPlaylistData,n=this.config.pLoader||this.config.loader;return function(){function r(l){this.loader=void 0,this.loader=new n(l)}var o=r.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(l,i,a){e(l),this.loader.load(l,i,a)},qr(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},s.createFragmentLoader=function(){var e=this.applyFragmentData,n=this.config.fLoader||this.config.loader;return function(){function r(l){this.loader=void 0,this.loader=new n(l)}var o=r.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(l,i,a){e(l),this.loader.load(l,i,a)},qr(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},d.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.substr(e.lastIndexOf("/")+1)},d.serialize=function(t){for(var e,n=[],o=function(y){return Math.round(y)},l=function(y){return 100*o(y/100)},i={br:o,d:o,bl:l,dl:l,mtp:l,nor:function(y){return encodeURIComponent(y)},rtp:l,tb:o},a=Xr(Object.keys(t||{}).sort());!(e=a()).done;){var u=e.value,h=t[u];if(y=h,!(Number.isNaN(y)||null==y||""===y||!1===y||"v"===u&&1===h||"pr"==u&&1===h)){var c=i[u];c&&(h=c(h));var p,g=typeof h;p="ot"===u||"sf"===u||"st"===u?u+"="+h:"boolean"===g?u:"number"===g?u+"="+h:u+"="+JSON.stringify(h),n.push(p)}}var y;return n.join(",")},d.toHeaders=function(t){for(var e={},n=["Object","Request","Session","Status"],r=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},l=0,i=Object.keys(t);l<i.length;l++){var a=i[l];r[null!=o[a]?o[a]:1][a]=t[a]}for(var u=0;u<r.length;u++){var h=d.serialize(r[u]);h&&(e["CMCD-"+n[u]]=h)}return e},d.toQuery=function(t){return"CMCD="+encodeURIComponent(d.serialize(t))},d.appendQueryToUri=function(t,e){if(!e)return t;var n=t.includes("?")?"&":"?";return""+t+n+e},d}(),Qr=W(12),Yi=/^age:\s*[\d.]+\s*$/m,$r=function(){function d(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new Qr.a,this.retryDelay=0}var s=d.prototype;return s.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},s.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},s.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},s.load=function(t,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=n,this.retryDelay=e.retryDelay,this.loadInternal()},s.loadInternal=function(){var t=this.config,e=this.context;if(t){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;var o=this.xhrSetup;try{if(o)try{o(n,e.url)}catch{n.open("GET",e.url,!0),o(n,e.url)}n.readyState||n.open("GET",e.url,!0);var l=this.context.headers;if(l)for(var i in l)n.setRequestHeader(i,l[i])}catch(a){return void this.callbacks.onError({code:n.status,text:a.message},e,n)}e.rangeEnd&&n.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),n.send()}},s.readystatechange=function(){var t=this.context,e=this.loader,n=this.stats;if(t&&e){var r=e.readyState,o=this.config;if(!n.aborted&&r>=2)if(self.clearTimeout(this.requestTimeout),0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),4===r){e.onreadystatechange=null,e.onprogress=null;var l=e.status;if(l>=200&&l<300){var i,a;if(n.loading.end=Math.max(self.performance.now(),n.loading.first),a="arraybuffer"===t.responseType?(i=e.response).byteLength:(i=e.responseText).length,n.loaded=n.total=a,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(n,t,i,e),!this.callbacks)return;this.callbacks.onSuccess({url:e.responseURL,data:i},n,t,e)}else n.retry>=o.maxRetry||l>=400&&l<499?(R.b.error(l+" while loading "+t.url),this.callbacks.onError({code:l,text:e.statusText},t,e)):(R.b.warn(l+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout)}},s.loadtimeout=function(){R.b.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},s.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},s.getCacheAge=function(){var t=null;if(this.loader&&Yi.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},d}();function Zr(d){var s="function"==typeof Map?new Map:void 0;return(Zr=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(t))return s.get(t);s.set(t,n)}function n(){return Jr(t,arguments,ti(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Ve(n,t)})(d)}function Jr(d,s,t){return(Jr=qi()?Reflect.construct:function(e,n,r){var o=[null];o.push.apply(o,n);var l=new(Function.bind.apply(e,o));return r&&Ve(l,r.prototype),l}).apply(null,arguments)}function qi(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ve(d,s){return(Ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(d,s)}function ti(d){return(ti=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)})(d)}function ei(){return(ei=Object.assign||function(d){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}return d}).apply(this,arguments)}var Xi=function(){function d(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||zi,this.controller=new self.AbortController,this.stats=new Qr.a}var s=d.prototype;return s.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},s.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},s.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},s.load=function(t,e,n){var r=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var h,g,l=(h=t,g={method:"GET",mode:"cors",credentials:"same-origin",signal:this.controller.signal,headers:new self.Headers(ei({},h.headers))},h.rangeEnd&&g.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),g),i=n.onProgress,a="arraybuffer"===t.responseType,u=a?"byteLength":"length";this.context=t,this.config=e,this.callbacks=n,this.request=this.fetchSetup(t,l),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){r.abortInternal(),n.onTimeout(o,t,r.response)},e.timeout),self.fetch(this.request).then(function(h){if(r.response=r.loader=h,!h.ok)throw new Qi(h.statusText||"fetch, bad network response",h.status,h);return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(h.headers.get("Content-Length")||"0"),i&&Object(_.a)(e.highWaterMark)?r.loadProgressively(h,o,t,e.highWaterMark,i):a?h.arrayBuffer():h.text()}).then(function(h){var c=r.response;self.clearTimeout(r.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=h[u];var g={url:c.url,data:h};i&&!Object(_.a)(e.highWaterMark)&&i(o,t,h,c),n.onSuccess(g,o,t,c)}).catch(function(h){self.clearTimeout(r.requestTimeout),o.aborted||n.onError({code:h.code||0,text:h.message},t,h.details)})},s.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},s.loadProgressively=function(t,e,n,r,o){void 0===r&&(r=0);var l=new pr.a,i=t.body.getReader();return function a(){return i.read().then(function(u){if(u.done)return l.dataLength&&o(e,n,l.flush(),t),Promise.resolve(new ArrayBuffer(0));var h=u.value,c=h.length;return e.loaded+=c,c<r||l.dataLength?(l.push(h),l.dataLength>=r&&o(e,n,l.flush(),t)):o(e,n,h,t),a()}).catch(function(){return Promise.reject()})}()},d}();function zi(d,s){return new self.Request(d.url,s)}var Qi=function(d){var s,t;function e(n,r,o){var l;return(l=d.call(this,n)||this).code=void 0,l.details=void 0,l.code=r,l.details=o,l}return t=d,(s=e).prototype=Object.create(t.prototype),s.prototype.constructor=s,Ve(s,t),e}(Zr(Error)),ri=Xi,$i=/\s/;function ii(){return(ii=Object.assign||function(d){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}return d}).apply(this,arguments)}function ni(d,s){var t=Object.keys(d);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(d);s&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(d,n).enumerable})),t.push.apply(t,e)}return t}function ai(d){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?ni(Object(t),!0).forEach(function(e){Zi(d,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(t)):ni(Object(t)).forEach(function(e){Object.defineProperty(d,e,Object.getOwnPropertyDescriptor(t,e))})}return d}function Zi(d,s,t){return s in d?Object.defineProperty(d,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):d[s]=t,d}var Ji=ai(ai({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:$r,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:pi,bufferController:Si,capLevelController:Ki,fpsController:ji,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Hi,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:{newCue:function(d,s,t,e){for(var n,r,o,l,i,a=[],u=self.VTTCue||self.TextTrackCue,h=0;h<e.rows.length;h++)if(o=!0,l=0,i="",!(n=e.rows[h]).isEmpty()){for(var c=0;c<n.chars.length;c++)$i.test(n.chars[c].uchar)&&o?l++:(i+=n.chars[c].uchar,o=!1);n.cueStartTime=s,s===t&&(t+=1e-4),l>=16?l--:l++;var g=Pr(i.trim()),p=rr(s,t,g);d&&d.cues&&d.cues.getCueById(p)||((r=new u(s,t,g)).id=p,r.line=h+1,r.align="left",r.position=10+Math.min(80,10*Math.floor(8*l/32)),a.push(r))}return d&&a.length&&(a.sort(function(y,S){return"auto"===y.line||"auto"===S.line?0:y.line>8&&S.line>8?S.line-y.line:y.line-S.line}),a.forEach(function(y){return mt(d,y)})),a}},enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Ti,subtitleTrackController:bi,timelineController:Bi,audioStreamController:mi,audioTrackController:yi,emeController:Vi,cmcdController:Wi});function si(d,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}var oi=function(){function d(r){void 0===r&&(r={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new dr.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var o=this.config=function(vt,dt){if((dt.liveSyncDurationCount||dt.liveMaxLatencyDurationCount)&&(dt.liveSyncDuration||dt.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==dt.liveMaxLatencyDurationCount&&(void 0===dt.liveSyncDurationCount||dt.liveMaxLatencyDurationCount<=dt.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==dt.liveMaxLatencyDuration&&(void 0===dt.liveSyncDuration||dt.liveMaxLatencyDuration<=dt.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return ii({},vt,dt)}(d.DefaultConfig,r);this.userConfig=r,Object(R.a)(o.debug),this._autoLevelCapping=-1,o.progressive&&function tn(d){var s=d.loader;s!==ri&&s!==$r?(R.b.log("[config]: Custom loader detected, cannot enable progressive streaming"),d.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(d.loader=ri,d.progressive=!0,d.enableSoftwareAES=!0,R.b.log("[config]: Progressive streaming enabled, using FetchLoader"))}(o);var i=o.bufferController,a=o.capLevelController,u=o.fpsController,h=this.abrController=new(0,o.abrController)(this),c=this.bufferController=new i(this),g=this.capLevelController=new a(this),p=new u(this),y=new lt(this),S=new ct(this),D=new It(this),U=this.levelController=new pe(this),V=new ie(this),it=this.streamController=new gi(this,V);g.setStreamController(it),p.setStreamController(it);var et=[U,it];this.networkControllers=et;var nt=[y,S,h,c,g,p,D,V];this.audioTrackController=this.createController(o.audioTrackController,null,et),this.createController(o.audioStreamController,V,et),this.subtitleTrackController=this.createController(o.subtitleTrackController,null,et),this.createController(o.subtitleStreamController,V,et),this.createController(o.timelineController,null,nt),this.emeController=this.createController(o.emeController,null,nt),this.cmcdController=this.createController(o.cmcdController,null,nt),this.latencyController=this.createController(Qt,null,nt),this.coreComponents=nt}d.isSupported=function(){return function(){var r=Ce();if(!r)return!1;var o=hr();return!(!r||"function"!=typeof r.isTypeSupported||!r.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||o&&(!o.prototype||"function"!=typeof o.prototype.appendBuffer||"function"!=typeof o.prototype.remove))}()};var s,t,e,n=d.prototype;return n.createController=function(r,o,l){if(r){var i=o?new r(this,o):new r(this);return l&&l.push(i),i}return null},n.on=function(r,o,l){void 0===l&&(l=this),this._emitter.on(r,o,l)},n.once=function(r,o,l){void 0===l&&(l=this),this._emitter.once(r,o,l)},n.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},n.off=function(r,o,l,i){void 0===l&&(l=this),this._emitter.off(r,o,l,i)},n.listeners=function(r){return this._emitter.listeners(r)},n.emit=function(r,o,l){return this._emitter.emit(r,o,l)},n.trigger=function(r,o){if(this.config.debug)return this.emit(r,r,o);try{return this.emit(r,r,o)}catch(l){R.b.error("An internal error happened while handling event "+r+'. Error message: "'+l.message+'". Here is a stacktrace:',l),this.trigger(f.a.ERROR,{type:M.b.OTHER_ERROR,details:M.a.INTERNAL_EXCEPTION,fatal:!1,event:r,error:l})}return!1},n.listenerCount=function(r){return this._emitter.listenerCount(r)},n.destroy=function(){R.b.log("destroy"),this.trigger(f.a.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(r){return r.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(r){return r.destroy()}),this.coreComponents.length=0},n.attachMedia=function(r){R.b.log("attachMedia"),this._media=r,this.trigger(f.a.MEDIA_ATTACHING,{media:r})},n.detachMedia=function(){R.b.log("detachMedia"),this.trigger(f.a.MEDIA_DETACHING,void 0),this._media=null},n.loadSource=function(r){this.stopLoad();var o=this.media,l=this.url,i=this.url=tt.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});R.b.log("loadSource:"+i),o&&l&&l!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(o)),this.trigger(f.a.MANIFEST_LOADING,{url:r})},n.startLoad=function(r){void 0===r&&(r=-1),R.b.log("startLoad("+r+")"),this.networkControllers.forEach(function(o){o.startLoad(r)})},n.stopLoad=function(){R.b.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},n.swapAudioCodec=function(){R.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){R.b.log("recoverMediaError");var r=this._media;this.detachMedia(),r&&this.attachMedia(r)},n.removeLevel=function(r,o){void 0===o&&(o=0),this.levelController.removeLevel(r,o)},s=d,e=[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return f.a}},{key:"ErrorTypes",get:function(){return M.b}},{key:"ErrorDetails",get:function(){return M.a}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:Ji},set:function(r){d.defaultConfig=r}}],(t=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){R.b.log("set currentLevel:"+r),this.loadLevel=r,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){R.b.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){R.b.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){R.b.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){R.b.log("set startLevel:"+r),-1!==r&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var o=!!r;o!==this.config.capLevelToPlayerSize&&(o?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=o)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(R.b.log("set autoLevelCapping:"+r),this._autoLevelCapping=r)}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,o=this.config.minAutoBitrate;if(!r)return 0;for(var l=r.length,i=0;i<l;i++)if(r[i].maxBitrate>o)return i;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,o=this.autoLevelCapping;return-1===o&&r&&r.length?r.length-1:o}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var o=this.audioTrackController;o&&(o.audioTrack=r)}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var o=this.subtitleTrackController;o&&(o.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return!!r&&r.subtitleDisplay},set:function(r){var o=this.subtitleTrackController;o&&(o.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&si(s.prototype,t),e&&si(s,e),d}();oi.defaultConfig=void 0}]).default});